<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox æ¸¸ç›’ - æ¸¸æˆåº“</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../CSS/index.css" />
</head>
<body data-current-page="library">
<div class="page">
  <header class="header">
    <div class="header-inner">
      <a href="home.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="home.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="news-list.html" data-page="news" class="nav-link">èµ„è®¯</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          æ’è¡Œæ¦œ <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">æŠ˜æ‰£ / å²ä½</a>
        <a href="community.html" data-page="community" class="nav-link">ç¤¾åŒº</a>
        <a href="my-library.html" data-page="my" class="nav-link">æˆ‘çš„æ¸¸æˆ</a>
        <a href="tools.html" data-page="tools" class="nav-link">å·¥å…·ä¸­å¿ƒ</a>
        <a href="profile.html" data-page="profile" class="nav-link">ç”¨æˆ·ä¸­å¿ƒ</a>
      </nav>

      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="æœç´¢æ¸¸æˆ / èµ„è®¯ / å¸–å­" />
          <span class="header-search-icon">ğŸ”</span>
        </div>
        <button class="header-user">æœªç™»å½• Â· æ¸¸å®¢</button>
      </div>
    </div>
  </header>

  <main class="main">
    <section>
      <div class="card">
        <div class="page-title">æ¸¸æˆåº“</div>
        <div class="page-intro">
          é€šè¿‡åç§°ã€ç±»å‹ã€å¹³å°å’Œä»·æ ¼åŒºé—´æ¥ç­›é€‰ä½ æ„Ÿå…´è¶£çš„æ¸¸æˆï¼ˆç¤ºä¾‹æ•°æ®ï¼‰ã€‚
        </div>
      </div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>ç­›é€‰æ¡ä»¶</span>
          </div>
        </header>

        <div class="form">
          <div class="form-row">
            <label for="libSearch">æŒ‰åç§°æœç´¢</label>
            <input type="text" id="libSearch" placeholder="è¾“å…¥æ¸¸æˆåï¼Œå¦‚ï¼šè‰¾å°”ç™»æ³•ç¯" />
          </div>

          <div class="form-row">
            <label for="libType">ç±»å‹</label>
            <select id="libType">
              <option value="all">å…¨éƒ¨ç±»å‹</option>
              <option value="action">åŠ¨ä½œ / ACT</option>
              <option value="rpg">è§’è‰²æ‰®æ¼” / RPG</option>
              <option value="strategy">ç­–ç•¥ / SLG</option>
              <option value="indie">ç‹¬ç«‹ / Indie</option>
              <option value="multiplayer">å¤šäººè”æœº</option>
              <option value="casual">ä¼‘é—² / è½»åº¦</option>
            </select>
          </div>

          <div class="form-row">
            <label>å¹³å°ï¼ˆå¯å¤šé€‰ï¼‰</label>
            <div id="libPlatforms" style="display:flex;flex-wrap:wrap;gap:8px;font-size:12px;">
              <label><input type="checkbox" value="steam" checked /> Steam</label>
              <label><input type="checkbox" value="pc" checked /> PCï¼ˆå…¶ä»–å¹³å°ï¼‰</label>
              <label><input type="checkbox" value="ps" checked /> PlayStation</label>
              <label><input type="checkbox" value="switch" checked /> Switch</label>
              <label><input type="checkbox" value="mobile" checked /> æ‰‹æœº</label>
            </div>
          </div>

          <div class="form-row">
            <label for="libPrice">ä»·æ ¼åŒºé—´</label>
            <select id="libPrice">
              <option value="all">å…¨éƒ¨</option>
              <option value="free">å…è´¹ / F2P</option>
              <option value="low">100 å…ƒä»¥ä¸‹</option>
              <option value="high">100 å…ƒä»¥ä¸Š</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>ç­›é€‰ç»“æœ</span>
          </div>
          <div class="chip" id="libResultCount">å…± 0 æ¬¾</div>
        </header>
        <div id="libList" class="game-list"></div>
      </div>
    </section>

    <aside>
      <div class="sidebar-card">
        <div class="sidebar-title">å°æç¤º</div>
        <div class="sidebar-item">
          <span class="label">å¯ä¸é¦–é¡µåˆ†ç±»è”åŠ¨</span>
          <span class="value">æ”¯æŒ</span>
        </div>
        <div class="sidebar-item">
          <span class="label">æ•°æ®æ¥æº</span>
          <span class="value">ç¤ºä¾‹å‡æ•°æ®</span>
        </div>
      </div>
    </aside>
  </main>
</div>

<script src="../JS/common.js"></script>
<script>
  initCommon();

  const gameData = [
    {
      id: "elden-ring",
      name: "è‰¾å°”ç™»æ³•ç¯",
      type: "rpg",
      platforms: ["steam", "pc"],
      price: 298,
      rating: 9.4,
      tags: ["é­‚ç±»", "å¼€æ”¾ä¸–ç•Œ", "å•æœº"],
    },
    {
      id: "genshin",
      name: "åŸç¥",
      type: "rpg",
      platforms: ["pc", "mobile", "ps"],
      price: 0,
      rating: 8.8,
      tags: ["å¼€æ”¾ä¸–ç•Œ", "è”æœº", "å…è´¹"],
    },
    {
      id: "hollow-knight",
      name: "ç©ºæ´éª‘å£«",
      type: "indie",
      platforms: ["steam", "switch", "pc"],
      price: 48,
      rating: 9.6,
      tags: ["ç‹¬ç«‹", "ç±»é“¶æ²³æˆ˜å£«æ¶é­”åŸ"],
    },
    {
      id: "cp2077",
      name: "èµ›åšæœ‹å…‹ 2077",
      type: "rpg",
      platforms: ["steam", "ps"],
      price: 298,
      rating: 8.7,
      tags: ["ç§‘å¹»", "å•æœº", "å¼€æ”¾ä¸–ç•Œ"],
    },
    {
      id: "mh-rise",
      name: "æ€ªç‰©çŒäººï¼šå´›èµ·",
      type: "action",
      platforms: ["switch", "pc"],
      price: 268,
      rating: 8.5,
      tags: ["åŠ¨ä½œ", "ç‹©çŒ", "è”æœº"],
    },
    {
      id: "stardew",
      name: "æ˜Ÿéœ²è°·ç‰©è¯­",
      type: "casual",
      platforms: ["steam", "switch", "mobile"],
      price: 36,
      rating: 9.3,
      tags: ["ç‹¬ç«‹", "ä¼‘é—²", "å†œåœº"],
    },
    {
      id: "lol",
      name: "è‹±é›„è”ç›Ÿ",
      type: "multiplayer",
      platforms: ["pc"],
      price: 0,
      rating: 8.3,
      tags: ["MOBA", "è”æœº", "å…è´¹"],
    },
    {
      id: "slay-the-spire",
      name: "æ€æˆ®å°–å¡”",
      type: "strategy",
      platforms: ["steam", "switch", "mobile"],
      price: 80,
      rating: 9.0,
      tags: ["å¡ç‰Œ", "Roguelike", "ç‹¬ç«‹"],
    },
  ];

  const libSearch = document.getElementById("libSearch");
  const libType = document.getElementById("libType");
  const libPrice = document.getElementById("libPrice");
  const libPlatforms = document.getElementById("libPlatforms");
  const libList = document.getElementById("libList");
  const libResultCount = document.getElementById("libResultCount");

  function getSelectedPlatforms() {
    return Array.from(libPlatforms.querySelectorAll("input[type=checkbox]:checked")).map(
      (el) => el.value
    );
  }

  function matchesFilters(game, keyword, type, price, platforms) {
    const kw = keyword.trim().toLowerCase();
    if (kw) {
      const text = (game.name + " " + game.tags.join(" ")).toLowerCase();
      if (!text.includes(kw)) return false;
    }

    if (type !== "all" && game.type !== type) return false;

    if (platforms.length) {
      const hit = game.platforms.some((p) => platforms.includes(p));
      if (!hit) return false;
    }

    if (price === "free" && game.price !== 0) return false;
    if (price === "low" && !(game.price > 0 && game.price <= 100)) return false;
    if (price === "high" && !(game.price > 100)) return false;

    return true;
  }

  function renderList() {
    const keyword = libSearch.value;
    const type = libType.value;
    const price = libPrice.value;
    const platforms = getSelectedPlatforms();

    const filtered = gameData.filter((g) =>
      matchesFilters(g, keyword, type, price, platforms)
    );

    libList.innerHTML = "";
    libResultCount.textContent = `å…± ${filtered.length} æ¬¾`;

    if (!filtered.length) {
      libList.innerHTML =
        '<div style="font-size:12px;color:var(--text-muted);">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ¸¸æˆï¼Œå¯ä»¥å°è¯•æ”¾å®½ç­›é€‰æ¡ä»¶ã€‚</div>';
      return;
    }

    filtered.forEach((g) => {
      const div = document.createElement("div");
      div.className = "game-card";
      div.innerHTML = `
        <div class="game-cover"></div>
        <div class="game-info">
          <div class="game-name">${g.name}</div>
          <div class="game-meta">
            ç±»å‹ï¼š${g.type.toUpperCase()} Â· å¹³å°ï¼š${g.platforms.join("/")} Â· è¯„åˆ†ï¼š${g.rating.toFixed(
        1
      )}
          </div>
          <div class="game-footer">
            ${
              g.price === 0
                ? '<span class="tag tag--accent">å…è´¹</span>'
                : `<span class="tag">ä»·æ ¼ï¼šÂ¥${g.price}</span>`
            }
            ${g.tags.map((t) => `<span class="tag">${t}</span>`).join("")}
          </div>
        </div>
      `;
      div.addEventListener("click", () => {
        if (g.id === "elden-ring") {
          window.location.href = "game-detail.html";
        }
      });
      libList.appendChild(div);
    });
  }

  libSearch.addEventListener("input", renderList);
  libType.addEventListener("change", renderList);
  libPrice.addEventListener("change", renderList);
  libPlatforms.addEventListener("change", renderList);

  // å¦‚æœæ˜¯ä»é¦–é¡µåˆ†ç±»è·³è½¬è€Œæ¥ï¼Œå¤„ç† URL å‚æ•° cat
  const params = new URLSearchParams(window.location.search);
  const cat = params.get("cat");
  if (cat) {
    if (cat === "action" || cat === "rpg" || cat === "strategy" || cat === "indie" || cat === "multiplayer" || cat === "casual") {
      libType.value = cat;
    } else if (cat === "free") {
      libPrice.value = "free";
    }
  }

  renderList();
</script>
</body>
</html>
