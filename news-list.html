<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox æ¸¸ç›’ - æ¸¸æˆèµ„è®¯</title>
  <!-- Cyberpunk Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="index.css" />
  <style>
    /* èµ„è®¯å¡ç‰‡ä¼˜åŒ–æ ·å¼ */
    .news-card {
      background: linear-gradient(135deg, rgba(10, 10, 10, 0.9) 0%, rgba(20, 0, 30, 0.85) 100%);
      border: 1px solid rgba(255, 211, 0, 0.2);
      border-radius: 8px;
      padding: 0;
      margin-bottom: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      overflow: hidden;
      position: relative;
    }
    
    .news-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, var(--cyber-yellow), var(--cyber-pink));
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }
    
    .news-card:hover {
      border-color: rgba(255, 211, 0, 0.5);
      transform: translateX(5px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
    }
    
    .news-card:hover::before {
      transform: scaleY(1);
    }
    
    .news-card-content {
      padding: 20px;
    }
    
    .news-header {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 12px;
    }
    
    .news-cover {
      width: 120px;
      height: 120px;
      border-radius: 6px;
      background: linear-gradient(135deg, rgba(85, 234, 212, 0.1), rgba(255, 61, 148, 0.1));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      flex-shrink: 0;
      border: 1px solid rgba(85, 234, 212, 0.2);
      overflow: hidden;
    }
    
    .news-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .news-info {
      flex: 1;
      min-width: 0;
    }
    
    .news-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.4;
    }
    
    .news-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    
    .news-meta-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .news-excerpt {
      font-size: 13px;
      color: var(--text-soft);
      line-height: 1.6;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 12px;
    }
    
    .news-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .news-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .news-tag {
      padding: 4px 10px;
      background: rgba(85, 234, 212, 0.15);
      border: 1px solid rgba(85, 234, 212, 0.3);
      border-radius: 4px;
      font-size: 11px;
      color: var(--cyber-cyan);
      font-weight: 600;
    }
    
    .news-tag.hot {
      background: rgba(255, 61, 148, 0.15);
      border-color: rgba(255, 61, 148, 0.3);
      color: var(--cyber-pink);
    }
    
    .news-tag.new {
      background: rgba(255, 211, 0, 0.15);
      border-color: rgba(255, 211, 0, 0.3);
      color: var(--cyber-yellow);
    }
    
    .news-stats {
      display: flex;
      gap: 12px;
      font-size: 11px;
      color: var(--text-muted);
    }
    
    .news-stat {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    /* ç­›é€‰å™¨æ ·å¼ä¼˜åŒ– */
    .filter-tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .filter-tab {
      padding: 8px 16px;
      background: rgba(0, 0, 0, 0.4);
      border: 2px solid rgba(255, 211, 0, 0.3);
      border-radius: 6px;
      color: var(--text-muted);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .filter-tab:hover {
      border-color: var(--cyber-yellow);
      color: var(--cyber-yellow);
    }
    
    .filter-tab.active {
      background: linear-gradient(135deg, rgba(255, 211, 0, 0.2), rgba(255, 61, 148, 0.1));
      border-color: var(--cyber-yellow);
      color: var(--cyber-yellow);
      box-shadow: 0 0 15px rgba(255, 211, 0, 0.3);
    }
    
    @media (max-width: 768px) {
      .news-header {
        flex-direction: column;
      }
      
      .news-cover {
        width: 100%;
        height: 200px;
      }
    }
  </style>
</head>
<body data-current-page="news" class="cyberpunk-theme">
<div class="page">
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>
      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          æ’è¡Œæ¦œ <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">æŠ˜æ‰£ / å²ä½</a>
        <a href="community.html" data-page="community" class="nav-link">ç¤¾åŒº</a>
        <a href="news-list.html" data-page="news" class="nav-link">èµ„è®¯</a>
        <a href="tools.html" data-page="tools" class="nav-link">å·¥å…·</a>
        <a href="my-library.html" data-page="my" class="nav-link">æˆ‘çš„æ¸¸æˆ</a>
        <a href="profile.html" data-page="profile" class="nav-link">ç”¨æˆ·ä¸­å¿ƒ</a>
      </nav>
      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="æœç´¢æ¸¸æˆ / èµ„è®¯ / å¸–å­" />
          <span class="header-search-icon">ğŸ”</span>
        </div>
        <button class="header-user">æœªç™»å½• Â· æ¸¸å®¢</button>
      </div>
    </div>
  </header>
  
  <!-- Cyberpunk Effects -->
  <canvas id="matrix-canvas" class="matrix-bg"></canvas>
  <div id="particles-container" class="particles-container"></div>
  <div id="scroll-progress" class="scroll-progress"></div>
  <div id="loading-overlay" class="loading-overlay">
    <div class="cyberpunk-loader">
      <div class="loader-hexagon"></div>
      <div class="loader-text">LOADING...</div>
    </div>
  </div>

  <main class="main">
    <section>
      <div class="card">
        <div class="page-title">ğŸ“° æ¸¸æˆèµ„è®¯</div>
        <div class="page-intro">
          æœ€æ–°æ¸¸æˆåŠ¨æ€ã€ç‰ˆæœ¬æ›´æ–°ã€æ´»åŠ¨èµ›äº‹ï¼Œä¸€æ‰‹èµ„è®¯å°½åœ¨æŒæ¡ã€‚
        </div>
      </div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span><span>// CATEGORIES</span>
          </div>
        </header>
        <div class="filter-tabs" id="newsCats">
          <button class="filter-tab active" data-type="all">
            <span>ğŸŒ</span>
            <span>å…¨éƒ¨èµ„è®¯</span>
          </button>
          <button class="filter-tab" data-type="update">
            <span>ğŸ”„</span>
            <span>æ›´æ–° / ç‰ˆæœ¬</span>
          </button>
          <button class="filter-tab" data-type="new">
            <span>ğŸ®</span>
            <span>æ–°ä½œ / å‘å”®</span>
          </button>
          <button class="filter-tab" data-type="event">
            <span>ğŸ‰</span>
            <span>æ´»åŠ¨ / èµ›äº‹</span>
          </button>
        </div>
        
        <div style="margin-top: 16px;">
          <input id="newsSearch" type="text" placeholder="ğŸ” æœç´¢èµ„è®¯æ ‡é¢˜ã€æ¸¸æˆåç§°..." style="width: 100%;" />
        </div>
      </div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span><span>èµ„è®¯åˆ—è¡¨</span>
          </div>
          <div class="chip" id="newsCount">å…± 0 æ¡</div>
        </header>
        <div id="newsList" class="news-list" style="max-height: none;"></div>
        
        <div id="loadMoreBtn" style="text-align: center; margin-top: 20px; display: none;">
          <button class="btn btn-primary" onclick="loadMoreNews()">
            ğŸ“° åŠ è½½æ›´å¤šèµ„è®¯
          </button>
        </div>
      </div>
    </section>

    <aside>
      <div class="sidebar-card">
        <div class="sidebar-title">ğŸ”¥ çƒ­é—¨èµ„è®¯</div>
        <div id="hotNewsSidebar"></div>
      </div>
      
      <div class="sidebar-card" style="margin-top: 16px;">
        <div class="sidebar-title">ğŸ“Š ç»Ÿè®¡</div>
        <div class="sidebar-item">
          <span class="label">æ€»èµ„è®¯</span><span class="value" id="totalNews">--</span>
        </div>
        <div class="sidebar-item">
          <span class="label">æœ¬å‘¨æ–°å¢</span><span class="value" id="weekNews">--</span>
        </div>
        <div class="sidebar-item">
          <span class="label">ä»Šæ—¥æ›´æ–°</span><span class="value" id="todayNews">--</span>
        </div>
      </div>
    </aside>
  </main>
</div>

<script src="common.js"></script>
<script src="cyber-effects.js"></script>
<script src="game-cover-fetcher.js"></script>
<script src="news-api.js"></script>
<script src="real-news-api.js"></script>
<script>
  initCommon();
  
  // ä½¿ç”¨çœŸå®APIè¿˜æ˜¯å¤‡ç”¨API
  const USE_REAL_API = true;

  let allNewsData = [];
  let dataLoaded = false;
  let currentPage = 0;
  const PAGE_SIZE = 15;
  let currentFilteredList = [];

  const newsSearch = document.getElementById("newsSearch");
  const newsList = document.getElementById("newsList");
  const newsCount = document.getElementById("newsCount");
  const newsCatsWrap = document.getElementById("newsCats");
  const loadMoreBtn = document.getElementById("loadMoreBtn");

  // æ–°é—»ç±»å‹å›¾æ ‡æ˜ å°„
  const typeIcons = {
    'update': 'ğŸ”„',
    'new': 'ğŸ®',
    'event': 'ğŸ‰'
  };
  
  const typeNames = {
    'update': 'æ›´æ–°/ç‰ˆæœ¬',
    'new': 'æ–°ä½œ/å‘å”®',
    'event': 'æ´»åŠ¨/èµ›äº‹'
  };
  
  // ä½¿ç”¨ç»Ÿä¸€çš„æ¸¸æˆå°é¢API
  // game-covers.js å·²ç»åŠ è½½ï¼ŒåŒ…å«100+æ¸¸æˆçš„å°é¢æ•°æ®åº“

  function getCurrentCat() {
    const active = newsCatsWrap.querySelector(".filter-tab.active");
    return active ? active.dataset.type : "all";
  }

  // åŠ è½½æ‰€æœ‰æ–°é—»æ•°æ®
  async function loadAllNews() {
    try {
      newsList.innerHTML = '<div style="font-size:13px;color:var(--text-muted);padding:40px;text-align:center;">ğŸ“° æ­£åœ¨åŠ è½½çœŸå®æ¸¸æˆèµ„è®¯...</div>';
      
      // ä¼˜å…ˆä½¿ç”¨çœŸå®API
      if (USE_REAL_API && window.realNewsAPI) {
        console.log('ğŸ”„ ä½¿ç”¨çœŸå®æ¸¸æˆèµ„è®¯API...');
        allNewsData = await window.realNewsAPI.getAllRealNews();
        
        // å¦‚æœçœŸå®APIè¿”å›æ•°æ®å°‘äº10æ¡ï¼Œè¡¥å……å¤‡ç”¨æ•°æ®
        if (allNewsData.length < 10) {
          console.log('âš ï¸ çœŸå®APIæ•°æ®ä¸è¶³ï¼Œè¡¥å……å¤‡ç”¨æ•°æ®');
          const fallbackData = await window.newsAPI.getAllNews();
          allNewsData = allNewsData.concat(fallbackData.slice(0, 50));
        }
      } else {
        allNewsData = await window.newsAPI.getAllNews();
      }
      
      dataLoaded = true;
      console.log(`âœ… æˆåŠŸåŠ è½½ ${allNewsData.length} æ¡èµ„è®¯`);
      
      // æ›´æ–°ç»Ÿè®¡æ•°æ®
      updateStats();
      
      // æ¸²æŸ“çƒ­é—¨èµ„è®¯
      renderHotNews();
      
      applyFiltersAndRender();
    } catch (err) {
      console.error("åŠ è½½æ–°é—»å¤±è´¥:", err);
      newsList.innerHTML = `
        <div style="text-align: center; color: var(--danger); padding: 40px;">
          âŒ èµ„è®¯æ•°æ®åŠ è½½å¤±è´¥<br>
          <span style="font-size: 11px; opacity: 0.8;">é”™è¯¯: ${err.message}</span>
        </div>
      `;
    }
  }

  // æ›´æ–°ç»Ÿè®¡æ•°æ®
  function updateStats() {
    const today = new Date().toISOString().split('T')[0];
    const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
    
    const todayCount = allNewsData.filter(n => n.date === today).length;
    const weekCount = allNewsData.filter(n => n.date >= oneWeekAgo).length;
    
    document.getElementById('totalNews').textContent = allNewsData.length;
    document.getElementById('weekNews').textContent = weekCount;
    document.getElementById('todayNews').textContent = todayCount;
  }

  // æ¸²æŸ“çƒ­é—¨èµ„è®¯
  function renderHotNews() {
    const hotNews = allNewsData
      .sort((a, b) => (b.views + b.comments * 10) - (a.views + a.comments * 10))
      .slice(0, 5);
    
    const container = document.getElementById('hotNewsSidebar');
    container.innerHTML = hotNews.map((news, index) => `
      <div class="sidebar-item" style="cursor: pointer; padding: 8px; border-radius: 4px; transition: all 0.3s;" 
           onmouseover="this.style.background='rgba(255, 211, 0, 0.1)'" 
           onmouseout="this.style.background='transparent'"
           onclick="window.location.href='news-detail.html?id=${news.id}'">
        <span class="label" style="color: var(--cyber-pink); font-weight: 700;">${index + 1}</span>
        <span class="value" style="font-size: 12px; line-height: 1.4;">${news.title.substring(0, 30)}...</span>
      </div>
    `).join('');
  }

  // åº”ç”¨ç­›é€‰æ¡ä»¶å¹¶æ¸²æŸ“
  function applyFiltersAndRender() {
    if (!dataLoaded) {
      newsList.innerHTML = '<div style="font-size:13px;color:var(--text-muted);padding:40px;text-align:center;">ğŸ“° æ­£åœ¨åŠ è½½èµ„è®¯æ•°æ®...</div>';
      return;
    }

    const cat = getCurrentCat();
    const kw = newsSearch.value.trim().toLowerCase();

    currentFilteredList = allNewsData.filter((n) => {
      if (cat !== "all" && n.type !== cat) return false;
      if (kw) {
        const text = `${n.title} ${n.game} ${n.summary}`.toLowerCase();
        if (!text.includes(kw)) return false;
      }
      return true;
    });

    // æŒ‰æ—¥æœŸé™åºæ’åº
    currentFilteredList.sort((a, b) => b.date.localeCompare(a.date));

    // é‡ç½®åˆ†é¡µå¹¶æ¸²æŸ“
    currentPage = 0;
    newsList.innerHTML = "";
    newsCount.textContent = `å…± ${currentFilteredList.length} æ¡`;

    if (!currentFilteredList.length) {
      newsList.innerHTML = '<div style="font-size:13px;color:var(--text-muted);padding:40px;text-align:center;">ğŸ“° æš‚æ— ç¬¦åˆæ¡ä»¶çš„èµ„è®¯</div>';
      loadMoreBtn.style.display = 'none';
      return;
    }

    loadMoreNews();
  }

  // åŠ è½½æ›´å¤šæ–°é—»
  window.loadMoreNews = function() {
    const startIdx = currentPage * PAGE_SIZE;
    const endIdx = startIdx + PAGE_SIZE;
    const pageItems = currentFilteredList.slice(startIdx, endIdx);
    
    if (!pageItems.length) {
      loadMoreBtn.style.display = 'none';
      return;
    }

    pageItems.forEach((n) => {
      const div = document.createElement("div");
      div.className = "news-card";
      
      // è·å–å›¾æ ‡
      const typeIcon = typeIcons[n.type] || "ğŸ“°";
      const typeName = typeNames[n.type] || "èµ„è®¯";
      
      // ä½¿ç”¨æ™ºèƒ½å°é¢è·å–ç³»ç»Ÿï¼ˆåŒæ­¥ç‰ˆæœ¬ï¼‰
      const gameCover = window.gameCoverFetcher.getGameCover(n.game || n.gameEn || 'æœªçŸ¥æ¸¸æˆ');
      
      // åˆ¤æ–­æ˜¯å¦ä¸ºçƒ­é—¨æˆ–æ–°èµ„è®¯
      const isHot = n.views > 20000 || n.comments > 100;
      const isNew = new Date(n.date).getTime() > Date.now() - 3 * 24 * 60 * 60 * 1000; // 3å¤©å†…
      
      div.innerHTML = `
        <div class="news-card-content">
          <div class="news-header">
            <div class="news-cover">
              <img src="${gameCover}" alt="${n.game}" onerror="this.style.display='none'; this.parentElement.textContent='ğŸ®';" />
            </div>
            <div class="news-info">
              <div class="news-title">${n.title}</div>
              <div class="news-meta">
                <span class="news-meta-item">${typeIcon} ${typeName}</span>
                <span class="news-meta-item">ğŸ¯ ${n.game}</span>
                <span class="news-meta-item">ğŸ“… ${n.date}</span>
              </div>
              <div class="news-excerpt">${n.summary}</div>
              <div class="news-footer">
                <div class="news-tags">
                  ${isHot ? '<span class="news-tag hot">ğŸ”¥ çƒ­é—¨</span>' : ''}
                  ${isNew ? '<span class="news-tag new">âœ¨ æœ€æ–°</span>' : ''}
                  <span class="news-tag">${n.game}</span>
                </div>
                <div class="news-stats">
                  <span class="news-stat">ğŸ‘ï¸ ${n.views.toLocaleString()}</span>
                  <span class="news-stat">ğŸ’¬ ${n.comments}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      // æ·»åŠ ç‚¹å‡»äº‹ä»¶
      div.addEventListener("click", () => {
        window.location.href = `news-detail.html?id=${n.id}`;
      });
      
      newsList.appendChild(div);
    });
    
    currentPage++;
    
    // æ˜¾ç¤º/éšè—åŠ è½½æ›´å¤šæŒ‰é’®
    if (endIdx >= currentFilteredList.length) {
      loadMoreBtn.style.display = 'none';
    } else {
      loadMoreBtn.style.display = 'block';
    }
  };

  // åˆ†ç±»åˆ‡æ¢
  newsCatsWrap.addEventListener("click", (e) => {
    const tab = e.target.closest(".filter-tab");
    if (!tab) return;
    
    // æ›´æ–°æ¿€æ´»çŠ¶æ€
    newsCatsWrap.querySelectorAll(".filter-tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    
    applyFiltersAndRender();
  });

  // æœç´¢
  newsSearch.addEventListener("input", applyFiltersAndRender);

  // åˆå§‹åŠ è½½
  loadAllNews();
</script>
</body>
</html>
