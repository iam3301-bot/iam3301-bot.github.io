<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox æ¸¸ç›’ - æŠ˜æ‰£ä¸å²ä½</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="index.css" />
</head>
<body data-current-page="discount">
<div class="page">
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>
      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="news-list.html" data-page="news" class="nav-link">èµ„è®¯</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          æ’è¡Œæ¦œ <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">æŠ˜æ‰£ / å²ä½</a>
        <a href="community.html" data-page="community" class="nav-link">ç¤¾åŒº</a>
        <a href="my-library.html" data-page="my" class="nav-link">æˆ‘çš„æ¸¸æˆ</a>
        <a href="tools.html" data-page="tools" class="nav-link">å·¥å…·ä¸­å¿ƒ</a>
        <a href="profile.html" data-page="profile" class="nav-link">ç”¨æˆ·ä¸­å¿ƒ</a>
      </nav>
      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="æœç´¢æ¸¸æˆ / èµ„è®¯ / å¸–å­" />
          <span class="header-search-icon">ğŸ”</span>
        </div>
        <button class="header-user">æœªç™»å½• Â· æ¸¸å®¢</button>
      </div>
    </div>
  </header>

  <main class="main">
    <section>
      <div class="card">
        <div class="page-title">æŠ˜æ‰£ä¸å²ä½</div>
        <div class="page-intro">
          å±•ç¤ºç¤ºä¾‹æ¸¸æˆçš„æŠ˜æ‰£ä¿¡æ¯ï¼Œå¯æŒ‰æŠ˜æ‰£åŠ›åº¦è¿‡æ»¤ï¼Œå¹¶å¯åªçœ‹â€œå²ä½â€ä»·æ ¼ã€‚
        </div>
      </div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span><span>ç­›é€‰æ¡ä»¶</span>
          </div>
        </header>
        <div class="form">
          <div class="form-row">
            <label for="discSearch">æŒ‰åç§°æœç´¢</label>
            <input id="discSearch" type="text" placeholder="ä¾‹å¦‚ï¼šèµ›åšæœ‹å…‹ 2077" />
          </div>
          <div class="form-row">
            <label for="discFilter">æŠ˜æ‰£åŠ›åº¦</label>
            <select id="discFilter">
              <option value="all">å…¨éƒ¨æŠ˜æ‰£</option>
              <option value="20">â‰¥ 20%</option>
              <option value="50">â‰¥ 50%</option>
              <option value="70">â‰¥ 70%</option>
            </select>
          </div>
          <div class="form-row">
            <label>
              <input type="checkbox" id="discLowOnly" />
              åªçœ‹å²ä½
            </label>
          </div>
        </div>
      </div>

      <div class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span><span>å½“å‰æŠ˜æ‰£</span>
          </div>
          <div class="chip" id="discCount">å…± 0 æ¬¾</div>
        </header>
        <div id="discList" class="game-list"></div>
      </div>
    </section>

    <aside>
      <div class="sidebar-card">
        <div class="sidebar-title">è¯´æ˜</div>
        <div class="sidebar-item">
          <span class="label">â€œå²ä½â€</span><span class="value">ç¤ºä¾‹å±æ€§</span>
        </div>
        <div class="sidebar-item">
          <span class="label">æ•°æ®</span><span class="value">å‰ç«¯å‡æ•°æ®</span>
        </div>
      </div>
    </aside>
  </main>
</div>

<script src="common.js"></script>
<script>
  initCommon();

  const discountData = [
    { id: "cp2077", name: "èµ›åšæœ‹å…‹ 2077", platform: "Steam", oldPrice: 298, nowPrice: 149, low: true },
    { id: "elden-ring", name: "è‰¾å°”ç™»æ³•ç¯", platform: "Steam", oldPrice: 298, nowPrice: 209, low: false },
    { id: "hollow-knight", name: "ç©ºæ´éª‘å£«", platform: "Steam", oldPrice: 48, nowPrice: 19, low: true },
    { id: "mh-rise", name: "æ€ªç‰©çŒäººï¼šå´›èµ·", platform: "Switch / PC", oldPrice: 268, nowPrice: 134, low: false },
    { id: "stardew", name: "æ˜Ÿéœ²è°·ç‰©è¯­", platform: "å¤šå¹³å°", oldPrice: 36, nowPrice: 18, low: true },
  ];

  function calcOff(item) {
    return Math.round((1 - item.nowPrice / item.oldPrice) * 100);
  }

  const discSearch = document.getElementById("discSearch");
  const discFilter = document.getElementById("discFilter");
  const discLowOnly = document.getElementById("discLowOnly");
  const discList = document.getElementById("discList");
  const discCount = document.getElementById("discCount");

  function renderDiscount() {
    const kw = discSearch.value.trim().toLowerCase();
    const off = discFilter.value; // all / 20 / 50 / 70
    const lowOnly = discLowOnly.checked;

    let list = discountData.filter((item) => {
      if (kw) {
        const text = (item.name + " " + item.platform).toLowerCase();
        if (!text.includes(kw)) return false;
      }
      const offVal = calcOff(item);
      if (off !== "all" && offVal < Number(off)) return false;
      if (lowOnly && !item.low) return false;
      return true;
    });

    // æŒ‰æŠ˜æ‰£åŠ›åº¦ä»é«˜åˆ°ä½
    list.sort((a, b) => calcOff(b) - calcOff(a));

    discList.innerHTML = "";
    discCount.textContent = `å…± ${list.length} æ¬¾`;

    if (!list.length) {
      discList.innerHTML =
        '<div style="font-size:12px;color:var(--text-muted);">å½“å‰æ¡ä»¶ä¸‹æ²¡æœ‰æŠ˜æ‰£æ¸¸æˆã€‚</div>';
      return;
    }

    list.forEach((item) => {
      const offVal = calcOff(item);
      const div = document.createElement("div");
      div.className = "game-card";
      div.innerHTML = `
        <div class="game-info">
          <div class="game-name">${item.name}</div>
          <div class="game-meta">${item.platform}</div>
          <div class="game-footer">
            <span class="tag">åŸä»·ï¼šÂ¥${item.oldPrice}</span>
            <span class="tag tag--accent">ç°ä»·ï¼šÂ¥${item.nowPrice}</span>
            <span class="tag tag--danger">-${offVal}%</span>
            ${item.low ? '<span class="tag tag--accent">å²ä½</span>' : ""}
          </div>
        </div>
      `;
      div.addEventListener("click", () => {
        if (item.id === "elden-ring") {
          window.location.href = "game-detail.html";
        }
      });
      discList.appendChild(div);
    });
  }

  discSearch.addEventListener("input", renderDiscount);
  discFilter.addEventListener("change", renderDiscount);
  discLowOnly.addEventListener("change", renderDiscount);
  renderDiscount();
</script>
</body>
</html>
