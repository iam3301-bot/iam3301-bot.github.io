<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Steam è´¦å·ç»‘å®šå‘å¯¼ - GameBox æ¸¸ç›’</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css">
  <style>
    .bind-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .bind-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .bind-header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 36px;
      color: var(--accent);
      margin-bottom: 10px;
      text-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
    }

    .bind-header p {
      color: var(--text-muted);
      font-size: 16px;
    }

    /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
    .steps-indicator {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .step-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid rgba(56, 189, 248, 0.2);
      border-radius: 30px;
      transition: all 0.3s ease;
    }

    .step-item.active {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.1);
    }

    .step-item.completed {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.1);
    }

    .step-number {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(56, 189, 248, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      color: var(--accent);
    }

    .step-item.active .step-number {
      background: var(--accent);
      color: #000;
    }

    .step-item.completed .step-number {
      background: #10b981;
      color: #fff;
    }

    .step-item.completed .step-number::after {
      content: 'âœ“';
    }

    .step-item.completed .step-number span {
      display: none;
    }

    .step-text {
      color: var(--text-muted);
      font-size: 14px;
    }

    .step-item.active .step-text,
    .step-item.completed .step-text {
      color: var(--text-soft);
    }

    /* æ­¥éª¤å†…å®¹åŒºåŸŸ */
    .step-content {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .step-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* å¡ç‰‡æ ·å¼ */
    .bind-card {
      background: linear-gradient(135deg, rgba(17, 24, 39, 0.95), rgba(31, 41, 55, 0.9));
      border: 1px solid rgba(56, 189, 248, 0.3);
      border-radius: 16px;
      padding: 30px;
      margin-bottom: 20px;
    }

    .bind-card h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      color: var(--accent);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .bind-card h2 .icon {
      font-size: 32px;
    }

    /* æ•™ç¨‹æ­¥éª¤ */
    .tutorial-steps {
      counter-reset: tutorial;
    }

    .tutorial-step {
      position: relative;
      padding: 20px;
      padding-left: 60px;
      margin-bottom: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      border-left: 3px solid var(--accent);
    }

    .tutorial-step::before {
      counter-increment: tutorial;
      content: counter(tutorial);
      position: absolute;
      left: 15px;
      top: 20px;
      width: 30px;
      height: 30px;
      background: var(--accent);
      color: #000;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
    }

    .tutorial-step h4 {
      color: var(--text-soft);
      font-size: 16px;
      margin-bottom: 10px;
    }

    .tutorial-step p {
      color: var(--text-muted);
      font-size: 14px;
      line-height: 1.6;
    }

    .tutorial-step a {
      color: var(--accent);
      text-decoration: none;
    }

    .tutorial-step a:hover {
      text-decoration: underline;
    }

    .tutorial-step img {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 15px;
      border: 1px solid rgba(56, 189, 248, 0.3);
    }

    /* è¾“å…¥æ¡† */
    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      color: var(--text-soft);
      font-size: 14px;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .input-group input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(56, 189, 248, 0.3);
      border-radius: 8px;
      color: var(--text-soft);
      font-size: 15px;
      transition: all 0.3s ease;
    }

    .input-group input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 15px rgba(56, 189, 248, 0.2);
    }

    .input-group input::placeholder {
      color: var(--text-muted);
    }

    .input-hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    /* æŒ‰é’® */
    .btn {
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      font-family: 'Rajdhani', sans-serif;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #00ff88);
      color: #000;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(56, 189, 248, 0.3);
    }

    .btn-secondary {
      background: rgba(56, 189, 248, 0.1);
      color: var(--accent);
      border: 1px solid var(--accent);
    }

    .btn-secondary:hover {
      background: rgba(56, 189, 248, 0.2);
    }

    .btn-steam {
      background: linear-gradient(135deg, #1b2838, #2a475e);
      color: #fff;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-size: 16px;
      padding: 16px 32px;
    }

    .btn-steam:hover {
      background: linear-gradient(135deg, #2a475e, #3d6a8a);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(27, 40, 56, 0.5);
    }

    .btn-steam svg {
      width: 24px;
      height: 24px;
    }

    .btn-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
      flex-wrap: wrap;
    }

    /* è­¦å‘Šå’Œæç¤º */
    .alert {
      padding: 16px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }

    .alert-info {
      background: rgba(56, 189, 248, 0.1);
      border: 1px solid rgba(56, 189, 248, 0.3);
      color: var(--accent);
    }

    .alert-warning {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: #f59e0b;
    }

    .alert-success {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: #10b981;
    }

    .alert-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .alert-content {
      flex: 1;
    }

    .alert-content strong {
      display: block;
      margin-bottom: 4px;
    }

    /* ä»£ç å— */
    .code-block {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(56, 189, 248, 0.2);
      border-radius: 8px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      color: #10b981;
      margin: 15px 0;
      overflow-x: auto;
      position: relative;
    }

    .code-block .copy-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      padding: 6px 12px;
      font-size: 12px;
      background: rgba(56, 189, 248, 0.2);
      border: none;
      border-radius: 4px;
      color: var(--accent);
      cursor: pointer;
    }

    .code-block .copy-btn:hover {
      background: rgba(56, 189, 248, 0.3);
    }

    /* ç»‘å®šç»“æœ */
    .bind-result {
      text-align: center;
      padding: 40px;
    }

    .bind-result .success-icon {
      font-size: 80px;
      margin-bottom: 20px;
    }

    .bind-result h3 {
      font-size: 28px;
      color: #10b981;
      margin-bottom: 15px;
    }

    .bind-result p {
      color: var(--text-muted);
      font-size: 16px;
      margin-bottom: 30px;
    }

    /* Steam ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */
    .steam-profile {
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      margin: 20px 0;
    }

    .steam-avatar {
      width: 80px;
      height: 80px;
      border-radius: 8px;
      border: 2px solid var(--accent);
    }

    .steam-info h4 {
      font-size: 20px;
      color: var(--text-soft);
      margin-bottom: 5px;
    }

    .steam-info p {
      color: var(--text-muted);
      font-size: 14px;
    }

    .steam-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .stat-card {
      background: rgba(0, 0, 0, 0.3);
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .stat-card .value {
      font-size: 28px;
      font-weight: 700;
      color: var(--accent);
      font-family: 'Orbitron', sans-serif;
    }

    .stat-card .label {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 5px;
    }

    /* åŠ è½½çŠ¶æ€ */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(56, 189, 248, 0.2);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading p {
      color: var(--text-muted);
      margin-top: 20px;
      font-size: 16px;
    }

    /* FAQ æŠ˜å é¢æ¿ */
    .faq-item {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      margin-bottom: 10px;
      overflow: hidden;
    }

    .faq-question {
      padding: 16px 20px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--text-soft);
      font-weight: 600;
    }

    .faq-question:hover {
      background: rgba(56, 189, 248, 0.05);
    }

    .faq-question .arrow {
      transition: transform 0.3s ease;
    }

    .faq-item.open .faq-question .arrow {
      transform: rotate(180deg);
    }

    .faq-answer {
      padding: 0 20px;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .faq-item.open .faq-answer {
      padding: 0 20px 20px;
      max-height: 500px;
    }

    .faq-answer p {
      color: var(--text-muted);
      font-size: 14px;
      line-height: 1.6;
    }

    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .bind-header h1 {
        font-size: 28px;
      }

      .steps-indicator {
        flex-direction: column;
        align-items: center;
      }

      .tutorial-step {
        padding-left: 50px;
      }

      .steam-profile {
        flex-direction: column;
        text-align: center;
      }

      .btn-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        text-align: center;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="bind-container">
    <!-- å¤´éƒ¨ -->
    <div class="bind-header">
      <h1>ğŸ® Steam è´¦å·ç»‘å®šå‘å¯¼</h1>
      <p>æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼Œå°†æ‚¨çš„ Steam è´¦å·ä¸ GameBox å…³è”ï¼ŒåŒæ­¥æ‚¨çš„æ¸¸æˆåº“</p>
    </div>

    <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
    <div class="steps-indicator">
      <div class="step-item active" data-step="1">
        <div class="step-number"><span>1</span></div>
        <span class="step-text">è·å– API Key</span>
      </div>
      <div class="step-item" data-step="2">
        <div class="step-number"><span>2</span></div>
        <span class="step-text">Steam ç™»å½•éªŒè¯</span>
      </div>
      <div class="step-item" data-step="3">
        <div class="step-number"><span>3</span></div>
        <span class="step-text">ç¡®è®¤ç»‘å®š</span>
      </div>
      <div class="step-item" data-step="4">
        <div class="step-number"><span>4</span></div>
        <span class="step-text">å®Œæˆ</span>
      </div>
    </div>

    <!-- æ­¥éª¤1: è·å– API Key -->
    <div class="step-content active" id="step1">
      <div class="bind-card">
        <h2><span class="icon">ğŸ”‘</span> ç¬¬ä¸€æ­¥ï¼šè·å– Steam API Key</h2>
        
        <div class="alert alert-info">
          <span class="alert-icon">â„¹ï¸</span>
          <div class="alert-content">
            <strong>ä»€ä¹ˆæ˜¯ Steam API Keyï¼Ÿ</strong>
            Steam API Key æ˜¯ Steam å®˜æ–¹æä¾›çš„å¯†é’¥ï¼Œç”¨äºå®‰å…¨åœ°è®¿é—®æ‚¨çš„æ¸¸æˆæ•°æ®ã€‚æ¯ä¸ª Steam ç”¨æˆ·éƒ½å¯ä»¥å…è´¹è·å–ã€‚
          </div>
        </div>

        <div class="tutorial-steps">
          <div class="tutorial-step">
            <h4>è®¿é—® Steam API Key æ³¨å†Œé¡µé¢</h4>
            <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œæ‰“å¼€ Steam å®˜æ–¹ API Key æ³¨å†Œé¡µé¢ï¼š</p>
            <div style="margin-top: 15px;">
              <a href="https://steamcommunity.com/dev/apikey" target="_blank" class="btn btn-steam">
                <svg viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                æ‰“å¼€ Steam API Key é¡µé¢
              </a>
            </div>
          </div>

          <div class="tutorial-step">
            <h4>ç™»å½•æ‚¨çš„ Steam è´¦å·</h4>
            <p>å¦‚æœæ‚¨å°šæœªç™»å½•ï¼Œè¯·ä½¿ç”¨æ‚¨çš„ Steam è´¦å·ç™»å½•ã€‚ç¡®ä¿è¿™æ˜¯æ‚¨æƒ³è¦ç»‘å®šçš„è´¦å·ã€‚</p>
          </div>

          <div class="tutorial-step">
            <h4>å¡«å†™åŸŸåä¿¡æ¯</h4>
            <p>åœ¨ "Domain Name" å­—æ®µä¸­ï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹ï¼š</p>
            <div class="code-block">
              localhost
              <button class="copy-btn" onclick="copyToClipboard('localhost')">å¤åˆ¶</button>
            </div>
            <p style="margin-top: 10px; font-size: 13px; color: var(--text-muted);">
              ğŸ’¡ æç¤ºï¼šä¸ªäººä½¿ç”¨å¡«å†™ "localhost" å³å¯ï¼Œæ— éœ€çœŸå®åŸŸå
            </p>
          </div>

          <div class="tutorial-step">
            <h4>åŒæ„æ¡æ¬¾å¹¶æ³¨å†Œ</h4>
            <p>å‹¾é€‰ "I agree to the Steam Web API Terms of Use"ï¼ˆæˆ‘åŒæ„ Steam Web API ä½¿ç”¨æ¡æ¬¾ï¼‰ï¼Œç„¶åç‚¹å‡» "Register"ï¼ˆæ³¨å†Œï¼‰æŒ‰é’®ã€‚</p>
          </div>

          <div class="tutorial-step">
            <h4>å¤åˆ¶æ‚¨çš„ API Key</h4>
            <p>æ³¨å†ŒæˆåŠŸåï¼Œé¡µé¢ä¼šæ˜¾ç¤ºæ‚¨çš„ API Keyï¼Œæ ¼å¼ç±»ä¼¼ï¼š</p>
            <div class="code-block">
              XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
              <span style="color: var(--text-muted);">ï¼ˆ32ä½å­—ç¬¦ï¼‰</span>
            </div>
            <p style="margin-top: 10px;">è¯·å¤åˆ¶è¿™ä¸ª Keyï¼Œå¹¶ç²˜è´´åˆ°ä¸‹æ–¹è¾“å…¥æ¡†ä¸­ã€‚</p>
          </div>
        </div>

        <div class="alert alert-warning">
          <span class="alert-icon">âš ï¸</span>
          <div class="alert-content">
            <strong>å®‰å…¨æç¤º</strong>
            è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„ API Keyï¼Œä¸è¦åˆ†äº«ç»™ä»–äººã€‚API Key ä»…ç”¨äºè·å–æ‚¨è‡ªå·±çš„æ¸¸æˆæ•°æ®ï¼Œä¸ä¼šå½±å“æ‚¨çš„ Steam è´¦å·å®‰å…¨ã€‚
          </div>
        </div>

        <div class="input-group">
          <label for="apiKey">è¯·è¾“å…¥æ‚¨çš„ Steam API Key</label>
          <input type="text" id="apiKey" placeholder="ç²˜è´´æ‚¨çš„32ä½ Steam API Key" maxlength="32">
          <p class="input-hint">API Key æ˜¯32ä½å­—æ¯æ•°å­—ç»„åˆï¼Œä¾‹å¦‚ï¼šA1B2C3D4E5F6G7H8I9J0K1L2M3N4O5P6</p>
        </div>

        <div class="btn-group">
          <button class="btn btn-primary" onclick="validateApiKeyAndNext()">éªŒè¯å¹¶ç»§ç»­</button>
          <button class="btn btn-secondary" onclick="skipApiKey()">è·³è¿‡æ­¤æ­¥éª¤ï¼ˆä½¿ç”¨å…¬å…±æ•°æ®ï¼‰</button>
        </div>
      </div>

      <!-- FAQ -->
      <div class="bind-card">
        <h2><span class="icon">â“</span> å¸¸è§é—®é¢˜</h2>
        
        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            ä¸ºä»€ä¹ˆéœ€è¦ API Keyï¼Ÿ
            <span class="arrow">â–¼</span>
          </div>
          <div class="faq-answer">
            <p>API Key ç”¨äºå®‰å…¨åœ°è®¿é—® Steam çš„å®˜æ–¹æ•°æ®æ¥å£ã€‚æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥è·å–æ‚¨çš„å®Œæ•´æ¸¸æˆåº“ã€æ¸¸æˆæ—¶é•¿ã€æˆå°±ç­‰ä¿¡æ¯ã€‚æ²¡æœ‰ API Keyï¼Œæˆ‘ä»¬åªèƒ½è·å–å…¬å¼€çš„åŸºç¡€ä¿¡æ¯ã€‚</p>
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            API Key ä¼šæ³„éœ²æˆ‘çš„è´¦å·å—ï¼Ÿ
            <span class="arrow">â–¼</span>
          </div>
          <div class="faq-answer">
            <p>ä¸ä¼šã€‚API Key åªèƒ½ç”¨äºè¯»å–æ•°æ®ï¼Œæ— æ³•è¿›è¡Œä»»ä½•è´¦å·æ“ä½œï¼ˆå¦‚ä¿®æ”¹å¯†ç ã€è´­ä¹°æ¸¸æˆç­‰ï¼‰ã€‚å³ä½¿æ³„éœ²ï¼Œä¹Ÿä¸ä¼šå¯¹æ‚¨çš„è´¦å·é€ æˆä»»ä½•å½±å“ã€‚æ‚¨éšæ—¶å¯ä»¥åœ¨ Steam é‡æ–°ç”Ÿæˆæ–°çš„ Keyã€‚</p>
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            æˆ‘çš„ API Key ä¼šè¢«å­˜å‚¨å—ï¼Ÿ
            <span class="arrow">â–¼</span>
          </div>
          <div class="faq-answer">
            <p>æ‚¨çš„ API Key ä»…å­˜å‚¨åœ¨æ‚¨çš„æµè§ˆå™¨æœ¬åœ°ï¼ˆLocalStorageï¼‰ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚æ‚¨å¯ä»¥éšæ—¶åœ¨è®¾ç½®ä¸­æ¸…é™¤ã€‚</p>
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            æ²¡æœ‰ API Key å¯ä»¥ç»‘å®šå—ï¼Ÿ
            <span class="arrow">â–¼</span>
          </div>
          <div class="faq-answer">
            <p>å¯ä»¥ï¼Œä½†åŠŸèƒ½ä¼šå—é™ã€‚æ²¡æœ‰ API Key æ—¶ï¼Œæˆ‘ä»¬åªèƒ½è·å–æ‚¨è®¾ç½®ä¸ºå…¬å¼€çš„æ¸¸æˆæ•°æ®ã€‚å»ºè®®è·å– API Key ä»¥è·å¾—æœ€ä½³ä½“éªŒã€‚</p>
          </div>
        </div>
      </div>
    </div>

    <!-- æ­¥éª¤2: Steam ç™»å½•éªŒè¯ -->
    <div class="step-content" id="step2">
      <div class="bind-card">
        <h2><span class="icon">ğŸ”</span> ç¬¬äºŒæ­¥ï¼šSteam è´¦å·éªŒè¯</h2>

        <div class="alert alert-info">
          <span class="alert-icon">â„¹ï¸</span>
          <div class="alert-content">
            <strong>å®‰å…¨çš„ Steam ç™»å½•</strong>
            ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åï¼Œæ‚¨å°†è¢«è·³è½¬åˆ° Steam å®˜æ–¹ç™»å½•é¡µé¢è¿›è¡Œèº«ä»½éªŒè¯ã€‚è¿™æ˜¯ Steam å®˜æ–¹çš„ OpenID è®¤è¯ï¼Œæˆ‘ä»¬ä¸ä¼šè·å–æ‚¨çš„å¯†ç ã€‚
          </div>
        </div>

        <div style="text-align: center; padding: 40px 0;">
          <p style="color: var(--text-muted); margin-bottom: 30px; font-size: 16px;">
            è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ï¼Œä½¿ç”¨ Steam è´¦å·ç™»å½•éªŒè¯
          </p>
          <button class="btn btn-steam" onclick="steamLogin()" style="font-size: 18px; padding: 18px 40px;">
            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 28px; height: 28px;">
              <path d="M12 2C6.48 2 2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95 0-5.52-4.48-10-10-10z"/>
            </svg>
            é€šè¿‡ Steam ç™»å½•
          </button>
        </div>

        <div class="alert alert-warning">
          <span class="alert-icon">ğŸ’¡</span>
          <div class="alert-content">
            <strong>ç™»å½•é¡»çŸ¥</strong>
            <ul style="margin-top: 10px; padding-left: 20px;">
              <li>ç¡®ä¿æ‚¨ç™»å½•çš„æ˜¯æ­£ç¡®çš„ Steam è´¦å·</li>
              <li>ç™»å½•è¿‡ç¨‹åœ¨ Steam å®˜æ–¹é¡µé¢å®Œæˆ</li>
              <li>æˆ‘ä»¬åªè·å–æ‚¨çš„ Steam ID å’Œå…¬å¼€ä¿¡æ¯</li>
            </ul>
          </div>
        </div>

        <div class="btn-group">
          <button class="btn btn-secondary" onclick="goToStep(1)">â† è¿”å›ä¸Šä¸€æ­¥</button>
        </div>
      </div>
    </div>

    <!-- æ­¥éª¤3: ç¡®è®¤ç»‘å®š -->
    <div class="step-content" id="step3">
      <div class="bind-card">
        <h2><span class="icon">âœ…</span> ç¬¬ä¸‰æ­¥ï¼šç¡®è®¤ç»‘å®šä¿¡æ¯</h2>

        <div id="steamProfilePreview">
          <!-- Steam ç”¨æˆ·ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
          <div class="loading">
            <div class="loading-spinner"></div>
            <p>æ­£åœ¨è·å– Steam è´¦å·ä¿¡æ¯...</p>
          </div>
        </div>

        <div id="confirmButtons" style="display: none;">
          <div class="alert alert-success">
            <span class="alert-icon">âœ“</span>
            <div class="alert-content">
              <strong>ä¿¡æ¯è·å–æˆåŠŸ</strong>
              è¯·ç¡®è®¤ä»¥ä¸Šä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Œç¡®è®¤åå°†å®Œæˆç»‘å®šã€‚
            </div>
          </div>

          <div class="btn-group">
            <button class="btn btn-primary" onclick="confirmBinding()">ç¡®è®¤ç»‘å®š</button>
            <button class="btn btn-secondary" onclick="goToStep(2)">è¿”å›é‡æ–°éªŒè¯</button>
          </div>
        </div>
      </div>
    </div>

    <!-- æ­¥éª¤4: å®Œæˆ -->
    <div class="step-content" id="step4">
      <div class="bind-card">
        <div class="bind-result">
          <div class="success-icon">ğŸ‰</div>
          <h3>ç»‘å®šæˆåŠŸï¼</h3>
          <p>æ‚¨çš„ Steam è´¦å·å·²æˆåŠŸå…³è”åˆ° GameBox</p>

          <div id="finalStats" class="steam-stats">
            <!-- æœ€ç»ˆç»Ÿè®¡æ•°æ® -->
          </div>

          <div class="btn-group" style="justify-content: center; margin-top: 40px;">
            <a href="profile.html" class="btn btn-primary">å‰å¾€ç”¨æˆ·ä¸­å¿ƒ</a>
            <a href="accounts.html" class="btn btn-secondary">ç®¡ç†æ¸¸æˆè´¦å·</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="supabase-config.js"></script>
  <script>
    // =============================================
    // Steam ç»‘å®šå‘å¯¼è„šæœ¬
    // =============================================

    let currentStep = 1;
    let steamApiKey = '';
    let steamUserData = null;

    // æ­¥éª¤æ§åˆ¶
    function goToStep(step) {
      // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
      document.querySelectorAll('.step-item').forEach((item, index) => {
        item.classList.remove('active');
        if (index + 1 < step) {
          item.classList.add('completed');
        } else if (index + 1 === step) {
          item.classList.add('active');
          item.classList.remove('completed');
        } else {
          item.classList.remove('completed');
        }
      });

      // æ˜¾ç¤ºå¯¹åº”æ­¥éª¤å†…å®¹
      document.querySelectorAll('.step-content').forEach((content, index) => {
        content.classList.remove('active');
        if (index + 1 === step) {
          content.classList.add('active');
        }
      });

      currentStep = step;
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // éªŒè¯ API Key
    async function validateApiKeyAndNext() {
      const apiKeyInput = document.getElementById('apiKey');
      const apiKey = apiKeyInput.value.trim();

      if (!apiKey) {
        alert('è¯·è¾“å…¥ Steam API Key');
        return;
      }

      if (apiKey.length !== 32) {
        alert('API Key æ ¼å¼ä¸æ­£ç¡®ï¼Œåº”ä¸º32ä½å­—ç¬¦');
        return;
      }

      // æµ‹è¯• API Key æ˜¯å¦æœ‰æ•ˆ
      try {
        // ä½¿ç”¨ CORS ä»£ç†æµ‹è¯•
        const testUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(
          `https://api.steampowered.com/ISteamUser/GetPlayerSummaries/v2/?key=${apiKey}&steamids=76561198000000000`
        )}`;

        const response = await fetch(testUrl);
        const data = await response.json();
        const result = JSON.parse(data.contents);

        if (result.response) {
          steamApiKey = apiKey;
          localStorage.setItem('steam_api_key', apiKey);
          goToStep(2);
        } else {
          alert('API Key éªŒè¯å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æ­£ç¡®');
        }
      } catch (error) {
        console.error('API Key éªŒè¯é”™è¯¯:', error);
        // å³ä½¿éªŒè¯å¤±è´¥ä¹Ÿå…è®¸ç»§ç»­ï¼ˆå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼‰
        steamApiKey = apiKey;
        localStorage.setItem('steam_api_key', apiKey);
        goToStep(2);
      }
    }

    // è·³è¿‡ API Key
    function skipApiKey() {
      if (confirm('è·³è¿‡åå°†åªèƒ½è·å–å…¬å¼€æ•°æ®ï¼Œç¡®å®šè¦è·³è¿‡å—ï¼Ÿ')) {
        steamApiKey = '';
        goToStep(2);
      }
    }

    // Steam OpenID ç™»å½•
    function steamLogin() {
      // Steam OpenID ç™»å½• URL
      const returnUrl = encodeURIComponent(window.location.origin + '/steam-callback.html');
      const realm = encodeURIComponent(window.location.origin);
      
      // æ„å»º Steam OpenID è®¤è¯ URL
      const steamOpenIdUrl = 'https://steamcommunity.com/openid/login?' + 
        'openid.ns=http://specs.openid.net/auth/2.0&' +
        'openid.mode=checkid_setup&' +
        'openid.return_to=' + returnUrl + '&' +
        'openid.realm=' + realm + '&' +
        'openid.identity=http://specs.openid.net/auth/2.0/identifier_select&' +
        'openid.claimed_id=http://specs.openid.net/auth/2.0/identifier_select';

      // æ‰“å¼€ Steam ç™»å½•çª—å£
      const width = 800;
      const height = 600;
      const left = (screen.width - width) / 2;
      const top = (screen.height - height) / 2;

      const steamWindow = window.open(
        steamOpenIdUrl,
        'steam_login',
        `width=${width},height=${height},left=${left},top=${top}`
      );

      // ç›‘å¬å›è°ƒæ¶ˆæ¯
      window.addEventListener('message', handleSteamCallback);

      // æ£€æµ‹çª—å£å…³é—­
      const checkWindow = setInterval(() => {
        if (steamWindow && steamWindow.closed) {
          clearInterval(checkWindow);
          window.removeEventListener('message', handleSteamCallback);
        }
      }, 500);
    }

    // å¤„ç† Steam å›è°ƒ
    async function handleSteamCallback(event) {
      if (event.origin !== window.location.origin) return;

      if (event.data.type === 'steam_login_success') {
        const steamId = event.data.steamId;
        console.log('Steam ID:', steamId);

        // è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯
        await fetchSteamUserData(steamId);
        goToStep(3);
      } else if (event.data.type === 'steam_login_error') {
        alert('Steam ç™»å½•å¤±è´¥ï¼š' + event.data.error);
      }
    }

    // è·å– Steam ç”¨æˆ·æ•°æ®
    async function fetchSteamUserData(steamId) {
      const profilePreview = document.getElementById('steamProfilePreview');
      const confirmButtons = document.getElementById('confirmButtons');

      try {
        const apiKey = steamApiKey || localStorage.getItem('steam_api_key');
        
        // è·å–ç”¨æˆ·ä¿¡æ¯
        let userData = null;
        let gamesData = null;

        if (apiKey) {
          // ä½¿ç”¨ API Key è·å–å®Œæ•´æ•°æ®
          const userUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(
            `https://api.steampowered.com/ISteamUser/GetPlayerSummaries/v2/?key=${apiKey}&steamids=${steamId}`
          )}`;
          
          const userResponse = await fetch(userUrl);
          const userJson = await userResponse.json();
          const userResult = JSON.parse(userJson.contents);
          userData = userResult.response.players[0];

          // è·å–æ¸¸æˆåˆ—è¡¨
          const gamesUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(
            `https://api.steampowered.com/IPlayerService/GetOwnedGames/v1/?key=${apiKey}&steamid=${steamId}&include_appinfo=1&include_played_free_games=1`
          )}`;

          const gamesResponse = await fetch(gamesUrl);
          const gamesJson = await gamesResponse.json();
          const gamesResult = JSON.parse(gamesJson.contents);
          gamesData = gamesResult.response;
        }

        // å¦‚æœæ²¡æœ‰ API Key æˆ–è·å–å¤±è´¥ï¼Œä½¿ç”¨å…¬å¼€æ•°æ®
        if (!userData) {
          userData = {
            steamid: steamId,
            personaname: 'æœªçŸ¥ç”¨æˆ·',
            avatarfull: 'https://avatars.steamstatic.com/fef49e7fa7e1997310d705b2a6158ff8dc1cdfeb_full.jpg',
            profileurl: `https://steamcommunity.com/profiles/${steamId}`,
            personastate: 0
          };
        }

        steamUserData = {
          ...userData,
          games: gamesData
        };

        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
        const totalPlaytime = gamesData?.games?.reduce((sum, game) => sum + (game.playtime_forever || 0), 0) || 0;
        const gameCount = gamesData?.game_count || 0;

        profilePreview.innerHTML = `
          <div class="steam-profile">
            <img src="${userData.avatarfull}" alt="å¤´åƒ" class="steam-avatar">
            <div class="steam-info">
              <h4>${userData.personaname}</h4>
              <p>Steam ID: ${userData.steamid}</p>
              <p>çŠ¶æ€: ${getOnlineStatus(userData.personastate)}</p>
            </div>
          </div>

          <div class="steam-stats">
            <div class="stat-card">
              <div class="value">${gameCount}</div>
              <div class="label">æ‹¥æœ‰æ¸¸æˆ</div>
            </div>
            <div class="stat-card">
              <div class="value">${formatPlaytime(totalPlaytime)}</div>
              <div class="label">æ€»æ¸¸æˆæ—¶é•¿</div>
            </div>
            <div class="stat-card">
              <div class="value">${gamesData?.games?.filter(g => g.playtime_forever > 0).length || 0}</div>
              <div class="label">å·²æ¸¸ç©</div>
            </div>
          </div>
        `;

        confirmButtons.style.display = 'block';

      } catch (error) {
        console.error('è·å– Steam æ•°æ®å¤±è´¥:', error);
        profilePreview.innerHTML = `
          <div class="alert alert-warning">
            <span class="alert-icon">âš ï¸</span>
            <div class="alert-content">
              <strong>è·å–æ•°æ®å¤±è´¥</strong>
              <p>æ— æ³•è·å– Steam è´¦å·ä¿¡æ¯ï¼Œä½†æ‚¨ä»å¯ä»¥å®Œæˆç»‘å®šã€‚é”™è¯¯: ${error.message}</p>
            </div>
          </div>
        `;
        confirmButtons.style.display = 'block';
      }
    }

    // ç¡®è®¤ç»‘å®š
    function confirmBinding() {
      if (!steamUserData) {
        alert('è¯·å…ˆå®Œæˆ Steam ç™»å½•éªŒè¯');
        return;
      }

      // å‡†å¤‡æ¸¸æˆåˆ—è¡¨æ•°æ®
      const gamesList = steamUserData.games?.games?.map(game => ({
        appid: game.appid,
        name: game.name,
        playtimeForever: game.playtime_forever || 0,
        imgIconUrl: game.img_icon_url,
        imgLogoUrl: game.img_logo_url
      })) || [];

      // ä¿å­˜ç»‘å®šä¿¡æ¯åˆ° steam_binding
      const bindingData = {
        steamId: steamUserData.steamid,
        personaName: steamUserData.personaname,
        avatar: steamUserData.avatarfull,
        profileUrl: steamUserData.profileurl,
        gameCount: steamUserData.games?.game_count || 0,
        totalPlaytime: steamUserData.games?.games?.reduce((sum, g) => sum + (g.playtime_forever || 0), 0) || 0,
        games: gamesList,
        boundAt: new Date().toISOString(),
        apiKeyConfigured: !!steamApiKey
      };

      // åŒæ­¥åˆ° UserDataManagerï¼ˆä½¿ç”¨æ­£ç¡®çš„å­˜å‚¨æ ¼å¼ï¼‰
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
      
      // ã€é‡è¦ã€‘è·å–æ­£ç¡®çš„ç”¨æˆ· ID - ä» gamebox_session è·å–
      let userId = currentUser.id;
      if (!userId) {
        // å°è¯•ä» session è·å–
        try {
          const session = JSON.parse(localStorage.getItem('gamebox_session') || '{}');
          userId = session?.user?.id;
        } catch (e) {}
      }
      
      // å¦‚æœä»ç„¶æ²¡æœ‰ç”¨æˆ· IDï¼Œè¯´æ˜ç”¨æˆ·æœªç™»å½•
      if (!userId) {
        console.error('[Steam Binding] é”™è¯¯ï¼šæ— æ³•è·å–ç”¨æˆ· IDï¼Œç”¨æˆ·å¯èƒ½æœªç™»å½•');
        alert('è¯·å…ˆç™»å½•åå†ç»‘å®š Steam è´¦å·');
        return;
      }
      
      console.log('[Steam Binding] ä¿å­˜ç»‘å®šæ•°æ®ï¼Œç”¨æˆ· ID:', userId);
      
      // ã€ä¿®å¤ã€‘ä½¿ç”¨ç”¨æˆ·ä¸“å±çš„ key ä¿å­˜ç»‘å®šæ•°æ®
      bindingData.userId = userId; // è®°å½•ç»‘å®šçš„ç”¨æˆ· ID
      localStorage.setItem('steam_binding_' + userId, JSON.stringify(bindingData));
      
      // æ¸…é™¤æ—§çš„å…¨å±€ steam_bindingï¼ˆå¦‚æœå­˜åœ¨ï¼‰
      localStorage.removeItem('steam_binding');
      
      // é‡è¦ï¼šä½¿ç”¨ä¸ UserDataManager ç›¸åŒçš„å­˜å‚¨é”®æ ¼å¼
      const STORAGE_KEY = 'gamebox_user_data';
      let allUserData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
      let userData = allUserData[userId] || {
        steam: { linked: false },
        stats: { viewedGames: 0, addedToWishlist: 0, markedOwned: 0 },
        preferences: { theme: 'dark', notifications: true }
      };
      
      // æ›´æ–° Steam æ•°æ®
      userData.steam = {
        linked: true,
        steamId: steamUserData.steamid,
        personaName: steamUserData.personaname,
        avatar: steamUserData.avatarfull,
        profileUrl: steamUserData.profileurl,
        lastSync: new Date().toISOString(),
        games: gamesList,
        gameCount: bindingData.gameCount,
        totalPlaytime: bindingData.totalPlaytime
      };
      
      userData.updatedAt = new Date().toISOString();
      
      // ä¿å­˜åˆ° UserDataManager çš„å­˜å‚¨æ ¼å¼
      allUserData[userId] = userData;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(allUserData));
      
      // åŒæ—¶æ›´æ–°æ°¸ä¹…å­˜å‚¨å’Œå¤‡ä»½
      try {
        // æ°¸ä¹…ç”¨æˆ·å­˜å‚¨
        const permanentUsers = JSON.parse(localStorage.getItem('gamebox_permanent_users') || '{}');
        permanentUsers[userId] = userData;
        localStorage.setItem('gamebox_permanent_users', JSON.stringify(permanentUsers));
        
        // å¤‡ä»½å­˜å‚¨
        const BACKUP_KEY = 'gamebox_user_data_backup';
        const backups = JSON.parse(localStorage.getItem(BACKUP_KEY) || '{}');
        if (!backups[userId]) backups[userId] = [];
        backups[userId].push({ data: userData, timestamp: new Date().toISOString() });
        if (backups[userId].length > 10) backups[userId] = backups[userId].slice(-10);
        localStorage.setItem(BACKUP_KEY, JSON.stringify(backups));
      } catch (e) {
        console.error('ä¿å­˜æ°¸ä¹…å­˜å‚¨å¤±è´¥:', e);
      }
      
      console.log('[Steam ç»‘å®š] æ•°æ®å·²ä¿å­˜:', {
        userId,
        steamId: steamUserData.steamid,
        gameCount: bindingData.gameCount
      });

      // æ˜¾ç¤ºæœ€ç»ˆç»Ÿè®¡
      const finalStats = document.getElementById('finalStats');
      finalStats.innerHTML = `
        <div class="stat-card">
          <div class="value">${bindingData.gameCount}</div>
          <div class="label">å·²åŒæ­¥æ¸¸æˆ</div>
        </div>
        <div class="stat-card">
          <div class="value">${formatPlaytime(bindingData.totalPlaytime)}</div>
          <div class="label">æ€»æ¸¸æˆæ—¶é•¿</div>
        </div>
        <div class="stat-card">
          <div class="value">1</div>
          <div class="label">å·²ç»‘å®šè´¦å·</div>
        </div>
      `;

      goToStep(4);
    }

    // å·¥å…·å‡½æ•°
    function getOnlineStatus(state) {
      const statuses = ['ç¦»çº¿', 'åœ¨çº¿', 'å¿™ç¢Œ', 'ç¦»å¼€', 'æ‰“ç›¹', 'æƒ³äº¤æ˜“', 'æƒ³ç©æ¸¸æˆ'];
      return statuses[state] || 'æœªçŸ¥';
    }

    function formatPlaytime(minutes) {
      if (minutes < 60) return `${minutes}åˆ†é’Ÿ`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours}å°æ—¶`;
      const days = Math.floor(hours / 24);
      return `${days}å¤©`;
    }

    function copyToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      });
    }

    function toggleFaq(element) {
      const faqItem = element.parentElement;
      faqItem.classList.toggle('open');
    }

    // æ£€æŸ¥æ˜¯å¦å·²æœ‰ç»‘å®š
    function checkExistingBinding() {
      const existing = localStorage.getItem('steam_binding');
      if (existing) {
        try {
          const data = JSON.parse(existing);
          if (confirm(`æ£€æµ‹åˆ°å·²ç»‘å®šçš„ Steam è´¦å·ï¼š${data.personaName}\n\næ˜¯å¦è¦é‡æ–°ç»‘å®šï¼Ÿ`)) {
            localStorage.removeItem('steam_binding');
          } else {
            window.location.href = 'profile.html';
          }
        } catch (e) {}
      }

      // æ£€æŸ¥æ˜¯å¦å·²æœ‰ API Key
      const savedApiKey = localStorage.getItem('steam_api_key');
      if (savedApiKey) {
        document.getElementById('apiKey').value = savedApiKey;
      }
    }

    // é¡µé¢åŠ è½½
    document.addEventListener('DOMContentLoaded', () => {
      checkExistingBinding();
    });
  </script>
<!-- å…¨å±€ä¸»é¢˜ç³»ç»Ÿ -->
<script src="global-theme-system.js"></script>
</body>
</html>
