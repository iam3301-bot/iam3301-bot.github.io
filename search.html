<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox æ¸¸ç›’ - é«˜çº§æœç´¢</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="index.css" />
  <style>
    /* é«˜çº§æœç´¢é¡µé¢æ ·å¼ */
    .search-hero {
      background: linear-gradient(135deg, rgba(255, 211, 0, 0.1) 0%, rgba(255, 61, 148, 0.05) 100%);
      border: 2px solid rgba(255, 211, 0, 0.3);
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 24px;
      text-align: center;
    }
    
    .search-main-input {
      width: 100%;
      max-width: 800px;
      margin: 0 auto 20px;
      position: relative;
    }
    
    .search-main-input input {
      width: 100%;
      padding: 16px 60px 16px 20px;
      font-size: 18px;
      border: 2px solid rgba(255, 211, 0, 0.4);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.6);
      color: var(--text-main);
    }
    
    .search-main-input button {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      padding: 10px 24px;
      background: linear-gradient(135deg, var(--cyber-yellow), var(--cyber-pink));
      border: none;
      border-radius: 6px;
      color: #000;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .search-main-input button:hover {
      transform: translateY(-50%) scale(1.05);
      box-shadow: 0 0 20px rgba(255, 211, 0, 0.6);
    }
    
    .search-tips {
      display: flex;
      gap: 12px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 16px;
    }
    
    .search-tip {
      padding: 6px 14px;
      background: rgba(85, 234, 212, 0.15);
      border: 1px solid rgba(85, 234, 212, 0.3);
      border-radius: 20px;
      font-size: 12px;
      color: var(--cyber-cyan);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .search-tip:hover {
      background: rgba(85, 234, 212, 0.25);
      transform: translateY(-2px);
    }
    
    /* é«˜çº§ç­›é€‰é¢æ¿ */
    .filter-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .filter-group {
      background: rgba(10, 10, 10, 0.6);
      border: 1px solid rgba(255, 211, 0, 0.2);
      border-radius: 8px;
      padding: 16px;
    }
    
    .filter-group-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 13px;
      font-weight: 700;
      color: var(--cyber-yellow);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .filter-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .filter-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .filter-option:hover {
      background: rgba(255, 211, 0, 0.1);
    }
    
    .filter-option input[type="checkbox"] {
      margin: 0;
    }
    
    .filter-option label {
      flex: 1;
      cursor: pointer;
      font-size: 13px;
    }
    
    .filter-count {
      font-size: 11px;
      color: var(--text-muted);
    }
    
    /* æœç´¢ç»“æœ */
    .search-results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .result-count {
      font-size: 14px;
      color: var(--text-muted);
    }
    
    .result-count strong {
      color: var(--cyber-yellow);
      font-size: 18px;
    }
    
    .sort-selector {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .view-mode {
      display: flex;
      gap: 4px;
      padding: 4px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 6px;
    }
    
    .view-btn {
      padding: 6px 12px;
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.3s ease;
    }
    
    .view-btn.active {
      background: rgba(255, 211, 0, 0.2);
      color: var(--cyber-yellow);
    }
    
    /* åˆ—è¡¨è§†å›¾ */
    .search-results-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .result-item {
      display: grid;
      grid-template-columns: 140px 1fr auto;
      gap: 16px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(10, 10, 10, 0.9) 0%, rgba(20, 0, 30, 0.85) 100%);
      border: 1px solid rgba(255, 211, 0, 0.2);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .result-item:hover {
      border-color: rgba(255, 211, 0, 0.5);
      transform: translateX(5px);
      box-shadow: 0 5px 25px rgba(0, 0, 0, 0.4);
    }
    
    .result-cover {
      width: 140px;
      height: 85px;
      border-radius: 6px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.5);
    }
    
    .result-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .result-info {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 8px;
    }
    
    .result-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .result-chinese {
      font-size: 14px;
      color: var(--cyber-cyan);
    }
    
    .result-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .result-tags {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    
    .result-tag {
      padding: 3px 8px;
      background: rgba(85, 234, 212, 0.15);
      border: 1px solid rgba(85, 234, 212, 0.3);
      border-radius: 4px;
      font-size: 11px;
      color: var(--cyber-cyan);
    }
    
    .result-stats {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: center;
      gap: 8px;
      min-width: 100px;
    }
    
    .result-rating {
      font-family: 'Orbitron', sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: var(--cyber-yellow);
      text-shadow: 0 0 10px rgba(255, 211, 0, 0.5);
    }
    
    .result-platform {
      font-size: 11px;
      color: var(--text-muted);
    }
    
    /* å“åº”å¼ */
    @media (max-width: 900px) {
      .result-item {
        grid-template-columns: 100px 1fr;
      }
      
      .result-stats {
        grid-column: 1 / -1;
        flex-direction: row;
        justify-content: space-between;
      }
    }
  </style>
</head>
<body data-current-page="search" class="cyberpunk-theme">
<div class="page">
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>
      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          æ’è¡Œæ¦œ <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">æŠ˜æ‰£ / å²ä½</a>
        <a href="community.html" data-page="community" class="nav-link">ç¤¾åŒº</a>
        <a href="news-list.html" data-page="news" class="nav-link">èµ„è®¯</a>
        <a href="tools.html" data-page="tools" class="nav-link">å·¥å…·</a>
        <a href="my-library.html" data-page="my" class="nav-link">æˆ‘çš„æ¸¸æˆ</a>
        <a href="profile.html" data-page="profile" class="nav-link">ç”¨æˆ·ä¸­å¿ƒ</a>
      </nav>
      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="æœç´¢æ¸¸æˆ / èµ„è®¯ / å¸–å­" />
          <span class="header-search-icon">ğŸ”</span>
        </div>
        <button class="header-user">æœªç™»å½• Â· æ¸¸å®¢</button>
      </div>
    </div>
  </header>
  
  <canvas id="matrix-canvas" class="matrix-bg"></canvas>
  <div id="particles-container" class="particles-container"></div>
  <div id="scroll-progress" class="scroll-progress"></div>
  <div id="loading-overlay" class="loading-overlay">
    <div class="cyberpunk-loader">
      <div class="loader-hexagon"></div>
      <div class="loader-text">LOADING...</div>
    </div>
  </div>

  <main class="main main--wide">
    <!-- æœç´¢ä¸»åŒºåŸŸ -->
    <div class="search-hero">
      <h1 style="font-family: 'Orbitron', sans-serif; font-size: 32px; color: var(--cyber-yellow); margin-bottom: 16px;">
        ğŸ” é«˜çº§æ¸¸æˆæœç´¢
      </h1>
      <p style="font-size: 14px; color: var(--text-muted); margin-bottom: 24px;">
        æ”¯æŒä¸­è‹±æ–‡æ··åˆæœç´¢ Â· 5000+ çœŸå®æ¸¸æˆæ•°æ® Â· æ™ºèƒ½æ‹¼éŸ³åŒ¹é…
      </p>
      
      <div class="search-main-input">
        <input 
          id="mainSearchInput" 
          type="text" 
          placeholder="æœç´¢æ¸¸æˆåç§°ï¼Œæ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ‹¼éŸ³é¦–å­—æ¯..." 
          autofocus
        />
        <button onclick="performSearch()">æœç´¢</button>
      </div>
      
      <div class="search-tips">
        <span class="search-tip" onclick="quickSearch('è‰¾å°”ç™»æ³•ç¯')">ğŸ”¥ è‰¾å°”ç™»æ³•ç¯</span>
        <span class="search-tip" onclick="quickSearch('èµ›åšæœ‹å…‹')">ğŸŒ† èµ›åšæœ‹å…‹</span>
        <span class="search-tip" onclick="quickSearch('é»‘ç¥è¯')">ğŸµ é»‘ç¥è¯æ‚Ÿç©º</span>
        <span class="search-tip" onclick="quickSearch('åŸç¥')">âš¡ åŸç¥</span>
        <span class="search-tip" onclick="quickSearch('åšå¾·ä¹‹é—¨')">ğŸ² åšå¾·ä¹‹é—¨3</span>
        <span class="search-tip" onclick="quickSearch('ç©ºæ´éª‘å£«')">ğŸª² ç©ºæ´éª‘å£«</span>
      </div>
    </div>

    <!-- é«˜çº§ç­›é€‰é¢æ¿ -->
    <div class="card">
      <header class="card-header">
        <div class="card-title">
          <span class="dot"></span><span>// ADVANCED FILTERS</span>
        </div>
        <button class="cyber-btn cyber-btn--cyan" onclick="resetFilters()" style="padding: 8px 20px; font-size: 11px;">
          é‡ç½®ç­›é€‰
        </button>
      </header>
      
      <div class="filter-panel" id="filterPanel">
        <!-- å‘è¡Œå¹´ä»½ -->
        <div class="filter-group">
          <div class="filter-group-title">ğŸ“… å‘è¡Œå¹´ä»½</div>
          <div class="filter-options">
            <div class="filter-option">
              <input type="checkbox" id="year2025" value="2025">
              <label for="year2025">2025å¹´ <span class="filter-count" id="count2025">NEW</span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="year2024" value="2024">
              <label for="year2024">2024å¹´ <span class="filter-count" id="count2024"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="year2023" value="2023">
              <label for="year2023">2023å¹´ <span class="filter-count" id="count2023"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="year2022-2020" value="2022-2020">
              <label for="year2022-2020">2020-2022å¹´ <span class="filter-count" id="count2022-2020"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="year2019-2015" value="2019-2015">
              <label for="year2019-2015">2015-2019å¹´ <span class="filter-count" id="count2019-2015"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="yearOlder" value="older">
              <label for="yearOlder">2015å¹´ä¹‹å‰ <span class="filter-count" id="countOlder"></span></label>
            </div>
          </div>
        </div>
        
        <!-- æ¸¸æˆç±»å‹ -->
        <div class="filter-group">
          <div class="filter-group-title">ğŸ® æ¸¸æˆç±»å‹</div>
          <div class="filter-options">
            <div class="filter-option">
              <input type="checkbox" id="typeAction" value="Action">
              <label for="typeAction">åŠ¨ä½œ <span class="filter-count" id="countAction"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="typeRPG" value="RPG">
              <label for="typeRPG">è§’è‰²æ‰®æ¼” <span class="filter-count" id="countRPG"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="typeStrategy" value="Strategy">
              <label for="typeStrategy">ç­–ç•¥ <span class="filter-count" id="countStrategy"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="typeShooter" value="Shooter">
              <label for="typeShooter">å°„å‡» <span class="filter-count" id="countShooter"></span></label>
            </div>
          </div>
        </div>
        
        <!-- å¹³å° -->
        <div class="filter-group">
          <div class="filter-group-title">ğŸ’» æ¸¸æˆå¹³å°</div>
          <div class="filter-options">
            <div class="filter-option">
              <input type="checkbox" id="platformSteam" value="Steam">
              <label for="platformSteam">Steam <span class="filter-count" id="countSteam"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="platformPS" value="PlayStation">
              <label for="platformPS">PlayStation <span class="filter-count" id="countPS"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="platformXbox" value="Xbox">
              <label for="platformXbox">Xbox <span class="filter-count" id="countXbox"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="platformSwitch" value="Switch">
              <label for="platformSwitch">Switch <span class="filter-count" id="countSwitch"></span></label>
            </div>
          </div>
        </div>
        
        <!-- è¯„åˆ† -->
        <div class="filter-group">
          <div class="filter-group-title">â­ è¯„åˆ†èŒƒå›´</div>
          <div class="filter-options">
            <div class="filter-option">
              <input type="checkbox" id="rating95" value="95">
              <label for="rating95">9.5+ ç¥ä½œ <span class="filter-count" id="count95"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="rating90" value="90">
              <label for="rating90">9.0+ æ°ä½œ <span class="filter-count" id="count90"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="rating80" value="80">
              <label for="rating80">8.0+ ä½³ä½œ <span class="filter-count" id="count80"></span></label>
            </div>
            <div class="filter-option">
              <input type="checkbox" id="rating70" value="70">
              <label for="rating70">7.0+ å¥½è¯„ <span class="filter-count" id="count70"></span></label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æœç´¢ç»“æœ -->
    <div class="card">
      <div class="search-results-header">
        <div class="result-count">
          æ‰¾åˆ° <strong id="resultCount">0</strong> æ¬¾æ¸¸æˆ
        </div>
        <div class="sort-selector">
          <select id="sortSelect" onchange="sortResults()" style="padding: 8px 12px;">
            <option value="relevance">ç›¸å…³åº¦</option>
            <option value="rating">è¯„åˆ†æœ€é«˜</option>
            <option value="name">åç§°æ’åº</option>
            <option value="year">å‘è¡Œæ—¶é—´</option>
          </select>
        </div>
      </div>
      
      <div class="search-results-list" id="searchResults">
        <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
          <div style="font-size: 64px; margin-bottom: 16px;">ğŸ”</div>
          <div style="font-size: 16px;">è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢...</div>
        </div>
      </div>
    </div>
  </main>
</div>

<script src="common.js"></script>
<script src="cyber-effects.js"></script>
<script src="chinese-game-names.js"></script>
<script src="real-5000-games-database.js"></script>
<script src="mega-game-database-real.js"></script>
<script src="multi-platform-games.js"></script>
<script>
  initCommon();

  let allGames = [];
  let filteredResults = [];
  let currentSort = 'relevance';

  // åŠ è½½æ¸¸æˆæ•°æ®
  async function loadGames() {
    try {
      // åŠ è½½Steamæ¸¸æˆæ•°æ®
      const steamGames = await window.megaGameDB.getAllGames();
      console.log(`âœ… Steamæ¸¸æˆ: ${steamGames.length} æ¬¾`);
      
      // åŠ è½½å¤šå¹³å°æ¸¸æˆæ•°æ®
      const multiPlatformGames = window.multiPlatformGames ? window.multiPlatformGames.all : [];
      console.log(`âœ… å¤šå¹³å°æ¸¸æˆ: ${multiPlatformGames.length} æ¬¾`);
      
      // åˆå¹¶æ•°æ®
      allGames = [
        ...steamGames,
        ...multiPlatformGames.map(game => ({
          id: game.id,
          appid: game.id,
          name: game.name,
          chineseName: game.chineseName,
          genre: game.genre,
          rating: game.rating,
          price: game.price,
          year: game.year,
          platform: game.platform,
          cover: game.cover,
          thumbnail: game.cover,
          source: game.platform.includes(',') ? 'Multi-Platform' : game.platform
        }))
      ];
      
      console.log(`âœ… åŠ è½½äº† ${allGames.length} æ¬¾æ¸¸æˆ`);
      
      // ä¸ºæ¯ä¸ªæ¸¸æˆæ·»åŠ ä¸­æ–‡å
      allGames.forEach(game => {
        game.chineseName = window.getChineseName(game.name || game.title);
      });
      
      // URLå‚æ•°æœç´¢
      const urlParams = new URLSearchParams(window.location.search);
      const query = urlParams.get('q');
      if (query) {
        document.getElementById('mainSearchInput').value = query;
        performSearch();
      }
    } catch (error) {
      console.error('åŠ è½½æ¸¸æˆæ•°æ®å¤±è´¥:', error);
    }
  }

  // æ‰§è¡Œæœç´¢
  function performSearch() {
    const query = document.getElementById('mainSearchInput').value.trim();
    
    if (!query) {
      document.getElementById('searchResults').innerHTML = `
        <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
          <div style="font-size: 64px; margin-bottom: 16px;">ğŸ”</div>
          <div style="font-size: 16px;">è¯·è¾“å…¥æœç´¢å…³é”®è¯</div>
        </div>
      `;
      return;
    }
    
    // æœç´¢æ¸¸æˆ
    filteredResults = allGames.filter(game => {
      return window.searchGameName(query, game.name || game.title);
    });
    
    // åº”ç”¨ç­›é€‰å™¨
    applyFilters();
    
    // æ˜¾ç¤ºç»“æœ
    displayResults();
  }

  // å¿«é€Ÿæœç´¢
  function quickSearch(keyword) {
    document.getElementById('mainSearchInput').value = keyword;
    performSearch();
  }

  // åº”ç”¨ç­›é€‰å™¨
  function applyFilters() {
    let results = [...filteredResults];
    
    // å¹´ä»½ç­›é€‰
    const yearChecks = {
      '2025': document.getElementById('year2025')?.checked,
      '2024': document.getElementById('year2024')?.checked,
      '2023': document.getElementById('year2023')?.checked,
      '2022-2020': document.getElementById('year2022-2020')?.checked,
      '2019-2015': document.getElementById('year2019-2015')?.checked,
      'older': document.getElementById('yearOlder')?.checked
    };
    
    const hasYearFilter = Object.values(yearChecks).some(v => v);
    
    if (hasYearFilter) {
      results = results.filter(game => {
        const year = game.year || (game.releaseDate ? new Date(game.releaseDate).getFullYear() : null) || 2020;
        
        if (yearChecks['2025'] && year === 2025) return true;
        if (yearChecks['2024'] && year === 2024) return true;
        if (yearChecks['2023'] && year === 2023) return true;
        if (yearChecks['2022-2020'] && year >= 2020 && year <= 2022) return true;
        if (yearChecks['2019-2015'] && year >= 2015 && year <= 2019) return true;
        if (yearChecks['older'] && year < 2015) return true;
        
        return false;
      });
    }
    
    // ç±»å‹ç­›é€‰
    const typeChecks = {
      'Action': document.getElementById('typeAction')?.checked,
      'RPG': document.getElementById('typeRPG')?.checked,
      'Strategy': document.getElementById('typeStrategy')?.checked,
      'Shooter': document.getElementById('typeShooter')?.checked
    };
    
    const hasTypeFilter = Object.values(typeChecks).some(v => v);
    
    if (hasTypeFilter) {
      results = results.filter(game => {
        const genre = (game.genre || game.category || '').toLowerCase();
        const tags = (game.tags || []).map(t => t.toLowerCase());
        
        if (typeChecks['Action'] && (genre.includes('action') || tags.some(t => t.includes('action')))) return true;
        if (typeChecks['RPG'] && (genre.includes('rpg') || tags.some(t => t.includes('rpg')))) return true;
        if (typeChecks['Strategy'] && (genre.includes('strategy') || tags.some(t => t.includes('strategy')))) return true;
        if (typeChecks['Shooter'] && (genre.includes('shooter') || tags.some(t => t.includes('shooter')))) return true;
        
        return false;
      });
    }
    
    // è¯„åˆ†ç­›é€‰
    const minRating = parseFloat(document.getElementById('ratingFilter')?.value || 0);
    if (minRating > 0) {
      results = results.filter(game => (game.rating || 0) >= minRating);
    }
    
    filteredResults = results;
  }

  // æ˜¾ç¤ºç»“æœ
  function displayResults() {
    const container = document.getElementById('searchResults');
    const countEl = document.getElementById('resultCount');
    
    countEl.textContent = filteredResults.length;
    
    if (filteredResults.length === 0) {
      container.innerHTML = `
        <div style="text-align: center; padding: 60px 20px; color: var(--text-muted);">
          <div style="font-size: 64px; margin-bottom: 16px;">ğŸ˜”</div>
          <div style="font-size: 16px;">æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ¸¸æˆ</div>
          <div style="font-size: 13px; margin-top: 8px; opacity: 0.7;">å°è¯•è°ƒæ•´æœç´¢å…³é”®è¯æˆ–ç­›é€‰æ¡ä»¶</div>
        </div>
      `;
      return;
    }
    
    // æ’åº
    sortResultsList();
    
    // æ¸²æŸ“
    container.innerHTML = filteredResults.map(game => {
      const rating = (game.rating || 0).toFixed(1);
      const chineseName = game.chineseName || '';
      const showChinese = chineseName && chineseName !== game.name;
      
      return `
        <div class="result-item" onclick="goToGame('${game.id || game.appid}', '${(game.name || game.title).replace(/'/g, "\\'")}')">
          <div class="result-cover">
            <img src="${game.thumbnail || game.cover || ''}" alt="${game.name}" 
                 onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 60%22><rect fill=%22%231a1a2e%22 width=%22100%22 height=%2260%22/><text x=%2250%22 y=%2235%22 fill=%22%23FFD300%22 font-size=%2220%22 text-anchor=%22middle%22>ğŸ®</text></svg>'" />
          </div>
          <div class="result-info">
            <div class="result-title">
              ${game.name || game.title}
              ${showChinese ? `<span class="result-chinese">${chineseName}</span>` : ''}
            </div>
            <div class="result-meta">
              <span>ğŸ¯ ${game.genre || game.category || 'æ¸¸æˆ'}</span>
              <span>ğŸ“… ${game.year || 'æœªçŸ¥'}</span>
              <span>ğŸ’° ${game.price > 0 ? 'Â¥' + game.price : 'å…è´¹'}</span>
            </div>
            <div class="result-tags">
              ${game.platform ? `<span class="result-tag">ğŸ’» ${game.platform.split(',')[0].trim()}</span>` : ''}
              ${game.source ? `<span class="result-tag">ğŸ“Š ${game.source}</span>` : ''}
            </div>
          </div>
          <div class="result-stats">
            <div class="result-rating">${rating}</div>
            <div class="result-platform">${game.platform || 'PC'}</div>
          </div>
        </div>
      `;
    }).join('');
  }

  // æ’åºç»“æœ
  function sortResultsList() {
    switch (currentSort) {
      case 'rating':
        filteredResults.sort((a, b) => (b.rating || 0) - (a.rating || 0));
        break;
      case 'name':
        filteredResults.sort((a, b) => (a.name || a.title).localeCompare(b.name || b.title));
        break;
      case 'year':
        filteredResults.sort((a, b) => (b.year || 2020) - (a.year || 2020));
        break;
      // relevance ä¸æ’åº
    }
  }

  function sortResults() {
    currentSort = document.getElementById('sortSelect').value;
    displayResults();
  }

  function resetFilters() {
    document.querySelectorAll('.filter-option input[type="checkbox"]').forEach(cb => cb.checked = false);
    performSearch();
  }

  function goToGame(id, name) {
    const url = new URL("game-detail.html", window.location.href);
    url.searchParams.set("id", id);
    url.searchParams.set("name", name);
    window.location.href = url.toString();
  }

  // Enteré”®æœç´¢
  document.getElementById('mainSearchInput').addEventListener('keypress', e => {
    if (e.key === 'Enter') performSearch();
  });

  // ç›‘å¬ç­›é€‰å™¨å˜åŒ–
  document.querySelectorAll('.filter-option input[type="checkbox"]').forEach(cb => {
    cb.addEventListener('change', () => {
      if (filteredResults.length > 0) {
        applyFilters();
        displayResults();
      }
    });
  });

  // åˆå§‹åŒ–
  loadGames();
</script>
</body>
</html>
