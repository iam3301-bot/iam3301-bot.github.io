<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸¸æˆå¹³å°è´¦å·ç®¡ç† - GameBox æ¸¸ç›’</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css">
  <style>
    .platforms-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .platforms-header {
      text-align: center;
      margin-bottom: 50px;
    }

    .platforms-header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 42px;
      color: var(--accent);
      margin-bottom: 15px;
      text-shadow: 0 0 30px rgba(56, 189, 248, 0.6);
    }

    .platforms-header .icon {
      font-size: 60px;
      margin-bottom: 20px;
      display: block;
    }

    .platforms-header p {
      color: var(--text-muted);
      font-size: 18px;
      max-width: 600px;
      margin: 0 auto;
    }

    /* æç¤ºä¿¡æ¯ */
    .info-banner {
      background: rgba(56, 189, 248, 0.1);
      border: 1px solid rgba(56, 189, 248, 0.3);
      border-radius: 12px;
      padding: 20px 25px;
      margin-bottom: 40px;
      display: flex;
      align-items: flex-start;
      gap: 15px;
    }

    .info-banner .icon {
      font-size: 24px;
      color: var(--accent);
      flex-shrink: 0;
    }

    .info-banner .content {
      flex: 1;
    }

    .info-banner h3 {
      color: var(--accent);
      font-size: 16px;
      margin-bottom: 8px;
    }

    .info-banner p {
      color: var(--text-muted);
      font-size: 14px;
      line-height: 1.6;
      margin: 0;
    }

    /* å¹³å°å¡ç‰‡ç½‘æ ¼ */
    .platforms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .platform-card {
      background: linear-gradient(135deg, rgba(17, 24, 39, 0.95), rgba(31, 41, 55, 0.9));
      border: 2px solid rgba(56, 189, 248, 0.3);
      border-radius: 16px;
      padding: 30px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .platform-card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, var(--accent), #00ff88);
      border-radius: 16px;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }

    .platform-card:hover::before {
      opacity: 0.1;
    }

    .platform-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 40px rgba(56, 189, 248, 0.3);
    }

    .platform-card.connected {
      border-color: #10b981;
    }

    .platform-card.connected::before {
      background: linear-gradient(45deg, #10b981, #00ff88);
    }

    /* å¹³å°å¤´éƒ¨ */
    .platform-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(56, 189, 248, 0.2);
    }

    .platform-icon {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.3);
      padding: 10px;
    }
    
    .platform-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .platform-info h3 {
      font-family: 'Orbitron', sans-serif;
      font-size: 22px;
      color: var(--text-soft);
      margin-bottom: 5px;
    }

    .platform-status {
      font-size: 13px;
      padding: 4px 12px;
      border-radius: 12px;
      font-weight: 600;
    }

    .platform-status.connected {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
    }

    .platform-status.pending {
      background: rgba(245, 158, 11, 0.2);
      color: #f59e0b;
    }

    .platform-status.disconnected {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }

    /* å¹³å°æ•°æ® */
    .platform-data {
      margin-bottom: 20px;
    }

    .platform-data-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      font-size: 14px;
    }

    .platform-data-label {
      color: var(--text-muted);
    }

    .platform-data-value {
      color: var(--text-soft);
      font-weight: 600;
    }

    /* å¹³å°æ“ä½œæŒ‰é’® */
    .platform-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .platform-btn {
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Rajdhani', sans-serif;
      text-align: center;
      text-decoration: none;
      display: inline-block;
    }

    .platform-btn.primary {
      background: linear-gradient(135deg, var(--accent), #00ff88);
      color: #000;
    }

    .platform-btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(56, 189, 248, 0.4);
    }

    .platform-btn.secondary {
      background: rgba(56, 189, 248, 0.1);
      color: var(--accent);
      border: 1px solid var(--accent);
    }

    .platform-btn.secondary:hover {
      background: rgba(56, 189, 248, 0.2);
    }

    .platform-btn.danger {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
      border: 1px solid #ef4444;
    }

    .platform-btn.danger:hover {
      background: rgba(239, 68, 68, 0.2);
    }

    .platform-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* é…ç½®éƒ¨åˆ† */
    .config-section {
      display: none;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 20px;
      margin-top: 15px;
      animation: slideDown 0.3s ease;
    }

    .config-section.active {
      display: block;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .config-section h4 {
      color: var(--accent);
      font-size: 16px;
      margin-bottom: 15px;
    }

    .config-input-group {
      margin-bottom: 15px;
    }

    .config-input-group label {
      display: block;
      color: var(--text-soft);
      font-size: 13px;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .config-input-group input {
      width: 100%;
      padding: 12px 14px;
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(56, 189, 248, 0.3);
      border-radius: 6px;
      color: var(--text-soft);
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .config-input-group input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 10px rgba(56, 189, 248, 0.2);
    }

    .config-input-group .hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .config-input-group .hint a {
      color: var(--accent);
      text-decoration: none;
    }

    .config-input-group .hint a:hover {
      text-decoration: underline;
    }

    /* è¿”å›æŒ‰é’® */
    .back-button {
      text-align: center;
      margin-top: 40px;
    }

    .back-button a {
      color: var(--accent);
      text-decoration: none;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .back-button a:hover {
      text-shadow: 0 0 10px rgba(56, 189, 248, 0.8);
    }

    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .platforms-grid {
        grid-template-columns: 1fr;
      }

      .platforms-header h1 {
        font-size: 32px;
      }

      .platform-card {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="platforms-container">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="platforms-header">
      <span class="icon">ğŸ®</span>
      <h1>å…¶ä»–å¹³å°</h1>
      <p>ç®¡ç†æ‚¨çš„ Epic Gamesã€Xbox å’Œ PlayStation å¹³å°è´¦å·</p>
    </div>

    <!-- æç¤ºä¿¡æ¯ -->
    <div class="info-banner">
      <span class="icon">ğŸ’¡</span>
      <div class="content">
        <h3>é…ç½®è¯´æ˜ï¼šå„å¹³å°éœ€è¦å¯¹åº”çš„ API å¯†é’¥</h3>
        <p><strong>Epic Games:</strong> æš‚æ— å…¬å¼€ APIï¼Œæ”¯æŒæ‰‹åŠ¨å½•å…¥è´¦å·ä¿¡æ¯<br>
        <strong>Xbox:</strong> éœ€è¦ OpenXBL API Keyï¼ˆå…è´¹ç”³è¯·ï¼‰<br>
        <strong>PlayStation:</strong> éœ€è¦ PSN NPSSO Token å’Œä»£ç†æœåŠ¡å™¨<br><br>
        è¯·ç‚¹å‡»å„å¹³å°å¡ç‰‡ä¸­çš„"é…ç½®"æŒ‰é’®è¿›è¡Œè®¾ç½®ã€‚</p>
      </div>
    </div>

    <!-- å¹³å°å¡ç‰‡ç½‘æ ¼ -->
    <div class="platforms-grid">
      <!-- Epic Games å¡ç‰‡ -->
      <div class="platform-card" id="epicCard">
        <div class="platform-header">
          <div class="platform-icon" style="background: linear-gradient(135deg, #2a2a2a, #0078f2);">
            <img src="https://icons8.com/vue-static/icon/ios/download/FFFFFF/512/epic-games.png" alt="Epic Games">
          </div>
          <div class="platform-info">
            <h3>Epic Games</h3>
            <span class="platform-status disconnected" id="epicStatus">æœªç»‘å®š</span>
          </div>
        </div>

        <div class="platform-data" id="epicData">
          <div class="platform-data-item">
            <span class="platform-data-label">çŠ¶æ€</span>
            <span class="platform-data-value">æš‚æ—  API æ”¯æŒ</span>
          </div>
          <div class="platform-data-item">
            <span class="platform-data-label">æ¸¸æˆæ•°é‡</span>
            <span class="platform-data-value">-</span>
          </div>
          <div class="platform-data-item">
            <span class="platform-data-label">æœ€ååŒæ­¥</span>
            <span class="platform-data-value">ä»æœªåŒæ­¥</span>
          </div>
        </div>

        <div class="platform-actions">
          <button class="platform-btn primary" onclick="toggleConfig('epic')" id="epicBindBtn">
            ç»‘å®š Epic è´¦å·
          </button>
          <button class="platform-btn secondary" onclick="showEpicHelp()">
            æŸ¥çœ‹å¸®åŠ©
          </button>
        </div>

        <!-- é…ç½®åŒºåŸŸ -->
        <div class="config-section" id="epicConfig">
          <h4>æ‰‹åŠ¨å½•å…¥ Epic è´¦å·ä¿¡æ¯</h4>
          <div class="config-input-group">
            <label>Epic ç”¨æˆ·å</label>
            <input type="text" id="epicUsername" placeholder="è¾“å…¥æ‚¨çš„ Epic Games ç”¨æˆ·å">
            <p class="hint">
              è¯·è®¿é—® <a href="https://store.epicgames.com/library" target="_blank">Epic æ¸¸æˆåº“</a> æŸ¥çœ‹æ‚¨çš„è´¦å·ä¿¡æ¯
            </p>
          </div>
          <div class="config-input-group">
            <label>æ¸¸æˆæ•°é‡ï¼ˆé€‰å¡«ï¼‰</label>
            <input type="number" id="epicGameCount" placeholder="æ‚¨æ‹¥æœ‰çš„æ¸¸æˆæ•°é‡" min="0">
            <p class="hint">å¯ä»¥åœ¨ Epic æ¸¸æˆåº“ä¸­ç»Ÿè®¡æ‚¨çš„æ¸¸æˆæ•°é‡</p>
          </div>
          <button class="platform-btn primary" onclick="saveEpicManual()">
            ä¿å­˜è´¦å·ä¿¡æ¯
          </button>
        </div>
      </div>

      <!-- Xbox å¡ç‰‡ -->
      <div class="platform-card" id="xboxCard">
        <div class="platform-header">
          <div class="platform-icon" style="background: linear-gradient(135deg, #0e7a0d, #107c10);">
            <img src="https://www.citypng.com/public/uploads/preview/white-xbox-series-s-series-x-logos-png-img-701751694968922vqzbgkxfxu.png" alt="Xbox">
          </div>
          <div class="platform-info">
            <h3>Xbox</h3>
            <span class="platform-status disconnected" id="xboxStatus">æœªé…ç½®</span>
          </div>
        </div>

        <div class="platform-data" id="xboxData">
          <div class="platform-data-item">
            <span class="platform-data-label">ç©å®¶ä»£å·</span>
            <span class="platform-data-value" id="xboxGamertag">æœªç»‘å®š</span>
          </div>
          <div class="platform-data-item">
            <span class="platform-data-label">Gamerscore</span>
            <span class="platform-data-value" id="xboxGamerscore">-</span>
          </div>
          <div class="platform-data-item">
            <span class="platform-data-label">æ¸¸æˆæ•°é‡</span>
            <span class="platform-data-value" id="xboxGameCount">-</span>
          </div>
        </div>

        <div class="platform-actions">
          <button class="platform-btn primary" id="xboxConnectBtn" onclick="bindXboxAccount()">
            ç»‘å®š Xbox è´¦å·
          </button>
          <button class="platform-btn secondary" onclick="toggleConfig('xbox')">
            é…ç½® API Key
          </button>
        </div>

        <!-- é…ç½®åŒºåŸŸ -->
        <div class="config-section" id="xboxConfig">
          <h4>é…ç½® OpenXBL API Key</h4>
          <div class="config-input-group">
            <label>OpenXBL API Key</label>
            <input type="text" id="xboxApiKey" placeholder="ç²˜è´´æ‚¨çš„ OpenXBL API Key" maxlength="64">
            <p class="hint">
              å‰å¾€ <a href="https://xbl.io/" target="_blank">OpenXBL (xbl.io)</a> æ³¨å†Œå¹¶è·å–å…è´¹ API Key
            </p>
          </div>
          <button class="platform-btn primary" onclick="saveXboxApiKey()">
            ä¿å­˜ API Key
          </button>
          <button class="platform-btn danger" onclick="clearXboxApiKey()" style="margin-top: 10px;">
            æ¸…é™¤é…ç½®
          </button>
        </div>
      </div>

      <!-- PlayStation å¡ç‰‡ -->
      <div class="platform-card" id="psnCard">
        <div class="platform-header">
          <div class="platform-icon" style="background: linear-gradient(135deg, #003087, #0070d1);">
            <img src="https://icons8.com/vue-static/icon/ios/download/FFFFFF/512/playstation.png" alt="PlayStation">
          </div>
          <div class="platform-info">
            <h3>PlayStation</h3>
            <span class="platform-status disconnected" id="psnStatus">æœªé…ç½®</span>
          </div>
        </div>

        <div class="platform-data" id="psnData">
          <div class="platform-data-item">
            <span class="platform-data-label">PSN ID</span>
            <span class="platform-data-value" id="psnOnlineId">æœªç»‘å®š</span>
          </div>
          <div class="platform-data-item">
            <span class="platform-data-label">å¥–æ¯ç­‰çº§</span>
            <span class="platform-data-value" id="psnTrophyLevel">-</span>
          </div>
          <div class="platform-data-item">
            <span class="platform-data-label">æ¸¸æˆæ•°é‡</span>
            <span class="platform-data-value" id="psnGameCount">-</span>
          </div>
        </div>

        <div class="platform-actions">
          <button class="platform-btn primary" id="psnConnectBtn" onclick="bindPsnAccount()">
            ç»‘å®š PSN è´¦å·
          </button>
          <button class="platform-btn secondary" onclick="toggleConfig('psn')">
            é…ç½® PSN API
          </button>
        </div>

        <!-- é…ç½®åŒºåŸŸ -->
        <div class="config-section" id="psnConfig">
          <h4>é…ç½® PlayStation Network API</h4>
          <div class="config-input-group">
            <label>NPSSO Token</label>
            <input type="text" id="psnNpsso" placeholder="ç²˜è´´æ‚¨çš„ NPSSO Tokenï¼ˆ64å­—ç¬¦ï¼‰" maxlength="64">
            <p class="hint">
              è®¿é—® <a href="https://ca.account.sony.com/api/v1/ssocookie" target="_blank">Sony SSO Cookie é¡µé¢</a> ç™»å½•åå¤åˆ¶ npsso å€¼
            </p>
          </div>
          <div class="config-input-group">
            <label>ä»£ç†æœåŠ¡å™¨åœ°å€ï¼ˆå¯é€‰ï¼‰</label>
            <input type="text" id="psnProxyUrl" placeholder="http://localhost:3001" value="http://localhost:3001">
            <p class="hint">PSN API éœ€è¦åç«¯ä»£ç†æœåŠ¡å™¨ï¼Œé»˜è®¤ä½¿ç”¨æœ¬åœ° 3001 ç«¯å£</p>
          </div>
          <button class="platform-btn primary" onclick="savePsnConfig()">
            è®¤è¯å¹¶ä¿å­˜
          </button>
          <button class="platform-btn danger" onclick="clearPsnConfig()" style="margin-top: 10px;">
            æ¸…é™¤é…ç½®
          </button>
        </div>
      </div>
    </div>

    <!-- è¿”å›æŒ‰é’® -->
    <div class="back-button">
      <a href="profile.html">â† è¿”å›ç”¨æˆ·ä¸­å¿ƒ</a>
    </div>
  </div>

  <script src="platform-api-service.js"></script>
  <script src="supabase-config.js"></script>
  <script>
    // =============================================
    // å¹³å°è´¦å·ç®¡ç†è„šæœ¬
    // =============================================

    // åˆ‡æ¢é…ç½®é¢æ¿æ˜¾ç¤º
    function toggleConfig(platform) {
      const configSection = document.getElementById(`${platform}Config`);
      configSection.classList.toggle('active');
    }

    // =============================================
    // Epic Games æ‰‹åŠ¨å½•å…¥
    // =============================================
    function saveEpicManual() {
      const username = document.getElementById('epicUsername').value.trim();
      const gameCount = parseInt(document.getElementById('epicGameCount').value) || 0;

      if (!username) {
        alert('è¯·è¾“å…¥æ‚¨çš„ Epic Games ç”¨æˆ·å');
        return;
      }

      // ä¿å­˜åˆ° localStorage
      const epicData = {
        platform: 'epic',
        username: username,
        gameCount: gameCount,
        isManual: true,
        boundAt: new Date().toISOString()
      };

      localStorage.setItem('epic_binding', JSON.stringify(epicData));

      // æ›´æ–°æ˜¾ç¤º
      updateEpicDisplay(epicData);
      
      alert('âœ… Epic Games è´¦å·ä¿¡æ¯å·²ä¿å­˜ï¼');
      toggleConfig('epic');
    }

    function updateEpicDisplay(data) {
      if (data) {
        document.getElementById('epicStatus').textContent = 'å·²æ‰‹åŠ¨å½•å…¥';
        document.getElementById('epicStatus').className = 'platform-status pending';
        document.getElementById('epicCard').classList.add('connected');

        const dataHTML = `
          <div class="platform-data-item">
            <span class="platform-data-label">ç”¨æˆ·å</span>
            <span class="platform-data-value">${data.username}</span>
          </div>
          <div class="platform-data-item">
            <span class="platform-data-label">æ¸¸æˆæ•°é‡</span>
            <span class="platform-data-value">${data.gameCount || 0}</span>
          </div>
          <div class="platform-data-item">
            <span class="platform-data-label">å½•å…¥æ—¶é—´</span>
            <span class="platform-data-value">${new Date(data.boundAt).toLocaleDateString('zh-CN')}</span>
          </div>
        `;
        document.getElementById('epicData').innerHTML = dataHTML;
      }
    }

    // =============================================
    // Xbox API é…ç½®
    // =============================================
    function saveXboxApiKey() {
      const apiKey = document.getElementById('xboxApiKey').value.trim();

      if (!apiKey) {
        alert('è¯·è¾“å…¥ OpenXBL API Key');
        return;
      }

      // ä¿å­˜åˆ° PlatformAPIService
      const result = window.PlatformAPIService.xbox.setApiKey(apiKey);

      if (result) {
        alert('âœ… Xbox API Key å·²ä¿å­˜ï¼\n\nç°åœ¨å¯ä»¥ç»‘å®š Xbox è´¦å·äº†ã€‚');
        updateXboxDisplay();
        toggleConfig('xbox');

        // å¯ç”¨ç»‘å®šæŒ‰é’®
        document.getElementById('xboxConnectBtn').disabled = false;
        document.getElementById('xboxConnectBtn').textContent = 'ğŸ”— ç»‘å®š Xbox è´¦å·';
      } else {
        alert('âŒ API Key ä¿å­˜å¤±è´¥');
      }
    }

    function clearXboxApiKey() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤ Xbox API Key é…ç½®å—ï¼Ÿ')) {
        window.PlatformAPIService.xbox.clearApiKey();
        document.getElementById('xboxApiKey').value = '';
        alert('âœ… Xbox API Key å·²æ¸…é™¤');
        updateXboxDisplay();
        document.getElementById('xboxConnectBtn').disabled = true;
        document.getElementById('xboxConnectBtn').textContent = 'ğŸ”— ç»‘å®š Xbox è´¦å·ï¼ˆéœ€å…ˆé…ç½® API Keyï¼‰';
      }
    }

    function updateXboxDisplay() {
      const status = window.PlatformAPIService.getStatus().xbox;
      
      if (status.enabled) {
        document.getElementById('xboxStatus').textContent = 'API å·²é…ç½®';
        document.getElementById('xboxStatus').className = 'platform-status pending';
      } else {
        document.getElementById('xboxStatus').textContent = 'æœªé…ç½®';
        document.getElementById('xboxStatus').className = 'platform-status disconnected';
      }

      // æ£€æŸ¥æ˜¯å¦å·²ç»‘å®šè´¦å·
      const binding = localStorage.getItem('xbox_binding');
      if (binding) {
        try {
          const data = JSON.parse(binding);
          document.getElementById('xboxGamertag').textContent = data.username || data.gamertag || 'æœªçŸ¥';
          document.getElementById('xboxGamerscore').textContent = data.gamerscore || 0;
          document.getElementById('xboxGameCount').textContent = data.gameCount || 0;
          document.getElementById('xboxStatus').textContent = 'å·²ç»‘å®š';
          document.getElementById('xboxStatus').className = 'platform-status connected';
          document.getElementById('xboxCard').classList.add('connected');
        } catch (e) {}
      }
    }

    // =============================================
    // PlayStation API é…ç½®
    // =============================================
    async function savePsnConfig() {
      const npsso = document.getElementById('psnNpsso').value.trim();
      const proxyUrl = document.getElementById('psnProxyUrl').value.trim();

      if (!npsso) {
        alert('è¯·è¾“å…¥ NPSSO Token');
        return;
      }

      if (npsso.length < 60) {
        alert('NPSSO Token æ ¼å¼ä¸æ­£ç¡®ï¼ˆåº”ä¸º 64 å­—ç¬¦ï¼‰');
        return;
      }

      // è®¾ç½®ä»£ç† URL
      if (proxyUrl) {
        window.PlatformAPIService.playstation.setProxyUrl(proxyUrl);
      }

      // è®¤è¯
      const result = await window.PlatformAPIService.playstation.authenticate(npsso);

      if (result.success) {
        alert('âœ… PSN API è®¤è¯æˆåŠŸï¼\n\nç°åœ¨å¯ä»¥ç»‘å®š PSN è´¦å·äº†ã€‚');
        updatePsnDisplay();
        toggleConfig('psn');

        // å¯ç”¨ç»‘å®šæŒ‰é’®
        document.getElementById('psnConnectBtn').disabled = false;
        document.getElementById('psnConnectBtn').textContent = 'ğŸ”— ç»‘å®š PSN è´¦å·';
      } else {
        alert('âŒ PSN è®¤è¯å¤±è´¥\n\n' + (result.error || 'æœªçŸ¥é”™è¯¯') + '\n\n' + (result.hint || ''));
      }
    }

    function clearPsnConfig() {
      if (confirm('ç¡®å®šè¦æ¸…é™¤ PSN API é…ç½®å—ï¼Ÿ')) {
        window.PlatformAPIService.playstation.clearConfig();
        document.getElementById('psnNpsso').value = '';
        alert('âœ… PSN API é…ç½®å·²æ¸…é™¤');
        updatePsnDisplay();
        document.getElementById('psnConnectBtn').disabled = true;
        document.getElementById('psnConnectBtn').textContent = 'ğŸ”— ç»‘å®š PSN è´¦å·ï¼ˆéœ€å…ˆé…ç½® APIï¼‰';
      }
    }

    function updatePsnDisplay() {
      const status = window.PlatformAPIService.getStatus().playstation;
      
      if (status.enabled) {
        document.getElementById('psnStatus').textContent = 'API å·²é…ç½®';
        document.getElementById('psnStatus').className = 'platform-status pending';
      } else {
        document.getElementById('psnStatus').textContent = 'æœªé…ç½®';
        document.getElementById('psnStatus').className = 'platform-status disconnected';
      }

      // æ£€æŸ¥æ˜¯å¦å·²ç»‘å®šè´¦å·
      const binding = localStorage.getItem('psn_binding');
      if (binding) {
        try {
          const data = JSON.parse(binding);
          document.getElementById('psnOnlineId').textContent = data.username || 'æœªçŸ¥';
          document.getElementById('psnTrophyLevel').textContent = data.trophyLevel || 0;
          document.getElementById('psnGameCount').textContent = data.gameCount || 0;
          document.getElementById('psnStatus').textContent = 'å·²ç»‘å®š';
          document.getElementById('psnStatus').className = 'platform-status connected';
          document.getElementById('psnCard').classList.add('connected');
        } catch (e) {}
      }
    }

    // =============================================
    // é¡µé¢åˆå§‹åŒ–
    // =============================================
    // è´¦å·ç»‘å®šåŠŸèƒ½
    // =============================================
    
    function showEpicHelp() {
      alert(`Epic Games è´¦å·ç»‘å®šå¸®åŠ©
      
ğŸ“š Epic Games æš‚æ— å…¬å¼€ API

Epic Games ç›®å‰ä¸æä¾›å…¬å¼€çš„ç”¨æˆ·æ•°æ® APIï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•è‡ªåŠ¨è·å–æ‚¨çš„æ¸¸æˆåº“å’Œæ¸¸ç©æ•°æ®ã€‚

å¦‚ä½•æŸ¥çœ‹æ‚¨çš„ Epic ç”¨æˆ·åï¼š
1. æ‰“å¼€ Epic Games Launcher
2. ç‚¹å‡»å³ä¸Šè§’çš„ç”¨æˆ·å¤´åƒ
3. æŸ¥çœ‹æ˜¾ç¤ºåç§°ï¼ˆDisplay Nameï¼‰

ğŸ’¡ æç¤ºï¼šæ‚¨å¯ä»¥æ‰‹åŠ¨è¾“å…¥ç”¨æˆ·åå’Œæ¸¸æˆæ•°é‡è¿›è¡Œæ ‡è®°ã€‚`);
    }
    
    async function bindXboxAccount() {
      if (!window.PlatformAPIService.xbox.isEnabled()) {
        alert('è¯·å…ˆé…ç½® Xbox API Key');
        toggleConfig('xbox');
        return;
      }
      
      const gamertag = prompt('è¯·è¾“å…¥æ‚¨çš„ Xbox Gamertag (ç©å®¶æ ‡ç­¾):');
      if (!gamertag) return;
      
      const btn = document.getElementById('xboxConnectBtn');
      btn.disabled = true;
      btn.textContent = 'ç»‘å®šä¸­...';
      
      try {
        const result = await window.PlatformAPIService.bindAccount('xbox', gamertag);
        
        if (result.success) {
          // ä¿å­˜ç»‘å®šæ•°æ®
          localStorage.setItem('xbox_binding', JSON.stringify(result.account));
          
          // æ›´æ–°æ˜¾ç¤º
          document.getElementById('xboxGamertag').textContent = result.account.username || gamertag;
          document.getElementById('xboxGamerscore').textContent = result.account.gamerscore || 0;
          document.getElementById('xboxGameCount').textContent = result.account.gameCount || 0;
          document.getElementById('xboxStatus').textContent = 'å·²ç»‘å®š';
          document.getElementById('xboxStatus').className = 'platform-status connected';
          document.getElementById('xboxCard').classList.add('connected');
          
          alert('âœ… Xbox è´¦å·ç»‘å®šæˆåŠŸï¼\n\n' + 
                `Gamertag: ${result.account.username}\n` +
                `Gamerscore: ${result.account.gamerscore || 0}\n` +
                `æ¸¸æˆæ•°é‡: ${result.account.gameCount || 0}`);
        } else {
          alert('âŒ ç»‘å®šå¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'));
        }
      } catch (error) {
        alert('âŒ ç»‘å®šå¤±è´¥ï¼š' + error.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'ğŸ”— ç»‘å®š Xbox è´¦å·';
      }
    }
    
    async function bindPsnAccount() {
      if (!window.PlatformAPIService.playstation.isEnabled()) {
        alert('è¯·å…ˆé…ç½® PSN NPSSO Token');
        toggleConfig('psn');
        return;
      }
      
      const onlineId = prompt('è¯·è¾“å…¥æ‚¨çš„ PSN Online ID:');
      if (!onlineId) return;
      
      const btn = document.getElementById('psnConnectBtn');
      btn.disabled = true;
      btn.textContent = 'ç»‘å®šä¸­...';
      
      try {
        const result = await window.PlatformAPIService.bindAccount('playstation', onlineId);
        
        if (result.success) {
          // ä¿å­˜ç»‘å®šæ•°æ®
          localStorage.setItem('psn_binding', JSON.stringify(result.account));
          
          // æ›´æ–°æ˜¾ç¤º
          document.getElementById('psnOnlineId').textContent = result.account.username || onlineId;
          document.getElementById('psnTrophyLevel').textContent = result.account.trophyLevel || 0;
          document.getElementById('psnGameCount').textContent = result.account.gameCount || 0;
          document.getElementById('psnStatus').textContent = 'å·²ç»‘å®š';
          document.getElementById('psnStatus').className = 'platform-status connected';
          document.getElementById('psnCard').classList.add('connected');
          
          alert('âœ… PlayStation è´¦å·ç»‘å®šæˆåŠŸï¼\n\n' + 
                `Online ID: ${result.account.username}\n` +
                `å¥–æ¯ç­‰çº§: ${result.account.trophyLevel || 0}\n` +
                `æ¸¸æˆæ•°é‡: ${result.account.gameCount || 0}`);
        } else {
          alert('âŒ ç»‘å®šå¤±è´¥ï¼š' + (result.error || 'æœªçŸ¥é”™è¯¯'));
        }
      } catch (error) {
        alert('âŒ ç»‘å®šå¤±è´¥ï¼š' + error.message);
      } finally {
        btn.disabled = false;
        btn.textContent = 'ğŸ”— ç»‘å®š PSN è´¦å·';
      }
    }
    
    // =============================================
    document.addEventListener('DOMContentLoaded', () => {
      // åŠ è½½ Epic æ•°æ®
      const epicData = localStorage.getItem('epic_binding');
      if (epicData) {
        try {
          updateEpicDisplay(JSON.parse(epicData));
          document.getElementById('epicUsername').value = JSON.parse(epicData).username || '';
          document.getElementById('epicGameCount').value = JSON.parse(epicData).gameCount || '';
        } catch (e) {}
      }

      // åŠ è½½ Xbox é…ç½®
      const xboxApiKey = localStorage.getItem('xbox_api_key');
      if (xboxApiKey) {
        document.getElementById('xboxApiKey').value = xboxApiKey;
      }
      // æ£€æŸ¥ Xbox API æ˜¯å¦å·²å¯ç”¨
      if (window.PlatformAPIService && window.PlatformAPIService.xbox.isEnabled()) {
        document.getElementById('xboxStatus').textContent = 'API å·²é…ç½®';
        document.getElementById('xboxStatus').className = 'platform-status pending';
      }
      updateXboxDisplay();

      // åŠ è½½ PSN é…ç½®
      const psnConfig = localStorage.getItem('psn_api_config');
      if (psnConfig) {
        try {
          const config = JSON.parse(psnConfig);
          if (config.npsso) {
            document.getElementById('psnNpsso').value = config.npsso;
          }
          if (config.proxyUrl) {
            document.getElementById('psnProxyUrl').value = config.proxyUrl;
          }
        } catch (e) {}
      }
      // æ£€æŸ¥ PSN API æ˜¯å¦å·²å¯ç”¨
      if (window.PlatformAPIService && window.PlatformAPIService.playstation.isEnabled()) {
        document.getElementById('psnStatus').textContent = 'API å·²é…ç½®';
        document.getElementById('psnStatus').className = 'platform-status pending';
      }
      updatePsnDisplay();

      console.log('âœ… å¹³å°è´¦å·ç®¡ç†é¡µé¢å·²åˆå§‹åŒ–');
    });
  </script>
</body>
</html>
