<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox æ¸¸ç›’ - ç”¨æˆ·ä¸­å¿ƒ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Cyberpunk Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css" />
  
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    /* ç”¨æˆ·ä¸­å¿ƒä¸“å±æ ·å¼ */
    .profile-container {
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 24px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    @media (max-width: 900px) {
      .profile-container {
        grid-template-columns: 1fr;
      }
    }
    
    .profile-card {
      background: linear-gradient(135deg, rgba(17, 24, 39, 0.95), rgba(31, 41, 55, 0.9));
      border: 1px solid rgba(56, 189, 248, 0.2);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 20px;
    }
    
    .profile-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(56, 189, 248, 0.15);
    }
    
    .profile-card-icon {
      font-size: 24px;
    }
    
    .profile-card-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      font-family: 'Orbitron', sans-serif;
    }
    
    /* ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ */
    .user-header {
      display: flex;
      align-items: center;
      gap: 24px;
      padding: 32px;
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.1), rgba(168, 85, 247, 0.05));
      border-radius: 16px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }
    
    .user-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #00ff88, #00ccff, #a855f7);
    }
    
    .user-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: linear-gradient(135deg, #4fc3f7, #7c4dff);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      box-shadow: 0 0 30px rgba(56, 189, 248, 0.5);
      flex-shrink: 0;
    }
    
    .user-avatar img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .user-info {
      flex: 1;
    }
    
    .user-name {
      font-size: 28px;
      font-weight: 900;
      color: var(--text-main);
      font-family: 'Orbitron', sans-serif;
      margin-bottom: 8px;
    }
    
    .user-email {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }
    
    .user-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .user-badge {
      padding: 4px 12px;
      background: rgba(56, 189, 248, 0.15);
      border: 1px solid rgba(56, 189, 248, 0.3);
      border-radius: 20px;
      font-size: 12px;
      color: var(--accent);
    }
    
    .user-badge.verified {
      background: rgba(0, 255, 136, 0.15);
      border-color: rgba(0, 255, 136, 0.3);
      color: #00ff88;
    }
    
    .user-badge.steam {
      background: rgba(102, 192, 244, 0.15);
      border-color: rgba(102, 192, 244, 0.3);
      color: #66c0f4;
    }
    
    /* ç»Ÿè®¡å¡ç‰‡ */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    .stat-card {
      background: linear-gradient(135deg, rgba(17, 24, 39, 0.9), rgba(31, 41, 55, 0.8));
      border: 1px solid rgba(56, 189, 248, 0.2);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: 900;
      font-family: 'Orbitron', sans-serif;
      color: var(--accent);
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-muted);
    }
    
    /* Steam åŒºåŸŸ */
    .steam-section {
      background: linear-gradient(135deg, rgba(27, 40, 56, 0.95), rgba(20, 30, 45, 0.9));
      border: 1px solid rgba(102, 192, 244, 0.3);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
    }
    
    .steam-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    
    .steam-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .steam-logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #1b2838, #2a475e);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .steam-logo-text {
      font-size: 18px;
      font-weight: 700;
      color: #66c0f4;
    }
    
    .steam-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
    }
    
    .steam-status.linked {
      color: #00ff88;
    }
    
    .steam-status.unlinked {
      color: var(--text-muted);
    }
    
    .steam-profile {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      margin-bottom: 16px;
    }
    
    .steam-avatar {
      width: 64px;
      height: 64px;
      border-radius: 8px;
      overflow: hidden;
    }
    
    .steam-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .steam-user-info {
      flex: 1;
    }
    
    .steam-persona-name {
      font-size: 18px;
      font-weight: 700;
      color: #66c0f4;
      margin-bottom: 4px;
    }
    
    .steam-id {
      font-size: 11px;
      color: var(--text-muted);
      font-family: monospace;
    }
    
    .steam-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 16px;
    }
    
    .steam-stat {
      text-align: center;
      padding: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    
    .steam-stat-value {
      font-size: 20px;
      font-weight: 700;
      color: #66c0f4;
    }
    
    .steam-stat-label {
      font-size: 11px;
      color: var(--text-muted);
    }
    
    /* Steam æ¸¸æˆåˆ—è¡¨ */
    .steam-games-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 20px 0 16px;
    }
    
    .steam-games-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-soft);
    }
    
    .steam-games-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 12px;
      max-height: 400px;
      overflow-y: auto;
      padding-right: 8px;
    }
    
    .steam-game-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .steam-game-item:hover {
      background: rgba(102, 192, 244, 0.1);
    }
    
    .steam-game-img {
      width: 120px;
      height: 45px;
      border-radius: 4px;
      overflow: hidden;
      flex-shrink: 0;
    }
    
    .steam-game-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .steam-game-info {
      flex: 1;
      min-width: 0;
    }
    
    .steam-game-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-soft);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .steam-game-playtime {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 2px;
    }
    
    /* ç»‘å®šè¡¨å• */
    .link-form {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    
    .link-input {
      flex: 1;
      padding: 12px 16px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(102, 192, 244, 0.3);
      border-radius: 8px;
      color: var(--text-main);
      font-size: 14px;
    }
    
    .link-input:focus {
      outline: none;
      border-color: #66c0f4;
    }
    
    .link-btn {
      padding: 12px 24px;
      background: linear-gradient(135deg, #1b2838, #2a475e);
      border: 1px solid rgba(102, 192, 244, 0.5);
      border-radius: 8px;
      color: #66c0f4;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }
    
    .link-btn:hover {
      background: linear-gradient(135deg, #2a475e, #3d6a8e);
      border-color: #66c0f4;
    }
    
    .link-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    /* æŒ‰é’®æ ·å¼ */
    .profile-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, var(--accent), #00ff88);
      border: none;
      border-radius: 8px;
      color: #0a0f1a;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .profile-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(56, 189, 248, 0.4);
    }
    
    .profile-btn.secondary {
      background: transparent;
      border: 1px solid rgba(56, 189, 248, 0.3);
      color: var(--accent);
    }
    
    .profile-btn.danger {
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
    }
    
    .profile-btn.danger:hover {
      background: rgba(239, 68, 68, 0.3);
      box-shadow: none;
    }
    
    /* è®¾ç½®é¡¹ */
    .settings-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 0;
      border-bottom: 1px solid rgba(56, 189, 248, 0.1);
    }
    
    .settings-item:last-child {
      border-bottom: none;
    }
    
    .settings-label {
      font-size: 14px;
      color: var(--text-soft);
    }
    
    .settings-desc {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }
    
    /* å¼€å…³ */
    .toggle-switch {
      position: relative;
      width: 48px;
      height: 26px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(56, 189, 248, 0.2);
      transition: .3s;
      border-radius: 26px;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: var(--text-muted);
      transition: .3s;
      border-radius: 50%;
    }
    
    input:checked + .toggle-slider {
      background-color: var(--accent);
    }
    
    input:checked + .toggle-slider:before {
      transform: translateX(22px);
      background-color: #0a0f1a;
    }
    
    /* ç”¨æˆ·IDæ˜¾ç¤º */
    .user-id-display {
      font-family: 'Orbitron', monospace;
      font-size: 11px;
      color: var(--text-muted);
      background: rgba(0, 0, 0, 0.3);
      padding: 4px 10px;
      border-radius: 4px;
      margin-top: 8px;
      margin-bottom: 8px;
      display: inline-block;
    }
    
    .user-id-display::before {
      content: 'ID: ';
      color: var(--accent);
    }
    
    /* æœªç™»å½•æç¤º */
    .login-prompt {
      text-align: center;
      padding: 60px 20px;
    }
    
    .login-prompt-icon {
      font-size: 64px;
      margin-bottom: 24px;
    }
    
    .login-prompt-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-main);
      margin-bottom: 12px;
    }
    
    .login-prompt-text {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 24px;
    }
    
    /* æ¶ˆæ¯æç¤º */
    .profile-message {
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 13px;
      margin-bottom: 16px;
      display: none;
    }
    
    .profile-message.show {
      display: block;
    }
    
    .profile-message.error {
      background: rgba(239, 68, 68, 0.15);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #ef4444;
    }
    
    .profile-message.success {
      background: rgba(16, 185, 129, 0.15);
      border: 1px solid rgba(16, 185, 129, 0.3);
      color: #10b981;
    }
    
    .profile-message.info {
      background: rgba(56, 189, 248, 0.15);
      border: 1px solid rgba(56, 189, 248, 0.3);
      color: var(--accent);
    }
    
    /* ä¾§è¾¹æ å¿«æ·æ“ä½œ */
    .quick-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .quick-action-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: rgba(17, 24, 39, 0.8);
      border: 1px solid rgba(56, 189, 248, 0.2);
      border-radius: 10px;
      color: var(--text-soft);
      font-size: 14px;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .quick-action-btn:hover {
      border-color: var(--accent);
      background: rgba(56, 189, 248, 0.1);
      color: var(--accent);
    }
    
    .quick-action-icon {
      font-size: 20px;
    }
    
    /* Demo æç¤º */
    .demo-notice {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: 8px;
      padding: 12px 16px;
      font-size: 12px;
      color: #f59e0b;
      margin-top: 12px;
    }
    
    /* æ»šåŠ¨æ¡ç¾åŒ– */
    .steam-games-list::-webkit-scrollbar {
      width: 6px;
    }
    
    .steam-games-list::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
    }
    
    .steam-games-list::-webkit-scrollbar-thumb {
      background: rgba(102, 192, 244, 0.3);
      border-radius: 3px;
    }
    
    .steam-games-list::-webkit-scrollbar-thumb:hover {
      background: rgba(102, 192, 244, 0.5);
    }
  </style>
</head>
<body data-current-page="profile" class="cyberpunk-theme">
<div class="page">
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>
      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          æ’è¡Œæ¦œ <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">æŠ˜æ‰£ / å²ä½</a>
        <a href="community.html" data-page="community" class="nav-link">ç¤¾åŒº</a>
        <a href="news-list.html" data-page="news" class="nav-link">èµ„è®¯</a>
        <a href="tools.html" data-page="tools" class="nav-link">å·¥å…·</a>
        <a href="my-library.html" data-page="my" class="nav-link">æˆ‘çš„æ¸¸æˆ</a>
        <a href="profile.html" data-page="profile" class="nav-link active">ç”¨æˆ·ä¸­å¿ƒ</a>
      </nav>
      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="æœç´¢æ¸¸æˆ / èµ„è®¯ / å¸–å­" />
          <span class="header-search-icon">ğŸ”</span>
        </div>
        <button class="header-user" id="headerUserBtn">æœªç™»å½• Â· æ¸¸å®¢</button>
      </div>
    </div>
  </header>
  
  <!-- Cyberpunk Effects -->
  <canvas id="matrix-canvas" class="matrix-bg"></canvas>
  <div id="particles-container" class="particles-container"></div>
  <div id="scroll-progress" class="scroll-progress"></div>

  <main class="main" style="display: block; padding: 20px;">
    
    <!-- æœªç™»å½•æç¤º -->
    <div id="loginPrompt" class="profile-card login-prompt" style="display: none;">
      <div class="login-prompt-icon">ğŸ”</div>
      <div class="login-prompt-title">è¯·å…ˆç™»å½•</div>
      <div class="login-prompt-text">ç™»å½•åå³å¯è®¿é—®ç”¨æˆ·ä¸­å¿ƒï¼Œç®¡ç†æ‚¨çš„æ¸¸æˆåº“å’Œè´¦å·è®¾ç½®</div>
      <a href="login.html" class="profile-btn" style="display: inline-block; text-decoration: none;">
        å‰å¾€ç™»å½•
      </a>
    </div>
    
    <!-- å·²ç™»å½•å†…å®¹ -->
    <div id="profileContent" class="profile-container" style="display: none;">
      
      <!-- å·¦ä¾§ä¸»å†…å®¹ -->
      <div class="profile-main">
        
        <!-- æ¶ˆæ¯æç¤º -->
        <div id="profileMessage" class="profile-message"></div>
        
        <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
        <div class="user-header">
          <div class="user-avatar" id="userAvatar">ğŸ®</div>
          <div class="user-info">
            <div class="user-name" id="userName">åŠ è½½ä¸­...</div>
            <div class="user-email" id="userEmail">-</div>
            <div class="user-id-display" id="userIdDisplay">-</div>
            <div class="user-badges" id="userBadges">
              <!-- å¾½ç« åŠ¨æ€ç”Ÿæˆ -->
            </div>
          </div>
          <div>
            <a href="profile-edit.html" class="profile-btn secondary">âœï¸ ç¼–è¾‘èµ„æ–™</a>
          </div>
        </div>
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="statOwnedGames">0</div>
            <div class="stat-label">å·²æ‹¥æœ‰æ¸¸æˆ</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statWishlistGames">0</div>
            <div class="stat-label">æƒ³ç©æ¸¸æˆ</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statPlaytime">0</div>
            <div class="stat-label">æ€»æ¸¸æˆæ—¶é•¿</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statLevel">Lv.1</div>
            <div class="stat-label">è´¦å·ç­‰çº§</div>
          </div>
        </div>
        
        <!-- Steam ç»‘å®šåŒºåŸŸ -->
        <div class="steam-section" id="steamSection">
          <div class="steam-header">
            <div class="steam-logo">
              <div class="steam-logo-icon">ğŸ®</div>
              <div class="steam-logo-text">Steam è´¦å·</div>
            </div>
            <div class="steam-status" id="steamStatus">
              <span>â—</span> <span id="steamStatusText">æœªç»‘å®š</span>
            </div>
          </div>
          
          <!-- æœªç»‘å®šçŠ¶æ€ -->
          <div id="steamUnlinked">
            <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">
              ç»‘å®š Steam è´¦å·åï¼Œå¯ä»¥è‡ªåŠ¨åŒæ­¥æ‚¨çš„æ¸¸æˆåº“ã€æ¸¸æˆæ—¶é•¿ç­‰æ•°æ®
            </p>
            
            <div class="link-form">
              <input type="text" class="link-input" id="steamIdInput" 
                placeholder="è¾“å…¥ Steam ID æˆ–ä¸ªäººèµ„æ–™é“¾æ¥" />
              <button class="link-btn" id="linkSteamBtn">ç»‘å®šè´¦å·</button>
            </div>
            
            <div class="demo-notice" id="steamDemoNotice">
              ğŸ’¡ æ¼”ç¤ºæ¨¡å¼ä¸‹å°†æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®ã€‚è·å–çœŸå®æ•°æ®éœ€è¦é…ç½® Steam API Keyã€‚
              <br>æ”¯æŒæ ¼å¼: SteamID64 / steamcommunity.com/profiles/xxx / steamcommunity.com/id/xxx
            </div>
          </div>
          
          <!-- å·²ç»‘å®šçŠ¶æ€ -->
          <div id="steamLinked" style="display: none;">
            <div class="steam-profile">
              <div class="steam-avatar" id="steamAvatar">
                <img src="" alt="Steam Avatar" />
              </div>
              <div class="steam-user-info">
                <div class="steam-persona-name" id="steamPersonaName">-</div>
                <div class="steam-id" id="steamIdDisplay">-</div>
              </div>
              <button class="link-btn" id="syncSteamBtn" style="margin-right: 8px;">ğŸ”„ åŒæ­¥</button>
              <button class="profile-btn danger" id="unlinkSteamBtn">è§£ç»‘</button>
            </div>
            
            <div class="steam-stats">
              <div class="steam-stat">
                <div class="steam-stat-value" id="steamGameCount">0</div>
                <div class="steam-stat-label">Steam æ¸¸æˆ</div>
              </div>
              <div class="steam-stat">
                <div class="steam-stat-value" id="steamPlaytime">0</div>
                <div class="steam-stat-label">æ€»æ—¶é•¿</div>
              </div>
              <div class="steam-stat">
                <div class="steam-stat-value" id="steamRecentCount">0</div>
                <div class="steam-stat-label">è¿‘æœŸæ¸¸ç©</div>
              </div>
            </div>
            
            <div class="steam-games-header">
              <div class="steam-games-title">ğŸ® æ¸¸æˆåº“ (æŒ‰æ¸¸æˆæ—¶é•¿æ’åº)</div>
              <select id="steamGamesSort" style="background: rgba(0,0,0,0.3); border: 1px solid rgba(102,192,244,0.3); border-radius: 4px; padding: 4px 8px; color: var(--text-soft); font-size: 12px;">
                <option value="playtime">æŒ‰æ—¶é•¿</option>
                <option value="recent">æœ€è¿‘æ¸¸ç©</option>
                <option value="name">æŒ‰åç§°</option>
              </select>
            </div>
            
            <div class="steam-games-list" id="steamGamesList">
              <!-- æ¸¸æˆåˆ—è¡¨åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="demo-notice" id="steamLinkedDemoNotice" style="display: none;">
              âš ï¸ å½“å‰æ˜¾ç¤ºçš„æ˜¯æ¼”ç¤ºæ•°æ®ã€‚é…ç½® Steam API Key åå¯è·å–çœŸå®æ¸¸æˆåº“ã€‚
            </div>
          </div>
        </div>
        
        <!-- è´¦å·è®¾ç½® -->
        <div class="profile-card">
          <div class="profile-card-header">
            <span class="profile-card-icon">âš™ï¸</span>
            <span class="profile-card-title">è´¦å·è®¾ç½®</span>
          </div>
          
          <div class="settings-item">
            <div>
              <div class="settings-label">é‚®ç®±é€šçŸ¥</div>
              <div class="settings-desc">æ¥æ”¶æ¸¸æˆæŠ˜æ‰£ã€æ–°é—»ç­‰é‚®ä»¶é€šçŸ¥</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingNotifications" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="settings-item">
            <div>
              <div class="settings-label">å…¬å¼€èµ„æ–™</div>
              <div class="settings-desc">å…è®¸å…¶ä»–ç”¨æˆ·æŸ¥çœ‹æ‚¨çš„æ¸¸æˆåº“</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="settingPublicProfile" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="settings-item">
            <div>
              <div class="settings-label">ä¿®æ”¹å¯†ç </div>
              <div class="settings-desc">æ›´æ–°æ‚¨çš„ç™»å½•å¯†ç </div>
            </div>
            <a href="reset-password.html" class="profile-btn secondary" style="text-decoration: none;">ä¿®æ”¹</a>
          </div>
          
          <div class="settings-item">
            <div>
              <div class="settings-label">é€€å‡ºç™»å½•</div>
              <div class="settings-desc">å®‰å…¨é€€å‡ºå½“å‰è´¦å·</div>
            </div>
            <button class="profile-btn danger" id="logoutBtn">é€€å‡º</button>
          </div>
        </div>
      </div>
      
      <!-- å³ä¾§è¾¹æ  -->
      <div class="profile-sidebar">
        
        <!-- å¿«æ·æ“ä½œ -->
        <div class="profile-card">
          <div class="profile-card-header">
            <span class="profile-card-icon">âš¡</span>
            <span class="profile-card-title">å¿«æ·æ“ä½œ</span>
          </div>
          <div class="quick-actions">
            <a href="my-library.html" class="quick-action-btn">
              <span class="quick-action-icon">ğŸ“š</span>
              <span>æˆ‘çš„æ¸¸æˆåº“</span>
            </a>
            <a href="tools.html" class="quick-action-btn">
              <span class="quick-action-icon">ğŸ”§</span>
              <span>é…ç½®æ£€æµ‹å·¥å…·</span>
            </a>
            <a href="discount.html" class="quick-action-btn">
              <span class="quick-action-icon">ğŸ’°</span>
              <span>æŸ¥çœ‹æŠ˜æ‰£æ¸¸æˆ</span>
            </a>
            <a href="ranking.html" class="quick-action-btn">
              <span class="quick-action-icon">ğŸ†</span>
              <span>çƒ­é—¨æ’è¡Œæ¦œ</span>
            </a>
          </div>
        </div>
        
        <!-- æœ€è¿‘æ´»åŠ¨ -->
        <div class="profile-card">
          <div class="profile-card-header">
            <span class="profile-card-icon">ğŸ“Š</span>
            <span class="profile-card-title">æœ€è¿‘æ´»åŠ¨</span>
          </div>
          <div id="recentActivity" style="font-size: 13px; color: var(--text-muted);">
            <p>æš‚æ— æœ€è¿‘æ´»åŠ¨è®°å½•</p>
          </div>
        </div>
        
        <!-- å¸®åŠ©ä¿¡æ¯ -->
        <div class="profile-card" style="background: linear-gradient(135deg, rgba(0, 255, 136, 0.05), rgba(56, 189, 248, 0.05));">
          <div class="profile-card-header">
            <span class="profile-card-icon">ğŸ’¡</span>
            <span class="profile-card-title" style="color: #00ff88;">ä½¿ç”¨æç¤º</span>
          </div>
          <div style="font-size: 12px; color: var(--text-soft); line-height: 1.8;">
            <p>â€¢ ç»‘å®š Steam è´¦å·å¯è‡ªåŠ¨åŒæ­¥æ¸¸æˆåº“</p>
            <p>â€¢ Steam èµ„æ–™éœ€è®¾ä¸ºå…¬å¼€æ‰èƒ½è·å–æ¸¸æˆæ•°æ®</p>
            <p>â€¢ æœ¬åœ°æ ‡è®°çš„æ¸¸æˆä¼šä¿å­˜åœ¨æµè§ˆå™¨ä¸­</p>
            <p>â€¢ é…ç½® Supabase å¯è·¨è®¾å¤‡åŒæ­¥æ•°æ®</p>
          </div>
        </div>
      </div>
    </div>
  </main>
  
  <footer class="footer">
    GameBox æ¸¸ç›’ Â· ç”¨æˆ·ä¸­å¿ƒ Â· Powered by Steam & Supabase
  </footer>
</div>

<script src="common.js"></script>
<script src="cyber-effects.js"></script>
<script src="supabase-config.js"></script>
<script>
  // =============================================
  // é¡µé¢åˆå§‹åŒ–
  // =============================================
  
  initCommon();
  
  const loginPrompt = document.getElementById('loginPrompt');
  const profileContent = document.getElementById('profileContent');
  const profileMessage = document.getElementById('profileMessage');
  
  let currentUser = null;
  let userData = null;
  
  // =============================================
  // åˆå§‹åŒ–
  // =============================================
  
  async function init() {
    await GameBoxAuth.init();
    SteamAPI.init();
    
    currentUser = await GameBoxAuth.getCurrentUser();
    
    if (currentUser) {
      loginPrompt.style.display = 'none';
      profileContent.style.display = 'grid';
      
      // åŠ è½½ç”¨æˆ·æ•°æ®
      userData = UserDataManager.getData(currentUser.id);
      
      renderUserInfo();
      renderStats();
      renderSteamSection();
      updateHeaderUser();
    } else {
      loginPrompt.style.display = 'block';
      profileContent.style.display = 'none';
    }
  }
  
  // =============================================
  // æ¸²æŸ“ç”¨æˆ·ä¿¡æ¯
  // =============================================
  
  function renderUserInfo() {
    document.getElementById('userName').textContent = currentUser.username || 'ç©å®¶';
    document.getElementById('userEmail').textContent = currentUser.email || '-';
    document.getElementById('userIdDisplay').textContent = currentUser.id || '-';
    
    // å¤´åƒ - ä¼˜å…ˆä½¿ç”¨è‡ªå®šä¹‰å¤´åƒï¼Œå…¶æ¬¡Steamå¤´åƒï¼Œæœ€åè¡¨æƒ…
    const avatarEl = document.getElementById('userAvatar');
    if (userData.customAvatar) {
      avatarEl.innerHTML = `<img src="${userData.customAvatar}" alt="Avatar" />`;
    } else if (userData.useSteamAvatar && userData.steam?.linked && userData.steam?.avatar) {
      avatarEl.innerHTML = `<img src="${userData.steam.avatar}" alt="Avatar" />`;
    } else if (userData.steam?.linked && userData.steam?.avatar && !currentUser.avatar) {
      avatarEl.innerHTML = `<img src="${userData.steam.avatar}" alt="Avatar" />`;
    } else {
      avatarEl.textContent = currentUser.avatar || 'ğŸ®';
    }
    
    // å¾½ç« 
    const badgesEl = document.getElementById('userBadges');
    let badges = '';
    
    if (currentUser.email_confirmed) {
      badges += '<span class="user-badge verified">âœ“ å·²éªŒè¯</span>';
    }
    
    if (userData.steam?.linked) {
      badges += '<span class="user-badge steam">ğŸ® Steam å·²ç»‘å®š</span>';
    }
    
    badges += '<span class="user-badge">Lv.' + calculateLevel() + '</span>';
    
    badgesEl.innerHTML = badges;
  }
  
  // =============================================
  // æ¸²æŸ“ç»Ÿè®¡æ•°æ®
  // =============================================
  
  function renderStats() {
    // æœ¬åœ°æ¸¸æˆæ•°æ®
    const ownedGames = getLocalArray('ownedGames');
    const wishlistGames = getLocalArray('wishlistGames');
    
    // æ€»æ¸¸æˆæ•° (æœ¬åœ° + Steam)
    let totalOwned = ownedGames.length;
    if (userData.steam?.linked && userData.steam?.gameCount) {
      totalOwned = Math.max(totalOwned, userData.steam.gameCount);
    }
    
    document.getElementById('statOwnedGames').textContent = totalOwned;
    document.getElementById('statWishlistGames').textContent = wishlistGames.length;
    
    // æ¸¸æˆæ—¶é•¿
    let totalPlaytime = userData.steam?.totalPlaytime || 0;
    document.getElementById('statPlaytime').textContent = formatPlaytimeShort(totalPlaytime);
    
    // ç­‰çº§
    document.getElementById('statLevel').textContent = 'Lv.' + calculateLevel();
  }
  
  function calculateLevel() {
    let points = 0;
    
    // æœ¬åœ°æ¸¸æˆ
    points += getLocalArray('ownedGames').length * 10;
    points += getLocalArray('wishlistGames').length * 2;
    
    // Steam æ•°æ®
    if (userData.steam?.linked) {
      points += userData.steam.gameCount * 5;
      points += Math.floor(userData.steam.totalPlaytime / 60); // æ¯å°æ—¶1ç‚¹
    }
    
    // è®¡ç®—ç­‰çº§
    if (points >= 1000) return 10;
    if (points >= 500) return 8;
    if (points >= 300) return 6;
    if (points >= 150) return 4;
    if (points >= 50) return 2;
    return 1;
  }
  
  function formatPlaytimeShort(minutes) {
    if (minutes < 60) return minutes + 'åˆ†';
    const hours = Math.floor(minutes / 60);
    if (hours < 24) return hours + 'å°æ—¶';
    const days = Math.floor(hours / 24);
    return days + 'å¤©';
  }
  
  function getLocalArray(key) {
    try {
      return JSON.parse(localStorage.getItem(key) || '[]');
    } catch {
      return [];
    }
  }
  
  // =============================================
  // Steam åŒºåŸŸæ¸²æŸ“
  // =============================================
  
  function renderSteamSection() {
    const steamUnlinked = document.getElementById('steamUnlinked');
    const steamLinked = document.getElementById('steamLinked');
    const steamStatus = document.getElementById('steamStatus');
    const steamStatusText = document.getElementById('steamStatusText');
    
    if (userData.steam?.linked) {
      steamUnlinked.style.display = 'none';
      steamLinked.style.display = 'block';
      steamStatus.className = 'steam-status linked';
      steamStatusText.textContent = 'å·²ç»‘å®š';
      
      // æ¸²æŸ“ Steam ä¿¡æ¯
      document.getElementById('steamAvatar').querySelector('img').src = userData.steam.avatar || '';
      document.getElementById('steamPersonaName').textContent = userData.steam.personaName || '-';
      document.getElementById('steamIdDisplay').textContent = 'Steam ID: ' + userData.steam.steamId;
      
      // ç»Ÿè®¡
      document.getElementById('steamGameCount').textContent = userData.steam.gameCount || 0;
      document.getElementById('steamPlaytime').textContent = formatPlaytimeShort(userData.steam.totalPlaytime || 0);
      
      // æœ€è¿‘æ¸¸ç©æ•°
      const recentGames = (userData.steam.games || []).filter(g => g.playtime2Weeks > 0);
      document.getElementById('steamRecentCount').textContent = recentGames.length;
      
      // æ¸²æŸ“æ¸¸æˆåˆ—è¡¨
      renderSteamGames(userData.steam.games || []);
      
      // æ£€æŸ¥æ˜¯å¦æ˜¯æ¼”ç¤ºæ•°æ®
      // (é€šè¿‡æ£€æŸ¥ localStorage ä¸­ä¿å­˜çš„æ•°æ®æ˜¯å¦æœ‰ isDemo æ ‡è®°)
      if (!SteamAPI.isEnabled()) {
        document.getElementById('steamLinkedDemoNotice').style.display = 'block';
      }
    } else {
      steamUnlinked.style.display = 'block';
      steamLinked.style.display = 'none';
      steamStatus.className = 'steam-status unlinked';
      steamStatusText.textContent = 'æœªç»‘å®š';
    }
  }
  
  function renderSteamGames(games, sortBy = 'playtime') {
    const gamesList = document.getElementById('steamGamesList');
    
    if (!games || games.length === 0) {
      gamesList.innerHTML = '<p style="color: var(--text-muted); padding: 20px; text-align: center;">æš‚æ— æ¸¸æˆæ•°æ®</p>';
      return;
    }
    
    // æ’åº
    let sortedGames = [...games];
    switch (sortBy) {
      case 'playtime':
        sortedGames.sort((a, b) => (b.playtimeForever || 0) - (a.playtimeForever || 0));
        break;
      case 'recent':
        sortedGames.sort((a, b) => (b.playtime2Weeks || 0) - (a.playtime2Weeks || 0));
        break;
      case 'name':
        sortedGames.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
        break;
    }
    
    gamesList.innerHTML = sortedGames.map(game => `
      <div class="steam-game-item" onclick="window.open('https://store.steampowered.com/app/${game.appId}', '_blank')" style="cursor: pointer;" title="ç‚¹å‡»æŸ¥çœ‹Steamå•†åº—é¡µé¢">
        <div class="steam-game-img">
          <img src="${game.headerImage}" alt="${game.name}" onerror="this.src='https://via.placeholder.com/120x45/1b2838/66c0f4?text=No+Image'" />
        </div>
        <div class="steam-game-info">
          <div class="steam-game-name">${game.name}</div>
          <div class="steam-game-playtime">
            <span style="color: #66c0f4;">â±</span> ${SteamAPI.formatPlaytime(game.playtimeForever || 0)}
            ${game.playtime2Weeks > 0 ? `<span style="color: #00ff88; margin-left: 8px;">ğŸ”¥ è¿‘ä¸¤å‘¨: ${SteamAPI.formatPlaytime(game.playtime2Weeks)}</span>` : ''}
          </div>
        </div>
        <div style="font-size: 12px; color: var(--text-muted);">ğŸ”—</div>
      </div>
    `).join('');
  }
  
  // =============================================
  // äº‹ä»¶å¤„ç†
  // =============================================
  
  // ç»‘å®š Steam
  document.getElementById('linkSteamBtn').addEventListener('click', async () => {
    const steamInput = document.getElementById('steamIdInput');
    const btn = document.getElementById('linkSteamBtn');
    const steamIdOrUrl = steamInput.value.trim();
    
    if (!steamIdOrUrl) {
      showMessage('è¯·è¾“å…¥ Steam ID æˆ–ä¸ªäººèµ„æ–™é“¾æ¥', 'error');
      return;
    }
    
    btn.disabled = true;
    btn.textContent = 'ç»‘å®šä¸­...';
    
    try {
      const result = await UserDataManager.linkSteam(currentUser.id, steamIdOrUrl);
      
      if (result.success) {
        userData = UserDataManager.getData(currentUser.id);
        renderUserInfo();
        renderStats();
        renderSteamSection();
        
        let message = result.message;
        if (result.isDemo) {
          message += ' (æ¼”ç¤ºæ•°æ®)';
        }
        showMessage(message, 'success');
      } else {
        showMessage(result.error, 'error');
      }
    } catch (error) {
      showMessage('ç»‘å®šå¤±è´¥: ' + error.message, 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'ç»‘å®šè´¦å·';
    }
  });
  
  // åŒæ­¥ Steam
  document.getElementById('syncSteamBtn').addEventListener('click', async () => {
    const btn = document.getElementById('syncSteamBtn');
    btn.disabled = true;
    btn.textContent = 'åŒæ­¥ä¸­...';
    
    try {
      const result = await UserDataManager.syncSteam(currentUser.id);
      
      if (result.success) {
        userData = UserDataManager.getData(currentUser.id);
        renderStats();
        renderSteamSection();
        showMessage('Steam æ•°æ®å·²åŒæ­¥', 'success');
      } else {
        showMessage(result.error, 'error');
      }
    } catch (error) {
      showMessage('åŒæ­¥å¤±è´¥: ' + error.message, 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'ğŸ”„ åŒæ­¥';
    }
  });
  
  // è§£ç»‘ Steam
  document.getElementById('unlinkSteamBtn').addEventListener('click', () => {
    if (confirm('ç¡®å®šè¦è§£ç»‘ Steam è´¦å·å—ï¼Ÿè¿™å°†æ¸…é™¤å·²åŒæ­¥çš„æ¸¸æˆæ•°æ®ã€‚')) {
      UserDataManager.unlinkSteam(currentUser.id);
      userData = UserDataManager.getData(currentUser.id);
      renderUserInfo();
      renderStats();
      renderSteamSection();
      showMessage('Steam è´¦å·å·²è§£ç»‘', 'info');
    }
  });
  
  // æ¸¸æˆæ’åº
  document.getElementById('steamGamesSort').addEventListener('change', (e) => {
    renderSteamGames(userData.steam?.games || [], e.target.value);
  });
  
  // ç™»å‡º
  document.getElementById('logoutBtn').addEventListener('click', async () => {
    if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
      await GameBoxAuth.signOut();
      window.location.href = 'login.html';
    }
  });
  
  // =============================================
  // å·¥å…·å‡½æ•°
  // =============================================
  
  function showMessage(text, type = 'info') {
    profileMessage.textContent = text;
    profileMessage.className = 'profile-message show ' + type;
    
    setTimeout(() => {
      profileMessage.classList.remove('show');
    }, 5000);
  }
  
  async function updateHeaderUser() {
    const headerBtn = document.getElementById('headerUserBtn');
    if (currentUser) {
      headerBtn.textContent = currentUser.username;
      headerBtn.style.color = 'var(--accent)';
    }
  }
  
  // =============================================
  // å¯åŠ¨
  // =============================================
  
  init();
</script>
</body>
</html>
