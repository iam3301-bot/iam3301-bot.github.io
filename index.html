<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox 游盒 - 首页</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="index.css" />
</head>
<body data-current-page="home">
<div class="page">
  <!-- 顶部导航 -->
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox 游盒</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">首页</a>
        <a href="news-list.html" data-page="news" class="nav-link">资讯</a>
        <a href="game-library.html" data-page="library" class="nav-link">游戏库</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          排行榜 <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">折扣 / 史低</a>
        <a href="community.html" data-page="community" class="nav-link">社区</a>
        <a href="my-library.html" data-page="my" class="nav-link">我的游戏</a>
        <a href="tools.html" data-page="tools" class="nav-link">工具中心</a>
        <a href="profile.html" data-page="profile" class="nav-link">用户中心</a>
      </nav>

      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="搜索游戏 / 资讯 / 帖子" />
          <span class="header-search-icon">🔍</span>
        </div>
        <button class="header-user">未登录 · 游客</button>
      </div>
    </div>
  </header>

  <main class="main">
    <section>
      <!-- 顶部简介 -->
      <div class="card">
        <div class="page-title">发现好游戏</div>
        <div class="page-intro">从排行榜和类型开始逛逛，看看最近大家都在玩什么。</div>
      </div>

      <!-- 热门游戏排行榜（可滚动 + 持续加载 + 封面图） -->
      <article class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>热门游戏排行榜</span>
          </div>
          <div class="ranking-tabs" id="rankingTabs">
            <button class="ranking-tab is-active" data-type="hot">热度</button>
            <button class="ranking-tab" data-type="score">评分</button>
            <button class="ranking-tab" data-type="new">新品</button>
            <button class="ranking-tab" data-type="discount">折扣</button>
          </div>
        </header>
        <div class="card-subtitle">
            
        </div>
        <ol class="ranking-list ranking-list--scroll" id="rankingList"></ol>
        <div id="rankingHint" style="font-size:11px;color:var(--text-soft);margin-top:4px;">
          已加载 <span id="rankingLoaded">0</span> / <span id="rankingTotal">0</span> 款
        </div>
      </article>

      <!-- 按类型浏览 -->
      <article class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>按类型浏览游戏</span>
          </div>
        </header>
        <div class="card-subtitle">
          常见类型 / 标签一键进入对应列表页
        </div>
        <div class="category-grid" id="categoryGrid">
          <div class="category-chip is-active" data-category="all">
            <div class="category-name">全部</div>
            <div class="category-meta">共 999+ 款 · 不做选择困难症</div>
          </div>
          <div class="category-chip" data-category="action">
            <div class="category-name">动作 / ACT</div>
            <div class="category-meta">爽快打击 · 即时操作</div>
          </div>
          <div class="category-chip" data-category="rpg">
            <div class="category-name">角色扮演 / RPG</div>
            <div class="category-meta">剧情驱动 · 养成成长</div>
          </div>
          <div class="category-chip" data-category="strategy">
            <div class="category-name">策略 / SLG</div>
            <div class="category-meta">战术博弈 · 布局取胜</div>
          </div>
          <div class="category-chip" data-category="indie">
            <div class="category-name">独立 / Indie</div>
            <div class="category-meta">小体量 · 大创意</div>
          </div>
          <div class="category-chip" data-category="multiplayer">
            <div class="category-name">多人联机</div>
            <div class="category-meta">和朋友一起快乐开黑</div>
          </div>
          <div class="category-chip" data-category="casual">
            <div class="category-name">休闲 / 轻度</div>
            <div class="category-meta">下班后放松一下</div>
          </div>
          <div class="category-chip" data-category="free">
            <div class="category-name">免费 / F2P</div>
            <div class="category-meta">0 元入坑 · 氪不氪看你</div>
          </div>
        </div>
      </article>
    </section>

    <aside>
      <div class="sidebar-card">
        <div class="sidebar-title">当前平台热度</div>
        <div class="sidebar-item">
          <span class="label">Steam</span><span class="value">🔥 87</span>
        </div>
        <div class="sidebar-item">
          <span class="label">PlayStation</span><span class="value">78</span>
        </div>
        <div class="sidebar-item">
          <span class="label">Switch</span><span class="value">74</span>
        </div>
        <div class="sidebar-item">
          <span class="label">手机游戏</span><span class="value">81</span>
        </div>
      </div>

      <div class="sidebar-card">
        <div class="sidebar-title">正在打折</div>
        <div class="sidebar-item">
          <span class="label">赛博朋克 2077</span><span class="value">-50%</span>
        </div>
        <div class="sidebar-item">
          <span class="label">艾尔登法环</span><span class="value">-30%</span>
        </div>
        <div class="sidebar-item">
          <span class="label">空洞骑士</span><span class="value">-60%</span>
        </div>
      </div>
    </aside>
  </main>
</div>

<script src="common.js"></script>
<script>
  // 通用部分（导航高亮 + 登录状态 + 顶部搜索）
  initCommon();

  // ====== 1. 排行榜数据（带封面图）======

  // 提示：这些 cover 路径需要你自己在 /images 下放图片文件，可以改成你实际使用的文件名
  const rankingData = {
    hot: [
      { name: "艾尔登法环", platform: "Steam · ACT RPG", score: 9.4, tag: "热度第 1", cover: "images/elden-ring.jpg" },
      { name: "原神", platform: "PC / 移动 · 开放世界", score: 8.8, tag: "在线人数高", cover: "images/genshin.jpg" },
      { name: "CS2", platform: "Steam · FPS", score: 8.6, tag: "竞技向", cover: "images/cs2.jpg" },
      { name: "绝地求生", platform: "Steam · 吃鸡", score: 8.0, tag: "经典老牌", cover: "images/pubg.jpg" },
      { name: "怪物猎人：崛起", platform: "Switch / PC", score: 8.5, tag: "刷刷刷", cover: "images/mh-rise.jpg" },
      { name: "英雄联盟", platform: "PC · MOBA", score: 8.3, tag: "网吧标配", cover: "images/lol.jpg" },
      { name: "DOTA 2", platform: "Steam · MOBA", score: 8.4, tag: "老牌竞技", cover: "images/dota2.jpg" },
      { name: "APEX 英雄", platform: "多平台 · 吃鸡", score: 8.1, tag: "动作流畅", cover: "images/apex.jpg" },
      { name: "瓦罗兰特", platform: "PC · FPS", score: 8.2, tag: "新生代战术射击", cover: "images/valorant.jpg" },
      { name: "守望先锋 2", platform: "多平台 · 英雄射击", score: 7.9, tag: "多人对战", cover: "images/overwatch2.jpg" }
    ],
    score: [
      { name: "巫师 3：狂猎", platform: "Steam · RPG", score: 9.7, tag: "神作殿堂", cover: "images/witcher3.jpg" },
      { name: "空洞骑士", platform: "多平台 · 独立", score: 9.6, tag: "独立神作", cover: "images/hollow-knight.jpg" },
      { name: "黑暗之魂 3", platform: "Steam · ARPG", score: 9.3, tag: "受虐狂最爱", cover: "images/ds3.jpg" },
      { name: "只狼：影逝二度", platform: "Steam · ACT", score: 9.2, tag: "强烈推荐", cover: "images/sekiro.jpg" },
      { name: "塞尔达：旷野之息", platform: "Switch", score: 9.8, tag: "开放世界标杆", cover: "images/zelda-botw.jpg" },
      { name: "杀戮尖塔", platform: "多平台 · 卡牌", score: 9.0, tag: "Roguelike 代表", cover: "images/slay-the-spire.jpg" },
      { name: "星露谷物语", platform: "多平台 · 休闲", score: 9.3, tag: "农场人生", cover: "images/stardew.jpg" },
      { name: "蔚蓝", platform: "多平台 · 独立", score: 9.2, tag: "手残克星", cover: "images/celeste.jpg" }
    ],
    new: [
      { name: "虚构新品 A", platform: "Steam · Roguelike", score: 8.4, tag: "新发售", cover: "images/new-a.jpg" },
      { name: "虚构新品 B", platform: "PC / 主机", score: 8.1, tag: "口碑不错", cover: "images/new-b.jpg" },
      { name: "虚构新品 C", platform: "移动 · RPG", score: 7.8, tag: "预约火热", cover: "images/new-c.jpg" },
      { name: "虚构新品 D", platform: "Steam · 独立", score: 8.6, tag: "小众精品", cover: "images/new-d.jpg" },
      { name: "虚构新品 E", platform: "Switch", score: 8.0, tag: "家庭向", cover: "images/new-e.jpg" },
      { name: "虚构新品 F", platform: "Steam", score: 8.2, tag: "抢先体验", cover: "images/new-f.jpg" },
      { name: "虚构新品 G", platform: "PS5", score: 8.5, tag: "主机佳作", cover: "images/new-g.jpg" }
    ],
    discount: [
      { name: "赛博朋克 2077", platform: "Steam · RPG", score: 8.7, tag: "史低 -50%", cover: "images/cp2077.jpg" },
      { name: "怪物猎人：世界", platform: "Steam · 狩猎", score: 8.9, tag: "-60%", cover: "images/mh-world.jpg" },
      { name: "仁王 2", platform: "Steam · 动作", score: 8.5, tag: "-70%", cover: "images/nioh2.jpg" },
      { name: "控制", platform: "多平台 · 超自然", score: 8.3, tag: "-65%", cover: "images/control.jpg" },
      { name: "空洞骑士", platform: "多平台 · 独立", score: 9.6, tag: "-60%", cover: "images/hollow-knight.jpg" },
      { name: "黑帝斯", platform: "多平台 · Roguelike", score: 9.1, tag: "-40%", cover: "images/hades.jpg" },
      { name: "只狼：影逝二度", platform: "Steam · ACT", score: 9.2, tag: "-50%", cover: "images/sekiro.jpg" }
    ]
  };

  // ====== 2. 无限滚动逻辑 ======

  const rankingListEl = document.getElementById("rankingList");
  const rankingTabsEl = document.getElementById("rankingTabs");
  const rankingLoadedEl = document.getElementById("rankingLoaded");
  const rankingTotalEl = document.getElementById("rankingTotal");

  const PAGE_SIZE = 5;                        // 每次加载 5 个
  const loadedCount = { hot: 0, score: 0, new: 0, discount: 0 };
  let currentType = "hot";

  function updateCounter() {
    const total = (rankingData[currentType] || []).length;
    const loaded = loadedCount[currentType] || 0;
    rankingLoadedEl.textContent = loaded;
    rankingTotalEl.textContent = total;
  }

  function appendItems(type) {
    const data = rankingData[type] || [];
    const start = loadedCount[type] || 0;
    if (start >= data.length) return;       // 已经到底了

    const end = Math.min(start + PAGE_SIZE, data.length);

    for (let i = start; i < end; i++) {
      const item = data[i];
      const li = document.createElement("li");
      li.className = "ranking-item";
      li.innerHTML = `
        <div class="ranking-pos ${i === 0 ? "ranking-pos--top1" : ""}">${i + 1}</div>
        <div class="ranking-game">
          <div class="ranking-cover">
            <img src="${item.cover}" alt="${item.name} 封面" />
          </div>
          <div class="ranking-info">
            <div class="ranking-name">${item.name}</div>
            <div class="ranking-meta">${item.platform}</div>
          </div>
        </div>
        <div class="ranking-score">
          <span class="value">${item.score.toFixed(1)}</span>
          <div><span class="tag">${item.tag}</span></div>
        </div>
      `;
      li.addEventListener("click", () => {
        if (item.name === "艾尔登法环") {
          window.location.href = "game-detail.html";
        }
      });
      rankingListEl.appendChild(li);
    }

    loadedCount[type] = end;
    updateCounter();
  }

  function resetAndRender(type) {
    currentType = type;
    rankingListEl.innerHTML = "";
    loadedCount[type] = 0;
    appendItems(type);
  }

  // 滚动到底部时自动加载更多
  rankingListEl.addEventListener("scroll", () => {
    const el = rankingListEl;
    if (el.scrollTop + el.clientHeight >= el.scrollHeight - 4) {
      appendItems(currentType);
    }
  });

  // Tab 切换
  rankingTabsEl.addEventListener("click", (e) => {
    const btn = e.target.closest(".ranking-tab");
    if (!btn) return;
    rankingTabsEl.querySelectorAll(".ranking-tab").forEach((b) => b.classList.remove("is-active"));
    btn.classList.add("is-active");
    const type = btn.dataset.type;
    resetAndRender(type);
  });

  // 初始：加载热度榜
  resetAndRender("hot");

  // ====== 3. 分类点击跳转游戏库 ======
  document.getElementById("categoryGrid").addEventListener("click", (e) => {
    const chip = e.target.closest(".category-chip");
    if (!chip) return;
    document.querySelectorAll(".category-chip").forEach((c) => c.classList.remove("is-active"));
    chip.classList.add("is-active");
    const cat = chip.dataset.category;
    if (cat !== "all") {
      window.location.href = "game-library.html?cat=" + encodeURIComponent(cat);
    }
  });
</script>
</body>
</html>
