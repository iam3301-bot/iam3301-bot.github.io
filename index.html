<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GameBox æ¸¸ç›’ - é¦–é¡µ</title>
  <!-- Cyberpunk Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css" />
</head>
<body data-current-page="home">
<div class="page">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="news-list.html" data-page="news" class="nav-link">èµ„è®¯</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          æ’è¡Œæ¦œ <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">æŠ˜æ‰£ / å²ä½</a>
        <a href="community.html" data-page="community" class="nav-link">ç¤¾åŒº</a>
        <a href="my-library.html" data-page="my" class="nav-link">æˆ‘çš„æ¸¸æˆ</a>
        <a href="tools.html" data-page="tools" class="nav-link">å·¥å…·ä¸­å¿ƒ</a>
        <a href="profile.html" data-page="profile" class="nav-link">ç”¨æˆ·ä¸­å¿ƒ</a>
      </nav>

      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="æœç´¢æ¸¸æˆ / èµ„è®¯ / å¸–å­" />
          <span class="header-search-icon">ğŸ”</span>
        </div>
        <button class="header-user">æœªç™»å½• Â· æ¸¸å®¢</button>
      </div>
    </div>
  </header>

  <!-- ä¸»ä½“ -->
  <main class="main">
    <section>
      <!-- é¡¶éƒ¨ä»‹ç» -->
      <div class="card">
        <div class="page-title">å‘ç°å¥½æ¸¸æˆ</div>
        <div class="page-intro">
          ä»çƒ­é—¨æ¦œã€è¯„åˆ†æ¦œå’Œç±»å‹å¼€å§‹é€›é€›ï¼Œçœ‹çœ‹æœ€è¿‘å¤§å®¶éƒ½åœ¨ç©ä»€ä¹ˆã€‚
        </div>
      </div>

      <!-- é¦–é¡µçƒ­é—¨æ’è¡Œæ¦œå¡ç‰‡ -->
      <article class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>çƒ­é—¨æ¸¸æˆæ’è¡Œæ¦œ</span>
          </div>
          <div class="ranking-tabs" id="rankingTabs">
            <button class="ranking-tab is-active" data-type="hot">çƒ­åº¦</button>
            <button class="ranking-tab" data-type="score">è¯„åˆ†</button>
            <button class="ranking-tab" data-type="new">æ–°å“</button>
            <button class="ranking-tab" data-type="discount">æŠ˜æ‰£</button>
          </div>
        </header>
        <div class="card-subtitle">
          åˆ—è¡¨æ”¯æŒæ»šåŠ¨ï¼Œå½“æ»šåŠ¨åˆ°åº•éƒ¨ä¼šæŒç»­åŠ è½½æ›´å¤šï¼ˆæ•°æ®æ¥è‡ª <code>ranking.json</code>ï¼‰ã€‚
        </div>
        <ol class="ranking-list ranking-list--scroll" id="rankingList"></ol>
        <div id="rankingHint" class="ranking-hint">
          å·²åŠ è½½ <span id="rankingLoaded">0</span> / <span id="rankingTotal">0</span> æ¬¾
        </div>
      </article>

      <!-- æŒ‰ç±»å‹æµè§ˆ -->
      <article class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>æŒ‰ç±»å‹å¿«é€Ÿæ‰¾æ¸¸æˆ</span>
          </div>
        </header>
        <div class="card-subtitle">
          å¸¸è§ç±»å‹ / æ ‡ç­¾ä¸€é”®è·³è½¬åˆ°æ¸¸æˆåº“é¡µé¢ï¼ˆå¸¦ç±»å‹å‚æ•°ï¼‰ã€‚
        </div>
        <div class="category-grid" id="categoryGrid">
          <div class="category-chip is-active" data-category="all">
            <div class="category-name">å…¨éƒ¨</div>
            <div class="category-meta">å…± 999+ æ¬¾ Â· ä¸åšé€‰æ‹©å›°éš¾ç—‡</div>
          </div>
          <div class="category-chip" data-category="action">
            <div class="category-name">åŠ¨ä½œ / ACT</div>
            <div class="category-meta">çˆ½å¿«æ‰“å‡» Â· å³æ—¶æ“ä½œ</div>
          </div>
          <div class="category-chip" data-category="rpg">
            <div class="category-name">è§’è‰²æ‰®æ¼” / RPG</div>
            <div class="category-meta">å‰§æƒ…é©±åŠ¨ Â· å…»æˆæˆé•¿</div>
          </div>
          <div class="category-chip" data-category="strategy">
            <div class="category-name">ç­–ç•¥ / SLG</div>
            <div class="category-meta">æˆ˜æœ¯åšå¼ˆ Â· å¸ƒå±€å–èƒœ</div>
          </div>
          <div class="category-chip" data-category="indie">
            <div class="category-name">ç‹¬ç«‹ / Indie</div>
            <div class="category-meta">å°ä½“é‡ Â· å¤§åˆ›æ„</div>
          </div>
          <div class="category-chip" data-category="multiplayer">
            <div class="category-name">å¤šäººè”æœº</div>
            <div class="category-meta">å’Œæœ‹å‹ä¸€èµ·å¿«ä¹å¼€é»‘</div>
          </div>
          <div class="category-chip" data-category="casual">
            <div class="category-name">ä¼‘é—² / è½»åº¦</div>
            <div class="category-meta">ä¸‹ç­åæ”¾æ¾ä¸€ä¸‹</div>
          </div>
          <div class="category-chip" data-category="free">
            <div class="category-name">å…è´¹ / F2P</div>
            <div class="category-meta">0 å…ƒå…¥å‘ Â· æ°ªä¸æ°ªçœ‹ä½ </div>
          </div>
        </div>
      </article>
    </section>

    <!-- å³ä¾§ä¾§æ  -->
    <aside>
      <div class="sidebar-card">
        <div class="sidebar-title">å¹³å°çƒ­åº¦ï¼ˆç¤ºä¾‹ï¼‰</div>
        <div class="sidebar-item">
          <span class="label">Steam</span><span class="value">ğŸ”¥ 87</span>
        </div>
        <div class="sidebar-item">
          <span class="label">PlayStation</span><span class="value">78</span>
        </div>
        <div class="sidebar-item">
          <span class="label">Switch</span><span class="value">74</span>
        </div>
        <div class="sidebar-item">
          <span class="label">æ‰‹æœºæ¸¸æˆ</span><span class="value">81</span>
        </div>
      </div>

      <div class="sidebar-card">
        <div class="sidebar-title">æ­£åœ¨æ‰“æŠ˜ï¼ˆç¤ºä¾‹ï¼‰</div>
        <div class="sidebar-item">
          <span class="label">èµ›åšæœ‹å…‹ 2077</span><span class="value">-50%</span>
        </div>
        <div class="sidebar-item">
          <span class="label">è‰¾å°”ç™»æ³•ç¯</span><span class="value">-30%</span>
        </div>
        <div class="sidebar-item">
          <span class="label">ç©ºæ´éª‘å£«</span><span class="value">-60%</span>
        </div>
      </div>
    </aside>
  </main>
</div>

<script src="common.js"></script>
<script>
  // åˆå§‹åŒ–é€šç”¨é€»è¾‘ï¼ˆå¯¼èˆªé«˜äº®ç­‰ï¼‰
  initCommon();

  const rankingListEl = document.getElementById("rankingList");
  const rankingTabsEl = document.getElementById("rankingTabs");
  const rankingLoadedEl = document.getElementById("rankingLoaded");
  const rankingTotalEl = document.getElementById("rankingTotal");

  const PAGE_SIZE = 5;

  let rankingData = { hot: [], score: [], new: [], discount: [] };
  const loadedCount = { hot: 0, score: 0, new: 0, discount: 0 };
  let currentType = "hot";

  function updateCounter() {
    const total = (rankingData[currentType] || []).length;
    const loaded = loadedCount[currentType] || 0;
    rankingLoadedEl.textContent = loaded;
    rankingTotalEl.textContent = total;
  }

  function appendItems(type) {
    const data = rankingData[type] || [];
    const start = loadedCount[type] || 0;
    if (start >= data.length) return;

    const end = Math.min(start + PAGE_SIZE, data.length);

    for (let i = start; i < end; i++) {
      const item = data[i];
      const score = Number(item.score) || 0;

      const li = document.createElement("li");
      li.className = "ranking-item";
      li.innerHTML = `
        <div class="ranking-pos ${i === 0 ? "ranking-pos--top1" : ""}">${i + 1}</div>
        <div class="ranking-game">
          <div class="ranking-cover">
            <img src="${item.cover}" alt="${item.name} å°é¢" />
          </div>
          <div class="ranking-info">
            <div class="ranking-name">${item.name}</div>
            <div class="ranking-meta">${item.platform || ""}</div>
          </div>
        </div>
        <div class="ranking-score">
          <span class="value">${score.toFixed(1)}</span>
          <div><span class="tag">${item.tag || ""}</span></div>
        </div>
      `;

      // ç‚¹å‡»æ•´è¡Œï¼Œè·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œæºå¸¦ name å‚æ•°
      li.addEventListener("click", () => {
        const url = new URL("game-detail.html", window.location.href);

  // ä¼˜å…ˆç”¨çœŸå® id ç²¾ç¡®å®šä½ï¼Œé˜²æ­¢åå­—æœ‰ç©ºæ ¼/å¤§å°å†™å·®å¼‚
        if (item.id != null) {
          url.searchParams.set("id", item.id);
        }
        url.searchParams.set("name", item.name);
        
        window.location.href = url.toString();
      });


      rankingListEl.appendChild(li);
    }

    loadedCount[type] = end;
    updateCounter();
  }

  function resetAndRender(type) {
    currentType = type;
    rankingListEl.innerHTML = "";
    loadedCount[type] = 0;
    appendItems(type);
  }

  // æ»šåŠ¨åˆ°åº•å†åŠ è½½
  rankingListEl.addEventListener("scroll", () => {
    const el = rankingListEl;
    if (el.scrollTop + el.clientHeight >= el.scrollHeight - 4) {
      appendItems(currentType);
    }
  });

  // Tab åˆ‡æ¢
  rankingTabsEl.addEventListener("click", (e) => {
    const btn = e.target.closest(".ranking-tab");
    if (!btn) return;
    rankingTabsEl
      .querySelectorAll(".ranking-tab")
      .forEach((b) => b.classList.remove("is-active"));
    btn.classList.add("is-active");
    const type = btn.dataset.type;
    resetAndRender(type);
  });

  // ä» ranking.json åŠ è½½æ•°æ®ï¼ˆGitHub Actions ä¼šå®šæ—¶æ›´æ–°è¿™ä¸ªæ–‡ä»¶ï¼‰
  function loadRankingFromJson() {
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    rankingListEl.innerHTML = '<li style="text-align: center; color: var(--text-muted); padding: 20px;">ğŸ® æ­£åœ¨åŠ è½½æ’è¡Œæ¦œæ•°æ®...</li>';
    
    fetch("ranking.json")
      .then((res) => {
        if (!res.ok) throw new Error("HTTP çŠ¶æ€ç  " + res.status);
        return res.json();
      })
      .then((data) => {
        rankingData.hot = data.hot || [];
        rankingData.score = data.score || [];
        rankingData.new = data.new || [];
        rankingData.discount = data.discount || [];
        
        // æ£€æŸ¥æ˜¯å¦æœ‰æ•°æ®
        const hasData = rankingData.hot.length > 0 || 
                       rankingData.score.length > 0 || 
                       rankingData.new.length > 0 || 
                       rankingData.discount.length > 0;
        
        if (!hasData) {
          rankingListEl.innerHTML = '<li style="text-align: center; color: var(--text-muted); padding: 20px;">æš‚æ— æ’è¡Œæ¦œæ•°æ®</li>';
          return;
        }
        
        resetAndRender("hot");
      })
      .catch((err) => {
        console.error("åŠ è½½ ranking.json å¤±è´¥:", err);
        rankingListEl.innerHTML = `
          <li style="text-align: center; color: var(--danger); padding: 20px;">
            âŒ æ’è¡Œæ¦œæ•°æ®åŠ è½½å¤±è´¥<br>
            <span style="font-size: 11px; opacity: 0.8;">é”™è¯¯: ${err.message}</span><br>
            <button onclick="loadRankingFromJson()" style="margin-top: 10px;" class="btn btn-inline">é‡è¯•</button>
          </li>
        `;
      });
  }

  loadRankingFromJson();

  // ç±»å‹ç‚¹å‡»ï¼šå¸¦å‚æ•°è·³è½¬åˆ°æ¸¸æˆåº“ï¼ˆä½ å¯ä»¥ä»¥ååœ¨ game-library.html é‡Œè¯» URL å‚æ•°ï¼‰
  document.getElementById("categoryGrid").addEventListener("click", (e) => {
    const chip = e.target.closest(".category-chip");
    if (!chip) return;
    document
      .querySelectorAll(".category-chip")
      .forEach((c) => c.classList.remove("is-active"));
    chip.classList.add("is-active");
    const cat = chip.dataset.category;
    if (cat !== "all") {
      window.location.href = "game-library.html?cat=" + encodeURIComponent(cat);
    }
  });
</script>
</body>
</html>
