<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GameBox 游盒 - 首页</title>
  <link rel="stylesheet" href="index.css" />
</head>
<body data-current-page="home">
<div class="page">
  <!-- 顶部导航 -->
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox 游盒</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">首页</a>
        <a href="news-list.html" data-page="news" class="nav-link">资讯</a>
        <a href="game-library.html" data-page="library" class="nav-link">游戏库</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          排行榜 <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">折扣 / 史低</a>
        <a href="community.html" data-page="community" class="nav-link">社区</a>
        <a href="my-library.html" data-page="my" class="nav-link">我的游戏</a>
        <a href="tools.html" data-page="tools" class="nav-link">工具中心</a>
        <a href="profile.html" data-page="profile" class="nav-link">用户中心</a>
      </nav>

      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="搜索游戏 / 资讯 / 帖子" />
          <span class="header-search-icon">🔍</span>
        </div>
        <button class="header-user">未登录 · 游客</button>
      </div>
    </div>
  </header>

  <!-- 主体 -->
  <main class="main">
    <section>
      <!-- 顶部介绍 -->
      <div class="card">
        <div class="page-title">发现好游戏</div>
        <div class="page-intro">
          从热门榜、评分榜和类型开始逛逛，看看最近大家都在玩什么。
        </div>
      </div>

      <!-- 首页热门排行榜卡片 -->
      <article class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>热门游戏排行榜</span>
          </div>
          <div class="ranking-tabs" id="rankingTabs">
            <button class="ranking-tab is-active" data-type="hot">热度</button>
            <button class="ranking-tab" data-type="score">评分</button>
            <button class="ranking-tab" data-type="new">新品</button>
            <button class="ranking-tab" data-type="discount">折扣</button>
          </div>
        </header>
        <div class="card-subtitle">
          列表支持滚动，当滚动到底部会持续加载更多（数据来自 <code>ranking.json</code>）。
        </div>
        <ol class="ranking-list ranking-list--scroll" id="rankingList"></ol>
        <div id="rankingHint" style="font-size:11px;color:var(--text-soft);margin-top:4px;">
          已加载 <span id="rankingLoaded">0</span> / <span id="rankingTotal">0</span> 款
        </div>
      </article>

      <!-- 按类型浏览 -->
      <article class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>按类型快速找游戏</span>
          </div>
        </header>
        <div class="card-subtitle">
          常见类型 / 标签一键跳转到游戏库页面（带类型参数）。
        </div>
        <div class="category-grid" id="categoryGrid">
          <div class="category-chip is-active" data-category="all">
            <div class="category-name">全部</div>
            <div class="category-meta">共 999+ 款 · 不做选择困难症</div>
          </div>
          <div class="category-chip" data-category="action">
            <div class="category-name">动作 / ACT</div>
            <div class="category-meta">爽快打击 · 即时操作</div>
          </div>
          <div class="category-chip" data-category="rpg">
            <div class="category-name">角色扮演 / RPG</div>
            <div class="category-meta">剧情驱动 · 养成成长</div>
          </div>
          <div class="category-chip" data-category="strategy">
            <div class="category-name">策略 / SLG</div>
            <div class="category-meta">战术博弈 · 布局取胜</div>
          </div>
          <div class="category-chip" data-category="indie">
            <div class="category-name">独立 / Indie</div>
            <div class="category-meta">小体量 · 大创意</div>
          </div>
          <div class="category-chip" data-category="multiplayer">
            <div class="category-name">多人联机</div>
            <div class="category-meta">和朋友一起快乐开黑</div>
          </div>
          <div class="category-chip" data-category="casual">
            <div class="category-name">休闲 / 轻度</div>
            <div class="category-meta">下班后放松一下</div>
          </div>
          <div class="category-chip" data-category="free">
            <div class="category-name">免费 / F2P</div>
            <div class="category-meta">0 元入坑 · 氪不氪看你</div>
          </div>
        </div>
      </article>
    </section>

    <!-- 右侧侧栏 -->
    <aside>
      <div class="sidebar-card">
        <div class="sidebar-title">平台热度（示例）</div>
        <div class="sidebar-item">
          <span class="label">Steam</span><span class="value">🔥 87</span>
        </div>
        <div class="sidebar-item">
          <span class="label">PlayStation</span><span class="value">78</span>
        </div>
        <div class="sidebar-item">
          <span class="label">Switch</span><span class="value">74</span>
        </div>
        <div class="sidebar-item">
          <span class="label">手机游戏</span><span class="value">81</span>
        </div>
      </div>

      <div class="sidebar-card">
        <div class="sidebar-title">正在打折（示例）</div>
        <div class="sidebar-item">
          <span class="label">赛博朋克 2077</span><span class="value">-50%</span>
        </div>
        <div class="sidebar-item">
          <span class="label">艾尔登法环</span><span class="value">-30%</span>
        </div>
        <div class="sidebar-item">
          <span class="label">空洞骑士</span><span class="value">-60%</span>
        </div>
      </div>
    </aside>
  </main>
</div>

<!-- 通用脚本 -->
<script src="common.js"></script>
<script>
  // 初始化导航高亮 / 登录状态等
  initCommon();

  // ====== DOM 元素 ======
  const rankingListEl = document.getElementById("rankingList");
  const rankingTabsEl = document.getElementById("rankingTabs");
  const rankingLoadedEl = document.getElementById("rankingLoaded");
  const rankingTotalEl = document.getElementById("rankingTotal");

  const PAGE_SIZE = 5;

  // 会从 ranking.json 填充
  let rankingData = { hot: [], score: [], new: [], discount: [] };
  const loadedCount = { hot: 0, score: 0, new: 0, discount: 0 };
  let currentType = "hot";

  // 更新右下角计数
  function updateCounter() {
    const total = (rankingData[currentType] || []).length;
    const loaded = loadedCount[currentType] || 0;
    rankingLoadedEl.textContent = loaded;
    rankingTotalEl.textContent = total;
  }

  // 追加一批游戏项
  function appendItems(type) {
    const data = rankingData[type] || [];
    const start = loadedCount[type] || 0;
    if (start >= data.length) return;

    const end = Math.min(start + PAGE_SIZE, data.length);

    for (let i = start; i < end; i++) {
      const item = data[i];
      const score = Number(item.score) || 0;

      const li = document.createElement("li");
      li.className = "ranking-item";
      li.innerHTML = `
        <div class="ranking-pos ${i === 0 ? "ranking-pos--top1" : ""}">${i + 1}</div>
        <div class="ranking-game">
          <div class="ranking-cover">
            <img src="${item.cover}" alt="${item.name} 封面" />
          </div>
          <div class="ranking-info">
            <div class="ranking-name">${item.name}</div>
            <div class="ranking-meta">${item.platform || ""}</div>
          </div>
        </div>
        <div class="ranking-score">
          <span class="value">${score.toFixed(1)}</span>
          <div><span class="tag">${item.tag || ""}</span></div>
        </div>
      `;
      // 示例点击跳转：如果是艾尔登法环就去详情页
      li.addEventListener("click", () => {
        if (item.name && item.name.indexOf("艾尔登") !== -1) {
          window.location.href = "game-detail.html";
        }
      });
      rankingListEl.appendChild(li);
    }

    loadedCount[type] = end;
    updateCounter();
  }

  // 切换榜单类型
  function resetAndRender(type) {
    currentType = type;
    rankingListEl.innerHTML = "";
    loadedCount[type] = 0;
    appendItems(type);
  }

  // 滚动到底再加载
  rankingListEl.addEventListener("scroll", () => {
    const el = rankingListEl;
    if (el.scrollTop + el.clientHeight >= el.scrollHeight - 4) {
      appendItems(currentType);
    }
  });

  // Tab 切换
  rankingTabsEl.addEventListener("click", (e) => {
    const btn = e.target.closest(".ranking-tab");
    if (!btn) return;
    rankingTabsEl
      .querySelectorAll(".ranking-tab")
      .forEach((b) => b.classList.remove("is-active"));
    btn.classList.add("is-active");
    const type = btn.dataset.type;
    resetAndRender(type);
  });

  // 从当前仓库根目录的 ranking.json 加载数据
  function loadRankingFromJson() {
    fetch("ranking.json")
      .then((res) => res.json())
      .then((data) => {
        // 兼容：如果某些字段没写也不会报错
        rankingData.hot = data.hot || [];
        rankingData.score = data.score || [];
        rankingData.new = data.new || [];
        rankingData.discount = data.discount || [];
        resetAndRender("hot");
      })
      .catch((err) => {
        console.error("加载 ranking.json 失败:", err);
        rankingListEl.innerHTML =
          '<li style="font-size:12px;color:var(--text-muted);padding:4px 0;">排行榜数据加载失败，请检查 ranking.json 是否存在且格式正确。</li>';
      });
  }

  loadRankingFromJson();

  // 类型点击：带参数跳转到游戏库
  document.getElementById("categoryGrid").addEventListener("click", (e) => {
    const chip = e.target.closest(".category-chip");
    if (!chip) return;
    document
      .querySelectorAll(".category-chip")
      .forEach((c) => c.classList.remove("is-active"));
    chip.classList.add("is-active");
    const cat = chip.dataset.category;
    if (cat !== "all") {
      window.location.href = "game-library.html?cat=" + encodeURIComponent(cat);
    }
  });
</script>
</body>
</html>
