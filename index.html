<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox æ¸¸ç›’ - é¦–é¡µ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="index.css" />
</head>
<body data-current-page="home">
<div class="page">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="news-list.html" data-page="news" class="nav-link">èµ„è®¯</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          æ’è¡Œæ¦œ <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">æŠ˜æ‰£ / å²ä½</a>
        <a href="community.html" data-page="community" class="nav-link">ç¤¾åŒº</a>
        <a href="my-library.html" data-page="my" class="nav-link">æˆ‘çš„æ¸¸æˆ</a>
        <a href="tools.html" data-page="tools" class="nav-link">å·¥å…·ä¸­å¿ƒ</a>
        <a href="profile.html" data-page="profile" class="nav-link">ç”¨æˆ·ä¸­å¿ƒ</a>
      </nav>

      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="æœç´¢æ¸¸æˆ / èµ„è®¯ / å¸–å­" />
          <span class="header-search-icon">ğŸ”</span>
        </div>
        <button class="header-user">æœªç™»å½• Â· æ¸¸å®¢</button>
      </div>
    </div>
  </header>

  <main class="main">
    <section>
      <!-- é¡¶éƒ¨ç®€ä»‹ -->
      <div class="card">
        <div class="page-title">å‘ç°å¥½æ¸¸æˆ</div>
        <div class="page-intro">ä»æ’è¡Œæ¦œå’Œç±»å‹å¼€å§‹é€›é€›ï¼Œçœ‹çœ‹æœ€è¿‘å¤§å®¶éƒ½åœ¨ç©ä»€ä¹ˆã€‚</div>
      </div>

      <!-- çƒ­é—¨æ¸¸æˆæ’è¡Œæ¦œï¼ˆå¯æ»šåŠ¨ + æŒç»­åŠ è½½ + å°é¢å›¾ï¼‰ -->
      <article class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>çƒ­é—¨æ¸¸æˆæ’è¡Œæ¦œ</span>
          </div>
          <div class="ranking-tabs" id="rankingTabs">
            <button class="ranking-tab is-active" data-type="hot">çƒ­åº¦</button>
            <button class="ranking-tab" data-type="score">è¯„åˆ†</button>
            <button class="ranking-tab" data-type="new">æ–°å“</button>
            <button class="ranking-tab" data-type="discount">æŠ˜æ‰£</button>
          </div>
        </header>
        <div class="card-subtitle">
            
        </div>
        <ol class="ranking-list ranking-list--scroll" id="rankingList"></ol>
        <div id="rankingHint" style="font-size:11px;color:var(--text-soft);margin-top:4px;">
          å·²åŠ è½½ <span id="rankingLoaded">0</span> / <span id="rankingTotal">0</span> æ¬¾
        </div>
      </article>

      <!-- æŒ‰ç±»å‹æµè§ˆ -->
      <article class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span>
            <span>æŒ‰ç±»å‹æµè§ˆæ¸¸æˆ</span>
          </div>
        </header>
        <div class="card-subtitle">
          å¸¸è§ç±»å‹ / æ ‡ç­¾ä¸€é”®è¿›å…¥å¯¹åº”åˆ—è¡¨é¡µ
        </div>
        <div class="category-grid" id="categoryGrid">
          <div class="category-chip is-active" data-category="all">
            <div class="category-name">å…¨éƒ¨</div>
            <div class="category-meta">å…± 999+ æ¬¾ Â· ä¸åšé€‰æ‹©å›°éš¾ç—‡</div>
          </div>
          <div class="category-chip" data-category="action">
            <div class="category-name">åŠ¨ä½œ / ACT</div>
            <div class="category-meta">çˆ½å¿«æ‰“å‡» Â· å³æ—¶æ“ä½œ</div>
          </div>
          <div class="category-chip" data-category="rpg">
            <div class="category-name">è§’è‰²æ‰®æ¼” / RPG</div>
            <div class="category-meta">å‰§æƒ…é©±åŠ¨ Â· å…»æˆæˆé•¿</div>
          </div>
          <div class="category-chip" data-category="strategy">
            <div class="category-name">ç­–ç•¥ / SLG</div>
            <div class="category-meta">æˆ˜æœ¯åšå¼ˆ Â· å¸ƒå±€å–èƒœ</div>
          </div>
          <div class="category-chip" data-category="indie">
            <div class="category-name">ç‹¬ç«‹ / Indie</div>
            <div class="category-meta">å°ä½“é‡ Â· å¤§åˆ›æ„</div>
          </div>
          <div class="category-chip" data-category="multiplayer">
            <div class="category-name">å¤šäººè”æœº</div>
            <div class="category-meta">å’Œæœ‹å‹ä¸€èµ·å¿«ä¹å¼€é»‘</div>
          </div>
          <div class="category-chip" data-category="casual">
            <div class="category-name">ä¼‘é—² / è½»åº¦</div>
            <div class="category-meta">ä¸‹ç­åæ”¾æ¾ä¸€ä¸‹</div>
          </div>
          <div class="category-chip" data-category="free">
            <div class="category-name">å…è´¹ / F2P</div>
            <div class="category-meta">0 å…ƒå…¥å‘ Â· æ°ªä¸æ°ªçœ‹ä½ </div>
          </div>
        </div>
      </article>
    </section>

    <aside>
      <div class="sidebar-card">
        <div class="sidebar-title">å½“å‰å¹³å°çƒ­åº¦</div>
        <div class="sidebar-item">
          <span class="label">Steam</span><span class="value">ğŸ”¥ 87</span>
        </div>
        <div class="sidebar-item">
          <span class="label">PlayStation</span><span class="value">78</span>
        </div>
        <div class="sidebar-item">
          <span class="label">Switch</span><span class="value">74</span>
        </div>
        <div class="sidebar-item">
          <span class="label">æ‰‹æœºæ¸¸æˆ</span><span class="value">81</span>
        </div>
      </div>

      <div class="sidebar-card">
        <div class="sidebar-title">æ­£åœ¨æ‰“æŠ˜</div>
        <div class="sidebar-item">
          <span class="label">èµ›åšæœ‹å…‹ 2077</span><span class="value">-50%</span>
        </div>
        <div class="sidebar-item">
          <span class="label">è‰¾å°”ç™»æ³•ç¯</span><span class="value">-30%</span>
        </div>
        <div class="sidebar-item">
          <span class="label">ç©ºæ´éª‘å£«</span><span class="value">-60%</span>
        </div>
      </div>
    </aside>
  </main>
</div>

<script src="common.js"></script>
<script>
  // é€šç”¨åˆå§‹åŒ–
  initCommon();

  // DOM å¼•ç”¨
  const rankingListEl = document.getElementById("rankingList");
  const rankingTabsEl = document.getElementById("rankingTabs");
  const rankingLoadedEl = document.getElementById("rankingLoaded");
  const rankingTotalEl = document.getElementById("rankingTotal");

  const PAGE_SIZE = 5;

  // ä» JSON é‡Œè¯»è¿›æ¥çš„æ•°æ®æ”¾è¿™é‡Œ
  let rankingData = { hot: [], score: [], new: [], discount: [] };
  const loadedCount = { hot: 0, score: 0, new: 0, discount: 0 };
  let currentType = "hot";

  function updateCounter() {
    const total = (rankingData[currentType] || []).length;
    const loaded = loadedCount[currentType] || 0;
    rankingLoadedEl.textContent = loaded;
    rankingTotalEl.textContent = total;
  }

  function appendItems(type) {
    const data = rankingData[type] || [];
    const start = loadedCount[type] || 0;
    if (start >= data.length) return;

    const end = Math.min(start + PAGE_SIZE, data.length);

    for (let i = start; i < end; i++) {
      const item = data[i];
      const li = document.createElement("li");
      li.className = "ranking-item";
      li.innerHTML = `
        <div class="ranking-pos ${i === 0 ? "ranking-pos--top1" : ""}">${i + 1}</div>
        <div class="ranking-game">
          <div class="ranking-cover">
            <img src="${item.cover}" alt="${item.name} å°é¢" />
          </div>
          <div class="ranking-info">
            <div class="ranking-name">${item.name}</div>
            <div class="ranking-meta">${item.platform}</div>
          </div>
        </div>
        <div class="ranking-score">
          <span class="value">${item.score.toFixed(1)}</span>
          <div><span class="tag">${item.tag}</span></div>
        </div>
      `;
      rankingListEl.appendChild(li);
    }

    loadedCount[type] = end;
    updateCounter();
  }

  function resetAndRender(type) {
    currentType = type;
    rankingListEl.innerHTML = "";
    loadedCount[type] = 0;
    appendItems(type);
  }

  // æ»šåŠ¨åˆ°åº•éƒ¨ç»§ç»­åŠ è½½
  rankingListEl.addEventListener("scroll", () => {
    const el = rankingListEl;
    if (el.scrollTop + el.clientHeight >= el.scrollHeight - 4) {
      appendItems(currentType);
    }
  });

  // Tab åˆ‡æ¢
  rankingTabsEl.addEventListener("click", (e) => {
    const btn = e.target.closest(".ranking-tab");
    if (!btn) return;
    rankingTabsEl
      .querySelectorAll(".ranking-tab")
      .forEach((b) => b.classList.remove("is-active"));
    btn.classList.add("is-active");
    const type = btn.dataset.type;
    resetAndRender(type);
  });

  // ğŸ”‘ å…³é”®ï¼šä»æœ¬ä»“åº“çš„ data/ranking.json åŠ è½½æ•°æ®ï¼ˆGitHub Pages ä¹Ÿæ”¯æŒï¼‰
  function loadRankingFromJson() {
    fetch("data/ranking.json")
      .then((res) => res.json())
      .then((data) => {
        rankingData = data || rankingData;
        resetAndRender("hot");
      })
      .catch((err) => {
        console.error("åŠ è½½ ranking.json å¤±è´¥ï¼š", err);
        rankingListEl.innerHTML =
          '<li style="font-size:12px;color:var(--text-muted);padding:4px 0;">æ’è¡Œæ¦œæ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ data/ranking.json æ˜¯å¦å­˜åœ¨ã€‚</li>';
      });
  }

  loadRankingFromJson();

  // åˆ†ç±»ç‚¹å‡»è·³è½¬ï¼ˆä¿æŒåŸæ¥çš„é€»è¾‘ï¼‰
  document.getElementById("categoryGrid").addEventListener("click", (e) => {
    const chip = e.target.closest(".category-chip");
    if (!chip) return;
    document
      .querySelectorAll(".category-chip")
      .forEach((c) => c.classList.remove("is-active"));
    chip.classList.add("is-active");
    const cat = chip.dataset.category;
    if (cat !== "all") {
      window.location.href = "game-library.html?cat=" + encodeURIComponent(cat);
    }
  });
</script>

</body>
</html>
