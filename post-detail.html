<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>GameBox æ¸¸ç›’ - å¸–å­è¯¦æƒ…</title>
  <!-- Cyberpunk Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="index.css" />
  <style>
    /* å¸–å­è¯¦æƒ…é¡µä¸“å±æ ·å¼ */
    .post-header-info {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 16px;
      padding-bottom: 16px;
      border-bottom: 2px solid rgba(255, 211, 0, 0.2);
    }
    
    .post-author-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--cyber-yellow), var(--cyber-pink));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      flex-shrink: 0;
      box-shadow: 0 0 20px rgba(255, 211, 0, 0.4);
    }
    
    .post-author-info {
      flex: 1;
    }
    
    .post-author-name {
      font-family: 'Orbitron', sans-serif;
      font-size: 16px;
      font-weight: 700;
      color: var(--cyber-yellow);
      margin-bottom: 4px;
    }
    
    .post-stats-bar {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .post-stat-item {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .post-content-full {
      font-size: 14px;
      color: var(--text-soft);
      line-height: 1.8;
      margin: 20px 0;
    }
    
    .post-content-full p {
      margin-bottom: 12px;
    }
    
    .post-actions {
      display: flex;
      gap: 12px;
      margin: 20px 0;
      padding: 16px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
    }
    
    .action-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      background: rgba(255, 211, 0, 0.1);
      border: 1px solid rgba(255, 211, 0, 0.3);
      border-radius: 4px;
      color: var(--text-main);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .action-btn:hover {
      background: rgba(255, 211, 0, 0.2);
      border-color: var(--cyber-yellow);
      box-shadow: 0 0 15px rgba(255, 211, 0, 0.3);
    }
    
    .action-btn.active {
      background: linear-gradient(135deg, rgba(255, 211, 0, 0.3), rgba(255, 61, 148, 0.2));
      border-color: var(--cyber-yellow);
      color: var(--cyber-yellow);
    }
    
    .comment-item {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(85, 234, 212, 0.2);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.3s ease;
    }
    
    .comment-item:hover {
      border-color: rgba(85, 234, 212, 0.4);
      transform: translateX(3px);
    }
    
    .comment-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .comment-author {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .comment-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--cyber-cyan), var(--cyber-pink));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .comment-author-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--cyber-cyan);
    }
    
    .comment-meta {
      font-size: 11px;
      color: var(--text-muted);
    }
    
    .comment-content {
      font-size: 13px;
      color: var(--text-soft);
      line-height: 1.6;
      margin-bottom: 8px;
    }
    
    .comment-actions {
      display: flex;
      gap: 16px;
      font-size: 12px;
    }
    
    .comment-action {
      color: var(--text-muted);
      cursor: pointer;
      transition: color 0.3s ease;
    }
    
    .comment-action:hover {
      color: var(--cyber-cyan);
    }
    
    .reply-form {
      margin-top: 8px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 4px;
      display: none;
    }
    
    .reply-form.show {
      display: block;
    }
    
    .reply-input {
      width: 100%;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(85, 234, 212, 0.3);
      border-radius: 4px;
      color: var(--text-main);
      font-size: 12px;
      margin-bottom: 8px;
    }
    
    .reply-btn {
      padding: 6px 16px;
      background: linear-gradient(135deg, rgba(85, 234, 212, 0.2), rgba(0, 255, 159, 0.1));
      border: 1px solid var(--cyber-cyan);
      border-radius: 4px;
      color: var(--cyber-cyan);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .reply-btn:hover {
      background: linear-gradient(135deg, rgba(85, 234, 212, 0.3), rgba(0, 255, 159, 0.2));
      box-shadow: 0 0 15px rgba(85, 234, 212, 0.3);
    }
  </style>
</head>
<body data-current-page="community" class="cyberpunk-theme">
<div class="page">
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>
      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          æ’è¡Œæ¦œ <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">æŠ˜æ‰£ / å²ä½</a>
        <a href="community.html" data-page="community" class="nav-link">ç¤¾åŒº</a>
        <a href="news-list.html" data-page="news" class="nav-link">èµ„è®¯</a>
        <a href="tools.html" data-page="tools" class="nav-link">å·¥å…·</a>
        <a href="my-library.html" data-page="my" class="nav-link">æˆ‘çš„æ¸¸æˆ</a>
        <a href="profile.html" data-page="profile" class="nav-link">ç”¨æˆ·ä¸­å¿ƒ</a>
      </nav>
      <div class="header-right">
        <div class="header-search">
          <input type="text" placeholder="æœç´¢æ¸¸æˆ / èµ„è®¯ / å¸–å­" />
          <span class="header-search-icon">ğŸ”</span>
        </div>
        <button class="header-user">æœªç™»å½• Â· æ¸¸å®¢</button>
      </div>
    </div>
  </header>
  
  <!-- Cyberpunk Effects -->
  <canvas id="matrix-canvas" class="matrix-bg"></canvas>
  <div id="particles-container" class="particles-container"></div>
  <div id="scroll-progress" class="scroll-progress"></div>
  <div id="loading-overlay" class="loading-overlay">
    <div class="cyberpunk-loader">
      <div class="loader-hexagon"></div>
      <div class="loader-text">LOADING...</div>
    </div>
  </div>

  <main class="main">
    <section>
      <article class="card">
        <div class="page-title" id="postTitle">åŠ è½½ä¸­...</div>
        
        <div class="post-header-info" id="postHeaderInfo">
          <div class="post-author-avatar" id="authorAvatar">âš”ï¸</div>
          <div class="post-author-info">
            <div class="post-author-name" id="authorName">åŠ è½½ä¸­...</div>
            <div class="post-stats-bar">
              <span class="post-stat-item">ğŸ“… <span id="postTime">--</span></span>
              <span class="post-stat-item">ğŸ‘ï¸ <span id="postViews">--</span> æµè§ˆ</span>
              <span class="post-stat-item">ğŸ’¬ <span id="postReplies">--</span> å›å¤</span>
              <span class="post-stat-item">ğŸ® <span id="postGame">--</span></span>
            </div>
          </div>
        </div>
        
        <div class="post-content-full" id="postContent">
          <p>æ­£åœ¨åŠ è½½å¸–å­å†…å®¹...</p>
        </div>
        
        <div class="post-actions">
          <button class="action-btn" id="btnLike">
            <span>ğŸ‘</span>
            <span id="likeText">ç‚¹èµ (<span id="likeCount">0</span>)</span>
          </button>
          <button class="action-btn" id="btnFavorite">
            <span>â­</span>
            <span>æ”¶è—</span>
          </button>
          <button class="action-btn" id="btnShare">
            <span>ğŸ”—</span>
            <span>åˆ†äº«</span>
          </button>
        </div>
      </article>

      <article class="card">
        <header class="card-header">
          <div class="card-title">
            <span class="dot"></span><span>è¯„è®ºåŒº (<span id="commentCount">0</span>)</span>
          </div>
        </header>
        
        <div class="comment-list" id="commentList"></div>
        
        <div class="form" style="margin-top:20px;">
          <div class="form-row">
            <label for="newComment">å‘è¡¨ä½ çš„çœ‹æ³•</label>
            <textarea id="newComment" placeholder="è¯´ç‚¹ä»€ä¹ˆå§â€¦â€¦" rows="4"></textarea>
          </div>
          <button class="btn btn-primary btn-inline" id="btnComment">ğŸ’¬ å‘è¡¨è¯„è®º</button>
          <div id="commentMsg" style="font-size:11px;color:var(--text-soft);margin-top:8px;">
            æç¤ºï¼šå½“å‰ä¸ºæ¼”ç¤ºç‰ˆæœ¬ï¼Œè¯„è®ºæ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­
          </div>
        </div>
      </article>
    </section>

    <aside>
      <div class="sidebar-card">
        <div class="sidebar-title">ğŸ”™ è¿”å›</div>
        <div class="sidebar-item">
          <span class="label">ç¤¾åŒº</span><span class="value"><a href="community.html">è¿”å›ç¤¾åŒºåˆ—è¡¨</a></span>
        </div>
      </div>
      
      <div class="sidebar-card" style="margin-top: 16px;">
        <div class="sidebar-title">ğŸ“Š å¸–å­ç»Ÿè®¡</div>
        <div class="sidebar-item">
          <span class="label">å‘å¸ƒæ—¶é—´</span><span class="value" id="sidebarTime">--</span>
        </div>
        <div class="sidebar-item">
          <span class="label">æµè§ˆæ¬¡æ•°</span><span class="value" id="sidebarViews">--</span>
        </div>
        <div class="sidebar-item">
          <span class="label">å›å¤æ•°é‡</span><span class="value" id="sidebarReplies">--</span>
        </div>
        <div class="sidebar-item">
          <span class="label">ç‚¹èµæ•°é‡</span><span class="value" id="sidebarLikes">--</span>
        </div>
      </div>
    </aside>
  </main>
</div>

<!-- Supabase SDK (çœŸå®æ•°æ®åº“æ”¯æŒ) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="supabase-config.js"></script>

<script src="common.js"></script>
<script src="cyber-effects.js"></script>
<script src="community-data-service.js"></script>
<script>
  initCommon();

  // ç¤ºä¾‹å¸–å­æ•°æ®ï¼ˆå…œåº•æ•°æ®ï¼‰
  const postDatabase = {
    "pinned-1": {
      id: "pinned-1",
      title: "ã€å…¬å‘Šã€‘ç¤¾åŒºä½¿ç”¨æŒ‡å— - æ–°äººå¿…è¯»",
      content: `
        <h3>æ¬¢è¿æ¥åˆ° GameBox ç¤¾åŒºï¼</h3>
        <p>æœ¬å¸–åŒ…å«ç¤¾åŒºè§„åˆ™ã€å‘å¸–æŒ‡å—ã€å¸¸è§é—®é¢˜è§£ç­”ç­‰å†…å®¹ï¼Œå»ºè®®æ–°ç©å®¶ä»”ç»†é˜…è¯»ã€‚</p>
        
        <h4>1. ç¤¾åŒºè§„åˆ™</h4>
        <ul>
          <li>å‹å–„äº¤æµï¼Œå°Šé‡ä»–äººæ„è§</li>
          <li>ç¦æ­¢å‘å¸ƒå¹¿å‘Šã€åƒåœ¾ä¿¡æ¯</li>
          <li>å‰§é€å†…å®¹è¯·æ ‡æ³¨æ˜ç¡®è­¦å‘Š</li>
          <li>éµå®ˆæ¸¸æˆå¼€å‘å•†çš„æœåŠ¡æ¡æ¬¾</li>
        </ul>
        
        <h4>2. å‘å¸–æŒ‡å—</h4>
        <ul>
          <li>é€‰æ‹©åˆé€‚çš„æ¿å—å‘å¸ƒå†…å®¹</li>
          <li>æ ‡é¢˜ç®€æ´æ˜äº†ï¼Œå‡†ç¡®æè¿°å†…å®¹</li>
          <li>å–„ç”¨æ ‡ç­¾åˆ†ç±»æ‚¨çš„å¸–å­</li>
          <li>æ’ç‰ˆæ¸…æ™°ï¼Œæ–¹ä¾¿ä»–äººé˜…è¯»</li>
        </ul>
        
        <h4>3. å¸¸è§é—®é¢˜</h4>
        <p><strong>Q: å¦‚ä½•è·å¾—æ›´å¤šæƒé™ï¼Ÿ</strong><br>
        A: ä¿æŒæ´»è·ƒå‘å¸–å’Œè¯„è®ºï¼Œè·å–ç»éªŒå€¼æå‡ç­‰çº§å³å¯è§£é”æ›´å¤šåŠŸèƒ½ã€‚</p>
        
        <p><strong>Q: å¸–å­è¢«åˆ é™¤äº†æ€ä¹ˆåŠï¼Ÿ</strong><br>
        A: æ£€æŸ¥æ˜¯å¦è¿åç¤¾åŒºè§„åˆ™ï¼Œå¯è”ç³»ç®¡ç†å‘˜å’¨è¯¢å…·ä½“åŸå› ã€‚</p>
        
        <p>æ„Ÿè°¢æ‚¨çš„æ”¯æŒï¼Œç¥æ‚¨åœ¨GameBoxç¤¾åŒºç©å¾—å¼€å¿ƒï¼ğŸ®</p>
      `,
      author: "GameBoxå®˜æ–¹",
      avatar: "ğŸ®",
      game: "GameBox",
      board: "general",
      replies: 156,
      likes: 892,
      views: 5432,
      time: "ç½®é¡¶"
    },
    "elden-newbie": {
      id: "elden-newbie",
      title: "æ–°æ‰‹å…¥é—¨ï¼šå¦‚ä½•åœ¨ã€Šè‰¾å°”ç™»æ³•ç¯ã€‹ä¸­å°‘æ­»ä¸€ç‚¹",
      content: `
        <p>å¤§å®¶å¥½ï¼Œä½œä¸ºä¸€ä¸ªä»é­‚ç³»æ¸¸æˆä¸€è·¯èµ°æ¥çš„è€ç©å®¶ï¼Œä»Šå¤©åˆ†äº«ä¸€äº›è‰¾å°”ç™»æ³•ç¯çš„æ–°æ‰‹æŠ€å·§ã€‚</p>
        
        <h4>ğŸ¯ èŒä¸šé€‰æ‹©å»ºè®®</h4>
        <p>å¯¹äºæ–°æ‰‹ï¼Œæ¨èé€‰æ‹©ä»¥ä¸‹èŒä¸šï¼š</p>
        <ul>
          <li><strong>æµæµªéª‘å£«</strong>ï¼šé«˜é˜²å¾¡ï¼Œå®¹é”™ç‡é«˜ï¼Œé€‚åˆè¿‘æˆ˜</li>
          <li><strong>é­”æ³•å¸ˆ</strong>ï¼šè¿œç¨‹è¾“å‡ºï¼Œå¯ä»¥é£ç­å¤§éƒ¨åˆ†Boss</li>
          <li><strong>æ­¦å£«</strong>ï¼šå¹³è¡¡å‹ï¼Œåˆå§‹è£…å¤‡ä¼˜ç§€</li>
        </ul>
        
        <h4>âš”ï¸ æˆ˜æ–—æŠ€å·§</h4>
        <ol>
          <li><strong>ä¸è¦è´ªåˆ€</strong>ï¼šçœ‹å‡†æ—¶æœºï¼Œæ‰“ä¸€ä¸¤åˆ€å°±æ’¤ï¼Œè€å¿ƒç£¨è¡€</li>
          <li><strong>å­¦ä¼šç¿»æ»š</strong>ï¼šç¿»æ»šæ˜¯æœ€é‡è¦çš„é˜²å¾¡æ‰‹æ®µï¼Œç»ƒä¹ ç¿»æ»šæ—¶æœº</li>
          <li><strong>ä½“åŠ›ç®¡ç†</strong>ï¼šæ°¸è¿œä¿ç•™ä¸€äº›ä½“åŠ›ç”¨äºç¿»æ»šå’Œè·‘è·¯</li>
          <li><strong>å–„ç”¨ç›¾å</strong>ï¼šä¸­å°å‹æ•Œäººå¯ä»¥å°è¯•ç›¾åï¼Œé«˜ä¼¤å®³+ç¡¬ç›´</li>
        </ol>
        
        <h4>ğŸ—ºï¸ æ¢ç´¢å»ºè®®</h4>
        <ul>
          <li>å‰æœŸä¸è¦æ€¥ç€æ‰“Bossï¼Œå…ˆåœ¨å®å§†æ ¼ç¦åœ°åŒºå……åˆ†æ¢ç´¢</li>
          <li>å¤šæ”¶é›†é»„é‡‘å¢æ©ï¼Œæå‡ç­‰çº§è®©æ¸¸æˆæ›´è½»æ¾</li>
          <li>å¯»æ‰¾æ•£è½å„åœ°çš„æˆ˜ç°å’ŒæŠ¤ç¬¦ï¼Œæå‡æˆ˜æ–—åŠ›</li>
          <li>å–„ç”¨åœ°å›¾æ ‡è®°åŠŸèƒ½ï¼Œè®°å½•é‡è¦åœ°ç‚¹</li>
        </ul>
        
        <h4>ğŸŒŸ å®ç”¨é“å…·</h4>
        <ul>
          <li><strong>çµä½“å¬å”¤</strong>ï¼šä¸æ˜¯ä½œå¼Šï¼åˆç†ä½¿ç”¨å¯ä»¥å¤§å¹…é™ä½éš¾åº¦</li>
          <li><strong>è¯ç“¶å‡çº§</strong>ï¼šä¼˜å…ˆå‡çº§çº¢ç“¶ï¼Œä¿è¯ç»­èˆªèƒ½åŠ›</li>
          <li><strong>åˆ¶ä½œææ–™</strong>ï¼šå¤šæ”¶é›†è‰è¯å’Œææ–™ï¼Œå¯ä»¥åˆ¶ä½œå®ç”¨æ¶ˆè€—å“</li>
        </ul>
        
        <p>è®°ä½ï¼Œè‰¾å°”ç™»æ³•ç¯æ˜¯ä¸€ä¸ªéœ€è¦è€å¿ƒå’Œå­¦ä¹ çš„æ¸¸æˆã€‚æ­»äº¡æ˜¯æ¸¸æˆçš„ä¸€éƒ¨åˆ†ï¼Œä¸è¦æ°”é¦ï¼Œæ¯æ¬¡å¤±è´¥éƒ½æ˜¯åœ¨ç§¯ç´¯ç»éªŒã€‚ç¥å¤§å®¶æ—©æ—¥æˆä¸ºè‰¾å°”ç™»ä¹‹ç‹ï¼ğŸ’ª</p>
      `,
      author: "è¤ªè‰²è€…å°æ˜",
      avatar: "âš”ï¸",
      game: "è‰¾å°”ç™»æ³•ç¯",
      board: "guide",
      replies: 89,
      likes: 456,
      views: 2341,
      time: "2å°æ—¶å‰"
    },
    "cp-photo": {
      id: "cp-photo",
      title: "ã€æˆªå›¾åˆ†äº«ã€‘å¤œä¹‹åŸçš„éœ“è™¹ç¯å¤ªç¾äº†ï¼",
      content: `
        <p>ç”¨ RTX 4090 å¼€æ»¡å…‰è¿½æ‹çš„ï¼Œè¿™æ¸¸æˆçš„ç”»é¢çœŸçš„æ˜¯ç»äº†ï¼</p>
        
        <h4>ğŸ“¸ æ‹æ‘„å‚æ•°</h4>
        <ul>
          <li><strong>æ˜¾å¡</strong>ï¼šRTX 4090 24GB</li>
          <li><strong>åˆ†è¾¨ç‡</strong>ï¼š4K (3840x2160)</li>
          <li><strong>å…‰è¿½ç­‰çº§</strong>ï¼šPsycho (æœ€é«˜)</li>
          <li><strong>DLSS</strong>ï¼šè´¨é‡æ¨¡å¼</li>
        </ul>
        
        <h4>ğŸŒƒ æ‹æ‘„åœ°ç‚¹</h4>
        <ol>
          <li><strong>é›¾è¡—</strong>ï¼šéœ“è™¹ç¯æœ€å¯†é›†çš„åœ°æ–¹ï¼Œæ™šä¸Šå»æœ€ç¾</li>
          <li><strong>å¸‚ä¸­å¿ƒ</strong>ï¼šé«˜æ¥¼å¤§å¦ï¼Œç§‘æŠ€æ„Ÿæ»¡æ»¡</li>
          <li><strong>åŒ—åŒºå·¥ä¸šå›­</strong>ï¼šåºŸåœŸæœ‹å…‹é£æ ¼</li>
          <li><strong>æ—¥æœ¬è¡—</strong>ï¼šä¼ ç»Ÿä¸æœªæ¥çš„ç¢°æ’</li>
        </ol>
        
        <p>å¤œä¹‹åŸçš„æ¯ä¸ªè§’è½éƒ½æ˜¯ä¸€å¹…èµ›åšæœ‹å…‹ç”»å·ã€‚ç‰¹åˆ«æ˜¯é›¨å¤©ï¼Œåœ°é¢çš„åå°„é…åˆéœ“è™¹ç¯ï¼Œç®€ç›´å°±æ˜¯ç”µå½±çº§åˆ«çš„ç”»é¢ï¼</p>
        
        <p><strong>Tipsï¼š</strong> æ¨èå¤§å®¶ä¸‹è½½Appearance Menu Modï¼Œå¯ä»¥éšæ—¶åˆ‡æ¢Vçš„å¤–è§‚ï¼Œæ‹ç…§æ›´æ–¹ä¾¿ï¼</p>
        
        <p>æ™šç‚¹æˆ‘ä¼šæŠŠè¿™äº›æˆªå›¾ä¸Šä¼ åˆ°Steamåˆ›æ„å·¥åŠï¼Œå–œæ¬¢çš„æœ‹å‹å¯ä»¥æ”¶è—~</p>
      `,
      author: "V",
      avatar: "ğŸŒƒ",
      game: "èµ›åšæœ‹å…‹ 2077",
      board: "shot",
      replies: 67,
      likes: 234,
      views: 1567,
      time: "30åˆ†é’Ÿå‰"
    },
    "zelda-tears": {
      id: "zelda-tears",
      title: "ç‹å›½ä¹‹æ³ª ç¥åº™å…¨æ”¶é›†æ”»ç•¥ï¼ˆæŒç»­æ›´æ–°ä¸­ï¼‰",
      content: `
        <p>æœ¬å¸–æ•´ç†äº†ç‹å›½ä¹‹æ³ªæ‰€æœ‰ç¥åº™çš„ä½ç½®å’Œè§£è°œæ–¹æ³•ï¼Œç›®å‰å·²æ›´æ–° 120/152 ä¸ªï¼Œæ¬¢è¿æ”¶è—ï¼</p>
        
        <h4>ğŸ“ ç¥åº™åˆ†å¸ƒç»Ÿè®¡</h4>
        <ul>
          <li><strong>åœ°è¡¨ç¥åº™</strong>ï¼š60ä¸ª âœ… å·²å®Œæˆ</li>
          <li><strong>å¤©ç©ºå²›ç¥åº™</strong>ï¼š40ä¸ª âœ… å·²å®Œæˆ</li>
          <li><strong>åœ°ä¸‹ç¥åº™</strong>ï¼š20ä¸ª ğŸ”„ è¿›è¡Œä¸­</li>
          <li><strong>ç‰¹æ®Šç¥åº™</strong>ï¼š32ä¸ª ğŸ”„ è¿›è¡Œä¸­</li>
        </ul>
        
        <h4>ğŸ¯ æ–°æ‰‹å¿…åšç¥åº™Top 10</h4>
        <ol>
          <li><strong>å¯å§‹ä¹‹å¡”</strong> - è§£é”åœ°å›¾å¡”åŠŸèƒ½</li>
          <li><strong>é¸Ÿæœ›å°ç¥åº™</strong> - è·å¾—æ»‘ç¿”ä¼</li>
          <li><strong>å›å¿†ä¹‹æ—</strong> - å¢åŠ å¿ƒä¹‹å™¨çš¿</li>
          <li><strong>æ—¶é—´åœæ­¢</strong> - å­¦ä¼šé‡è¦æŠ€èƒ½</li>
          <li><strong>ç«ç„°ä¹‹è¯•ç‚¼</strong> - è·å¾—ç‚ä¹‹å¤§å‰‘</li>
          <li><strong>å†°é›ªç¥åº™</strong> - å­¦ä¼šå†°å†»æŠ€å·§</li>
          <li><strong>é›·ç”µæ®¿å ‚</strong> - æŒæ¡é›·ç”µåº”ç”¨</li>
          <li><strong>é£ä¹‹ç¥­å›</strong> - å¼ºåŒ–æ»‘ç¿”èƒ½åŠ›</li>
          <li><strong>åŠ›é‡æµ‹è¯•</strong> - æå‡æ”»å‡»åŠ›</li>
          <li><strong>æ™ºæ…§è€ƒéªŒ</strong> - è·å¾—çç¨€é“å…·</li>
        </ol>
        
        <h4>ğŸ’¡ è§£è°œæŠ€å·§æ±‡æ€»</h4>
        <ul>
          <li><strong>ç©¶ææ‰‹</strong>ï¼šæœ€å¸¸ç”¨çš„èƒ½åŠ›ï¼Œå¯ä»¥ç§»åŠ¨å’Œç»„åˆç‰©ä½“</li>
          <li><strong>é€šå¤©æœ¯</strong>ï¼šå‘ä¸Šç©¿é€ç‰©ä½“ï¼Œå¿«é€Ÿåˆ°è¾¾é«˜å¤„</li>
          <li><strong>æ—¶å…‰å€’æµ</strong>ï¼šè®©ç‰©ä½“æ—¶é—´å€’æµï¼Œåˆ›é€ æ€§è§£è°œ</li>
          <li><strong>ä½™æ–™å»ºé€ </strong>ï¼šç²˜åˆç‰©å“åˆ¶ä½œå·¥å…·å’Œæ­¦å™¨</li>
        </ul>
        
        <h4>ğŸ—ºï¸ åœ°å›¾èµ„æº</h4>
        <p>æˆ‘åˆ¶ä½œäº†ä¸€ä¸ªäº’åŠ¨åœ°å›¾ï¼Œæ ‡è®°äº†æ‰€æœ‰ç¥åº™ä½ç½®ã€å‘€å“ˆå“ˆç§å­ã€ææ–™ç‚¹ç­‰ã€‚éœ€è¦çš„æœ‹å‹å¯ä»¥ç§ä¿¡æˆ‘è·å–é“¾æ¥ã€‚</p>
        
        <h4>ğŸ“¢ æ›´æ–°è®¡åˆ’</h4>
        <ul>
          <li>âœ… åœ°è¡¨ç¥åº™ (å·²å®Œæˆ)</li>
          <li>âœ… å¤©ç©ºå²›ç¥åº™ (å·²å®Œæˆ)</li>
          <li>ğŸ”„ åœ°ä¸‹ç¥åº™ (è¿›è¡Œä¸­ï¼Œé¢„è®¡3å¤©å®Œæˆ)</li>
          <li>ğŸ“… ç‰¹æ®Šç¥åº™ (è®¡åˆ’ä¸‹å‘¨å¼€å§‹)</li>
        </ul>
        
        <p>æ„Ÿè°¢å¤§å®¶çš„æ”¯æŒï¼æœ‰ä»»ä½•é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºæé—®ï¼Œæˆ‘ä¼šå°½å¿«å›å¤~</p>
      `,
      author: "æµ·æ‹‰é²å‹‡è€…",
      avatar: "ğŸ—¡ï¸",
      game: "å¡å°”è¾¾ä¼ è¯´ï¼šç‹å›½ä¹‹æ³ª",
      board: "guide",
      replies: 234,
      likes: 678,
      views: 4521,
      time: "1å¤©å‰"
    }
  };

  // è·å–URLå‚æ•°
  const urlParams = new URLSearchParams(window.location.search);
  const postId = urlParams.get('id') || 'elden-newbie';
  
  // å¸–å­æ•°æ®
  let currentPost = null;
  
  // å¼‚æ­¥åŠ è½½å¸–å­æ•°æ®
  async function loadPostData() {
    try {
      // ä¼˜å…ˆä» communityDataService è·å–å¸–å­ï¼ˆæ”¯æŒ Supabaseï¼‰
      if (window.communityDataService && typeof window.communityDataService.getPostById === 'function') {
        const result = window.communityDataService.getPostById(postId);
        currentPost = result instanceof Promise ? await result : result;
        
        if (currentPost) {
          console.log('âœ… ä»ç¤¾åŒºæ•°æ®æœåŠ¡åŠ è½½å¸–å­:', postId);
          
          // æ ¼å¼åŒ–æ—¶é—´
          if (typeof currentPost.time === 'number' || typeof currentPost.createdAt === 'number') {
            currentPost.time = formatTimeAgo(currentPost.createdAt || currentPost.time);
          }
          
          return;
        }
      }
    } catch (e) {
      console.error('åŠ è½½å¸–å­å¤±è´¥:', e);
    }
    
    // å¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™ä½¿ç”¨å…œåº•æ•°æ®
    currentPost = postDatabase[postId] || postDatabase['elden-newbie'];
    console.log('ğŸ“„ ä½¿ç”¨å…œåº•å¸–å­æ•°æ®:', postId);
  }
  
  // è¯„è®ºå­˜å‚¨é”®
  const COMMENTS_KEY = `gamebox_post_comments_${postId}`;
  
  // åŠ è½½è¯„è®ºï¼ˆä¼˜å…ˆä» Supabaseï¼‰
  async function loadComments() {
    try {
      // ä¼˜å…ˆä» communityDataService è·å–ï¼ˆæ”¯æŒ Supabaseï¼‰
      if (window.communityDataService && typeof window.communityDataService.getPostComments === 'function') {
        const result = window.communityDataService.getPostComments(postId);
        const comments = result instanceof Promise ? await result : result;
        if (comments && comments.length > 0) {
          return comments;
        }
      }
      
      // ä» localStorage è·å–
      const stored = localStorage.getItem(COMMENTS_KEY);
      if (stored) {
        return JSON.parse(stored);
      }
    } catch (e) {
      console.error('åŠ è½½è¯„è®ºå¤±è´¥:', e);
    }
    return [];
  }
  
  // ä¿å­˜è¯„è®ºï¼ˆåŒæ—¶ä¿å­˜åˆ° Supabase å’Œæœ¬åœ°ï¼‰
  async function saveComments(comments) {
    try {
      localStorage.setItem(COMMENTS_KEY, JSON.stringify(comments));
    } catch (e) {
      console.error('ä¿å­˜è¯„è®ºå¤±è´¥:', e);
    }
  }
  
  // æ·»åŠ è¯„è®ºï¼ˆä½¿ç”¨ communityDataServiceï¼‰
  async function addNewComment(commentData) {
    try {
      if (window.communityDataService && typeof window.communityDataService.addComment === 'function') {
        const result = window.communityDataService.addComment(postId, commentData);
        return result instanceof Promise ? await result : result;
      }
    } catch (e) {
      console.error('æ·»åŠ è¯„è®ºå¤±è´¥:', e);
    }
    return { success: false };
  }
  
  // æ ¼å¼åŒ–æ—¶é—´
  function formatTimeAgo(timestamp) {
    const now = Date.now();
    const diff = now - timestamp;
    
    const minutes = Math.floor(diff / 60000);
    if (minutes < 1) return 'åˆšåˆš';
    if (minutes < 60) return `${minutes} åˆ†é’Ÿå‰`;
    
    const hours = Math.floor(minutes / 60);
    if (hours < 24) return `${hours} å°æ—¶å‰`;
    
    const days = Math.floor(hours / 24);
    if (days < 30) return `${days} å¤©å‰`;
    
    const months = Math.floor(days / 30);
    return `${months} ä¸ªæœˆå‰`;
  }
  
  // è¯„è®ºæ•°æ®
  let comments = [];
  
  // é»˜è®¤è¯„è®º
  const defaultComments = [
    { 
      id: 1,
      author: "è·¯äººç”²", 
      avatar: "ğŸ‘¤",
      time: "1å°æ—¶å‰", 
      content: "æ„Ÿè°¢åˆ†äº«ï¼è¿™ä¸ªæ”»ç•¥å¤ªæœ‰ç”¨äº†ï¼Œæ­£å¥½éœ€è¦ã€‚",
      likes: 12
    },
    { 
      id: 2,
      author: "æ¸¸æˆè¾¾äºº", 
      avatar: "ğŸ®",
      time: "30åˆ†é’Ÿå‰", 
      content: "å†™å¾—å¾ˆè¯¦ç»†ï¼Œæ–°æ‰‹ç©å®¶å¿…çœ‹ï¼",
      likes: 8
    },
    {
      id: 3,
      author: "æ¢é™©è€…",
      avatar: "ğŸ§­",
      time: "15åˆ†é’Ÿå‰",
      content: "è¡¥å……ä¸€ç‚¹ï¼šå‰æœŸå¯ä»¥å»é¾™å¢“åˆ·å¢æ©ï¼Œæ•ˆç‡å¾ˆé«˜ã€‚",
      likes: 15
    }
  ];

  // æ¸²æŸ“å¸–å­å†…å®¹
  function renderPost() {
    document.title = `${currentPost.title} - GameBox æ¸¸ç›’`;
    document.getElementById('postTitle').textContent = currentPost.title;
    document.getElementById('authorAvatar').textContent = currentPost.avatar;
    document.getElementById('authorName').textContent = currentPost.author;
    document.getElementById('postTime').textContent = currentPost.time;
    document.getElementById('postViews').textContent = currentPost.views.toLocaleString();
    document.getElementById('postReplies').textContent = currentPost.replies + comments.length;
    document.getElementById('postGame').textContent = currentPost.game;
    document.getElementById('postContent').innerHTML = currentPost.content;
    document.getElementById('likeCount').textContent = currentPost.likes;
    
    // ä¾§è¾¹æ ç»Ÿè®¡
    document.getElementById('sidebarTime').textContent = currentPost.time;
    document.getElementById('sidebarViews').textContent = currentPost.views.toLocaleString();
    document.getElementById('sidebarReplies').textContent = currentPost.replies + comments.length;
    document.getElementById('sidebarLikes').textContent = currentPost.likes;
  }

  // æ¸²æŸ“è¯„è®ºåˆ—è¡¨
  function renderComments() {
    const commentListEl = document.getElementById("commentList");
    const commentCountEl = document.getElementById("commentCount");
    
    commentCountEl.textContent = comments.length;
    commentListEl.innerHTML = "";
    
    if (comments.length === 0) {
      commentListEl.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-muted);">ğŸ’¬ è¿˜æ²¡æœ‰è¯„è®ºï¼Œæ¥å‘è¡¨ç¬¬ä¸€æ¡å§ï¼</div>';
      return;
    }
    
    comments.forEach((c) => {
      const div = document.createElement("div");
      div.className = "comment-item";
      // å¤„ç†æ—¶é—´æ˜¾ç¤ºï¼ˆæ”¯æŒæ—¶é—´æˆ³å’Œæ–‡æœ¬ï¼‰
      const displayTime = typeof c.time === 'number' ? formatTimeAgo(c.time) : (c.timeText || c.time);
      div.innerHTML = `
        <div class="comment-header">
          <div class="comment-author">
            <div class="comment-avatar">${c.avatar}</div>
            <div>
              <div class="comment-author-name">${c.author}</div>
              <div class="comment-meta">å‘å¸ƒäº ${displayTime}</div>
            </div>
          </div>
        </div>
        <div class="comment-content">${c.content}</div>
        <div class="comment-actions">
          <span class="comment-action" onclick="likeComment(${c.id})">ğŸ‘ ç‚¹èµ (${c.likes})</span>
          <span class="comment-action" onclick="toggleReply(${c.id})">ğŸ’¬ å›å¤</span>
        </div>
        <div class="reply-form" id="reply-form-${c.id}">
          <input type="text" class="reply-input" id="reply-input-${c.id}" placeholder="è¾“å…¥å›å¤å†…å®¹..." />
          <button class="reply-btn" onclick="submitReply(${c.id})">å‘é€</button>
        </div>
      `;
      commentListEl.appendChild(div);
    });
  }

  // ç‚¹èµè¯„è®º - ä½¿ç”¨çœŸå®çš„ communityDataService API
  window.likeComment = async function(commentId) {
    // ä½¿ç”¨çœŸå®çš„è¯„è®ºç‚¹èµAPI
    if (window.communityDataService && typeof window.communityDataService.likeComment === 'function') {
      try {
        const result = window.communityDataService.likeComment(commentId);
        const likeResult = result instanceof Promise ? await result : result;
        
        if (likeResult.success) {
          // æ›´æ–°æœ¬åœ°è¯„è®ºåˆ—è¡¨ä¸­çš„ç‚¹èµæ•°
          const comment = comments.find(c => c.id === commentId);
          if (comment) {
            comment.likes = likeResult.likes;
          }
          renderComments();
          console.log(`${likeResult.liked ? 'ğŸ‘' : 'ğŸ‘'} è¯„è®ºç‚¹èµçŠ¶æ€æ›´æ–°:`, commentId, likeResult.likes);
        }
      } catch (e) {
        console.error('è¯„è®ºç‚¹èµå¤±è´¥:', e);
      }
    } else {
      // é™çº§åˆ°æœ¬åœ°æ¨¡å¼
      const comment = comments.find(c => c.id === commentId);
      if (comment) {
        comment.likes = (comment.likes || 0) + 1;
        renderComments();
      }
    }
  };

  // åˆ‡æ¢å›å¤æ¡†
  window.toggleReply = function(commentId) {
    const replyForm = document.getElementById(`reply-form-${commentId}`);
    if (replyForm) {
      replyForm.classList.toggle('show');
    }
  };

  // æäº¤å›å¤
  window.submitReply = function(commentId) {
    const input = document.getElementById(`reply-input-${commentId}`);
    const content = input.value.trim();
    
    if (!content) {
      alert('å›å¤å†…å®¹ä¸èƒ½ä¸ºç©º');
      return;
    }
    
    const user = getCurrentUser();
    const userName = user ? (user.nickname || user.username || "å·²ç™»å½•ç©å®¶") : "æ¸¸å®¢";
    
    const comment = comments.find(c => c.id === commentId);
    if (comment) {
      const newComment = {
        id: Date.now(),
        author: userName,
        avatar: "ğŸ‘¥",
        time: "åˆšåˆš",
        content: `å›å¤ @${comment.author}: ${content}`,
        likes: 0
      };
      comments.push(newComment);
      input.value = "";
      toggleReply(commentId);
      renderComments();
      
      // æ›´æ–°å›å¤æ•°
      currentPost.replies = currentPost.replies + 1;
      document.getElementById('postReplies').textContent = currentPost.replies + comments.length;
      document.getElementById('sidebarReplies').textContent = currentPost.replies + comments.length;
    }
  };

  // è·å–å½“å‰ç”¨æˆ·
  function getCurrentUser() {
    try {
      const raw = localStorage.getItem("currentUser");
      if (!raw) return null;
      return JSON.parse(raw);
    } catch { 
      return null; 
    }
  }

  // å‘è¡¨è¯„è®º - ä½¿ç”¨çœŸå®çš„ communityDataService API
  const btnComment = document.getElementById("btnComment");
  const newCommentEl = document.getElementById("newComment");
  const commentMsg = document.getElementById("commentMsg");

  btnComment.addEventListener("click", async () => {
    const text = newCommentEl.value.trim();
    if (!text) {
      commentMsg.textContent = "âŒ è¯„è®ºå†…å®¹ä¸èƒ½ä¸ºç©º";
      commentMsg.style.color = "var(--danger)";
      return;
    }
    
    // ç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤
    btnComment.disabled = true;
    btnComment.textContent = "ğŸ’¬ å‘å¸ƒä¸­...";
    
    try {
      // ä½¿ç”¨çœŸå®çš„è¯„è®ºAPI
      if (window.communityDataService && typeof window.communityDataService.addComment === 'function') {
        const user = getCurrentUser();
        const userName = user ? (user.nickname || user.username || "å·²ç™»å½•ç©å®¶") : "æ¸¸å®¢";
        const userAvatar = user?.avatar || "ğŸ‘¤";
        
        const commentData = {
          author: userName,
          avatar: userAvatar,
          content: text
        };
        
        const result = window.communityDataService.addComment(postId, commentData);
        const addResult = result instanceof Promise ? await result : result;
        
        if (addResult.success) {
          // æ·»åŠ åˆ°æœ¬åœ°è¯„è®ºåˆ—è¡¨
          comments.push(addResult.comment);
          
          // æ›´æ–°UI
          newCommentEl.value = "";
          commentMsg.textContent = "âœ… è¯„è®ºå‘å¸ƒæˆåŠŸï¼";
          commentMsg.style.color = "var(--cyber-cyan)";
          
          // æ›´æ–°å›å¤æ•°
          currentPost.replies = (currentPost.replies || 0) + 1;
          document.getElementById('postReplies').textContent = currentPost.replies;
          document.getElementById('sidebarReplies').textContent = currentPost.replies;
          
          // é‡æ–°æ¸²æŸ“è¯„è®ºåˆ—è¡¨
          renderComments();
          
          // æ»šåŠ¨åˆ°æœ€æ–°è¯„è®º
          setTimeout(() => {
            const commentListEl = document.getElementById('commentList');
            commentListEl.scrollIntoView({ behavior: 'smooth', block: 'end' });
          }, 100);
          
          console.log('âœ… è¯„è®ºå‘å¸ƒæˆåŠŸ:', addResult.comment);
          
          // 3ç§’åæ¸…é™¤æç¤º
          setTimeout(() => {
            const isSupabase = window.communityDataService?.isSupabaseEnabled?.() || false;
            commentMsg.textContent = isSupabase ? "ğŸ’¡ è¯„è®ºå·²ä¿å­˜åˆ°äº‘æ•°æ®åº“" : "ğŸ’¡ è¯„è®ºå·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨";
            commentMsg.style.color = "var(--text-soft)";
          }, 3000);
        } else {
          throw new Error(addResult.error || 'è¯„è®ºå‘å¸ƒå¤±è´¥');
        }
      } else {
        // é™çº§åˆ°æœ¬åœ°æ¨¡å¼
        const user = getCurrentUser();
        const name = user ? (user.nickname || user.username || "å·²ç™»å½•ç©å®¶") : "æ¸¸å®¢";

        const newComment = {
          id: Date.now(),
          author: name,
          avatar: "ğŸ‘¤",
          time: Date.now(),
          timeText: "åˆšåˆš",
          content: text,
          likes: 0
        };
        
        comments.push(newComment);
        saveComments(comments);
        
        newCommentEl.value = "";
        commentMsg.textContent = "âœ… è¯„è®ºå‘å¸ƒæˆåŠŸï¼ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰";
        commentMsg.style.color = "var(--cyber-cyan)";
        
        currentPost.replies = (currentPost.replies || 0) + 1;
        document.getElementById('postReplies').textContent = currentPost.replies;
        document.getElementById('sidebarReplies').textContent = currentPost.replies;
        
        renderComments();
      }
    } catch (e) {
      console.error('è¯„è®ºå‘å¸ƒå¤±è´¥:', e);
      commentMsg.textContent = `âŒ è¯„è®ºå‘å¸ƒå¤±è´¥: ${e.message}`;
      commentMsg.style.color = "var(--danger)";
    } finally {
      // æ¢å¤æŒ‰é’®çŠ¶æ€
      btnComment.disabled = false;
      btnComment.textContent = "ğŸ’¬ å‘è¡¨è¯„è®º";
    }
  });

  // ç‚¹èµæŒ‰é’® - ä½¿ç”¨çœŸå®çš„ communityDataService API
  const btnLike = document.getElementById("btnLike");
  let liked = false;

  // æ£€æŸ¥åˆå§‹ç‚¹èµçŠ¶æ€
  async function checkInitialLikeStatus() {
    if (window.communityDataService && typeof window.communityDataService.isPostLiked === 'function') {
      try {
        const result = window.communityDataService.isPostLiked(postId);
        liked = result instanceof Promise ? await result : result;
        if (liked) {
          btnLike.classList.add('active');
        }
      } catch (e) {
        console.error('æ£€æŸ¥ç‚¹èµçŠ¶æ€å¤±è´¥:', e);
      }
    }
  }

  btnLike.addEventListener("click", async () => {
    // ä½¿ç”¨çœŸå®çš„ç‚¹èµAPI
    if (window.communityDataService && typeof window.communityDataService.likePost === 'function') {
      try {
        const result = window.communityDataService.likePost(postId);
        const likeResult = result instanceof Promise ? await result : result;
        
        if (likeResult.success) {
          liked = likeResult.liked;
          currentPost.likes = likeResult.likes;
          
          if (liked) {
            btnLike.classList.add('active');
          } else {
            btnLike.classList.remove('active');
          }
          
          document.getElementById('likeCount').textContent = currentPost.likes;
          document.getElementById('sidebarLikes').textContent = currentPost.likes;
          
          console.log(`${liked ? 'ğŸ‘' : 'ğŸ‘'} ç‚¹èµçŠ¶æ€æ›´æ–°:`, currentPost.likes);
        }
      } catch (e) {
        console.error('ç‚¹èµæ“ä½œå¤±è´¥:', e);
        alert('ç‚¹èµå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
      }
    } else {
      // é™çº§åˆ°æœ¬åœ°æ¨¡å¼
      if (!liked) {
        currentPost.likes++;
        liked = true;
        btnLike.classList.add('active');
      } else {
        currentPost.likes--;
        liked = false;
        btnLike.classList.remove('active');
      }
      document.getElementById('likeCount').textContent = currentPost.likes;
      document.getElementById('sidebarLikes').textContent = currentPost.likes;
    }
  });

  // æ”¶è—æŒ‰é’®
  const btnFavorite = document.getElementById("btnFavorite");
  let favorited = false;

  btnFavorite.addEventListener("click", () => {
    if (!favorited) {
      favorited = true;
      btnFavorite.classList.add('active');
      alert('âœ… å·²æ”¶è—åˆ°"æˆ‘çš„æ”¶è—"');
    } else {
      favorited = false;
      btnFavorite.classList.remove('active');
      alert('âŒ å·²å–æ¶ˆæ”¶è—');
    }
  });

  // åˆ†äº«æŒ‰é’®
  const btnShare = document.getElementById("btnShare");
  btnShare.addEventListener("click", () => {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
      alert('ğŸ”— é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
    }).catch(() => {
      alert('ğŸ”— åˆ†äº«é“¾æ¥ï¼š\n' + url);
    });
  });

  // åˆå§‹åŒ–ï¼ˆå¼‚æ­¥ï¼‰
  async function initPostDetail() {
    console.log('ğŸš€ åˆå§‹åŒ–å¸–å­è¯¦æƒ…é¡µ...');
    
    // ç­‰å¾…æ•°æ®æœåŠ¡åˆå§‹åŒ–
    await new Promise(resolve => setTimeout(resolve, 100));
    
    // åŠ è½½å¸–å­æ•°æ®
    await loadPostData();
    
    // åŠ è½½è¯„è®ºæ•°æ®
    const storedComments = await loadComments();
    comments = storedComments.length > 0 ? storedComments : defaultComments;
    
    // æ¸²æŸ“é¡µé¢
    renderPost();
    renderComments();
    
    // æ£€æŸ¥åˆå§‹ç‚¹èµçŠ¶æ€
    await checkInitialLikeStatus();
    
    // è®°å½•é¡µé¢è®¿é—®
    if (window.communityDataService?.logPageView) {
      window.communityDataService.logPageView('post_detail');
    }
    
    // æ˜¾ç¤ºæ•°æ®æºçŠ¶æ€
    const isSupabase = window.communityDataService?.isSupabaseEnabled?.() || false;
    console.log(`âœ… å¸–å­è¯¦æƒ…é¡µåŠ è½½å®Œæˆ [æ•°æ®æº: ${isSupabase ? 'Supabase äº‘æ•°æ®åº“ âœ…' : 'æœ¬åœ°å­˜å‚¨ âš ï¸'}]`);
    
    // æ˜¾ç¤ºæ•°æ®æºæç¤º
    const dataSourceTip = document.getElementById('commentMsg');
    if (dataSourceTip) {
      dataSourceTip.textContent = isSupabase 
        ? 'ğŸ’¡ å·²è¿æ¥äº‘æ•°æ®åº“ï¼Œè¯„è®ºå’Œç‚¹èµå®æ—¶åŒæ­¥' 
        : 'ğŸ’¡ æœ¬åœ°å­˜å‚¨æ¨¡å¼ï¼Œæ•°æ®ä»…ä¿å­˜åœ¨å½“å‰æµè§ˆå™¨';
      dataSourceTip.style.color = 'var(--text-soft)';
    }
  }
  
  // å¯åŠ¨åˆå§‹åŒ–
  initPostDetail();
  
  // ç›‘å¬ç‚¹èµå®æ—¶æ›´æ–°äº‹ä»¶
  window.addEventListener('post-like-update', (e) => {
    if (e.detail && e.detail.postId === postId) {
      currentPost.likes = e.detail.likes;
      liked = e.detail.liked;
      document.getElementById('likeCount').textContent = currentPost.likes;
      document.getElementById('sidebarLikes').textContent = currentPost.likes;
      if (liked) {
        btnLike.classList.add('active');
      } else {
        btnLike.classList.remove('active');
      }
      console.log('ğŸ“¡ æ”¶åˆ°ç‚¹èµå®æ—¶æ›´æ–°:', e.detail);
    }
  });
</script>
<!-- å…¨å±€ä¸»é¢˜ç³»ç»Ÿ -->
<script src="global-theme-system.js"></script>
</body>
</html>
