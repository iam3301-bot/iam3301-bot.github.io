<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GameBox æ¸¸ç›’ - æ¸¸æˆè¯¦æƒ…</title>
  <!-- Cyberpunk Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css" />
  <style>
    /* æ¸¸æˆè¯¦æƒ…é¡µä¼˜åŒ–æ ·å¼ - ç¼©å°é¡¶éƒ¨åŒºåŸŸ */
    .detail-hero {
      padding: 12px !important;
      gap: 12px !important;
      grid-template-columns: 180px minmax(0, 1fr) !important;
    }
    
    .detail-cover-large {
      max-height: 220px;
    }
    
    .detail-cover-large img {
      max-height: 220px;
      object-fit: cover;
    }
    
    .detail-title {
      font-size: 18px !important;
      margin-bottom: 2px !important;
    }
    
    .detail-platform {
      font-size: 11px !important;
    }
    
    .detail-score-card {
      padding: 8px 12px !important;
    }
    
    .detail-score-value {
      font-size: 28px !important;
    }
    
    .detail-score-label,
    .detail-score-sub {
      font-size: 10px !important;
    }
    
    .detail-tag-row {
      margin-top: 6px !important;
      gap: 6px !important;
      flex-wrap: wrap;
    }
    
    .detail-tag-row .pill {
      padding: 3px 8px !important;
      font-size: 10px !important;
    }
    
    .detail-hero-desc {
      margin-top: 6px !important;
      font-size: 11px !important;
      line-height: 1.5 !important;
      max-height: 40px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    .detail-links {
      margin-top: 8px !important;
      gap: 8px !important;
    }
    
    .detail-btn {
      padding: 6px 14px !important;
      font-size: 11px !important;
    }
    
    /* Steamæ•°æ®å’Œç³»ç»Ÿé…ç½®åŒºåŸŸä¼˜åŒ– */
    .detail-info-grid {
      margin-top: 12px !important;
    }
    
    .detail-section {
      padding: 12px !important;
      margin-bottom: 12px !important;
    }
    
    .detail-section-header {
      margin-bottom: 10px !important;
    }
    
    .detail-section-title {
      font-size: 14px !important;
    }
    
    .sysreq-title {
      font-size: 12px !important;
      padding: 6px 10px !important;
    }
    
    .sysreq-list li {
      padding: 6px 10px !important;
      font-size: 11px !important;
    }
    
    .sysreq-note {
      font-size: 10px !important;
      margin-top: 8px !important;
      padding: 8px !important;
    }
    
    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .detail-hero {
        grid-template-columns: 1fr !important;
      }
      
      .detail-cover-large {
        max-height: 150px;
        width: 100%;
      }
    }
  </style>
</head>
<body data-current-page="detail" class="cyberpunk-theme">
<div class="page">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">æ’è¡Œæ¦œ</a>
      </nav>
    </div>
  </header>

  <!-- Cyberpunk Effects -->
  <canvas id="matrix-canvas" class="matrix-bg"></canvas>
  <div id="particles-container" class="particles-container"></div>
  <div id="scroll-progress" class="scroll-progress"></div>
  <div id="loading-overlay" class="loading-overlay">
    <div class="cyberpunk-loader">
      <div class="loader-hexagon"></div>
      <div class="loader-text">LOADING...</div>
    </div>
  </div>

  <!-- ä¸»ä½“ -->
  <main class="main main--single">
    <section>
      <article class="card detail-card">
        <!-- é¡¶éƒ¨æ ‡é¢˜ + è¿”å› -->
        <div class="detail-header-bar">
          <div class="detail-breadcrumb">
            æ¸¸æˆè¯¦æƒ… / <span id="breadcrumbName">åŠ è½½ä¸­...</span>
          </div>
          <button class="btn-secondary" onclick="history.back()">â† è¿”å›ä¸Šä¸€é¡µ</button>
        </div>

        <!-- è§†è§‰ä¸»åŒºåŸŸï¼ˆå°é¢ + æ ‡é¢˜ + å¤§å·è¯„åˆ† + æ ‡ç­¾ï¼‰ -->
        <div class="detail-hero cyber-glow-box">
          <div class="detail-hero-left">
            <div class="detail-cover-large">
              <img id="gameCover" src="" alt="æ¸¸æˆå°é¢" />
            </div>
          </div>

          <div class="detail-hero-right">
            <div class="detail-title-row">
              <div class="detail-title-block">
                <h1 id="gameTitle" class="detail-title">æ¸¸æˆåç§°åŠ è½½ä¸­...</h1>
                <div id="gamePlatform" class="detail-platform">å¹³å°ä¿¡æ¯åŠ è½½ä¸­...</div>
              </div>

              <div class="detail-score-card cyber-score-card">
                <div class="detail-score-label">æ¸¸ç›’çƒ­åº¦è¯„åˆ†</div>
                <div class="detail-score-main">
                  <span id="gameScore" class="detail-score-value">-</span>
                  <span class="detail-score-outof">/ 10</span>
                </div>
                <div class="detail-score-sub">åŸºäºSteamå¥½è¯„ç‡</div>
              </div>
            </div>

            <div class="detail-tag-row">
              <span class="pill" id="gameTag">æ ‡ç­¾åŠ è½½ä¸­...</span>
              <span class="pill pill-soft">
                å‘å”®ï¼š<span id="gameReleaseDate">æœªçŸ¥</span>
              </span>
              <span class="pill pill-soft">
                å¼€å‘ï¼š<span id="gameDeveloper">æœªçŸ¥</span>
              </span>
              <span class="pill pill-soft">
                å‘è¡Œï¼š<span id="gamePublisher">æœªçŸ¥</span>
              </span>
              <span class="pill pill-soft">
                å¹³å°ï¼š<span id="gamePlatformTag">æœªçŸ¥</span>
              </span>
            </div>

            <p id="gameDescription" class="detail-hero-desc">
              æ¸¸æˆç®€ä»‹åŠ è½½ä¸­...
            </p>

            <div class="detail-links">
              <a
                id="gameUrl"
                href="#"
                target="_blank"
                rel="noopener"
                class="detail-btn detail-btn-main"
              >
                <span>å‰å¾€ Steam å•†åº—é¡µé¢</span>
                <span class="detail-btn-icon">â†—</span>
              </a>

              <a
                id="gameProfileUrl"
                href="#"
                target="_blank"
                rel="noopener"
                class="detail-btn detail-btn-ghost"
              >
                <span>æŸ¥çœ‹ SteamDB è¯¦æƒ…</span>
                <span class="detail-btn-icon">â†—</span>
              </a>
            </div>
          </div>
        </div>

        <!-- ä¸‹æ–¹ä¿¡æ¯åŒº -->
        <div class="detail-info-grid">
          
          <!-- Steam æ•°æ®ç»Ÿè®¡ -->
          <section class="detail-section detail-section--primary cyber-sysreq-section" style="margin-bottom: 20px;">
            <div class="detail-section-header" style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
              <span style="font-size: 20px;">ğŸ“Š</span>
              <h2 class="detail-section-title" style="margin: 0;">// STEAM DATA</h2>
            </div>

            <div class="sysreq-grid" id="steamDataGrid">
              <!-- Steam æ•°æ®å°†å¡«å……è¿™é‡Œ -->
              <div class="sysreq-column">
                <div class="sysreq-title">Steam ç»Ÿè®¡</div>
                <ul class="sysreq-list" id="steamStatsList">
                  <li style="text-align: center; padding: 20px; color: var(--text-muted);">åŠ è½½ä¸­...</li>
                </ul>
              </div>

              <div class="sysreq-column sysreq-column--recommended">
                <div class="sysreq-title">è¯„ä»·è¯¦æƒ…</div>
                <ul class="sysreq-list" id="steamReviewsList">
                  <li style="text-align: center; padding: 20px; color: var(--text-muted);">åŠ è½½ä¸­...</li>
                </ul>
              </div>
            </div>
          </section>

          <!-- ç³»ç»Ÿé…ç½®è¦æ±‚ -->
          <section class="detail-section detail-section--secondary cyber-sysreq-section">
            <div class="detail-section-header" style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
              <span style="font-size: 20px;">ğŸ’»</span>
              <h2 class="detail-section-title" style="margin: 0;">// SYSTEM SPECS</h2>
            </div>

            <div class="sysreq-grid">
              <!-- æœ€ä½é…ç½® -->
              <div class="sysreq-column">
                <div class="sysreq-title">æœ€ä½é…ç½®</div>
                <ul class="sysreq-list" id="sysMinList">
                  <li style="text-align: center; padding: 20px; color: var(--text-muted);">åŠ è½½ä¸­...</li>
                </ul>
              </div>

              <!-- æ¨èé…ç½® -->
              <div class="sysreq-column sysreq-column--recommended">
                <div class="sysreq-title">æ¨èé…ç½®</div>
                <ul class="sysreq-list" id="sysRecommendedList">
                  <li style="text-align: center; padding: 20px; color: var(--text-muted);">åŠ è½½ä¸­...</li>
                </ul>
              </div>
            </div>

            <p class="detail-section-text sysreq-note">
              ç³»ç»Ÿé…ç½®æ•°æ®æ¥è‡ª Steam å•†åº—é¡µé¢ã€‚è‹¥æ˜¾ç¤º"æš‚æ— æ•°æ®"ï¼Œè¡¨ç¤ºè¯¥æ¸¸æˆåœ¨ Steam æ¥å£ä¸­æ²¡æœ‰æä¾›å¯¹åº”é…ç½®ä¿¡æ¯ã€‚
            </p>
          </section>
        </div>
      </article>
    </section>
  </main>
</div>

<script src="common.js"></script>
<script src="cyber-effects.js"></script>
<script src="steam-api.js"></script>
<!-- ğŸ® 5000æ¬¾çœŸå®Steamæ¸¸æˆæ•°æ®åº“ -->
<script src="real-5000-games-database.js"></script>
<script src="mega-game-database-real.js"></script>
<script>
// åˆå§‹åŒ–é€šç”¨é€»è¾‘ï¼ˆå¯¼èˆªé«˜äº®ï¼‰
initCommon();

const params = new URLSearchParams(window.location.search);
const gameId = params.get("id");
const gameName = params.get("name");

// DOM å…ƒç´ 
const breadcrumbNameEl = document.getElementById("breadcrumbName");
const titleEl = document.getElementById("gameTitle");
const platformEl = document.getElementById("gamePlatform");
const coverEl = document.getElementById("gameCover");
const scoreEl = document.getElementById("gameScore");
const devEl = document.getElementById("gameDeveloper");
const pubEl = document.getElementById("gamePublisher");
const dateEl = document.getElementById("gameReleaseDate");
const tagEl = document.getElementById("gameTag");
const descEl = document.getElementById("gameDescription");
const urlEl = document.getElementById("gameUrl");
const profileEl = document.getElementById("gameProfileUrl");
const platformTagEl = document.getElementById("gamePlatformTag");

// Steam æ•°æ® DOM
const steamStatsList = document.getElementById("steamStatsList");
const steamReviewsList = document.getElementById("steamReviewsList");

// ç³»ç»Ÿé…ç½® DOM
const sysMinListEl = document.getElementById("sysMinList");
const sysRecommendedListEl = document.getElementById("sysRecommendedList");

// å®‰å…¨è®¾ç½®æ–‡æœ¬
function safeSetText(el, text) {
  if (el) el.textContent = text;
}

if (!gameId && !gameName) {
  safeSetText(breadcrumbNameEl, "æœªæŒ‡å®š");
  safeSetText(titleEl, "æœªæŒ‡å®šæ¸¸æˆåç§°");
  safeSetText(descEl, "URL ä¸­æ²¡æœ‰æºå¸¦ id æˆ– name å‚æ•°ï¼Œæ— æ³•è¯†åˆ«è¦æŸ¥çœ‹çš„æ¸¸æˆã€‚");
} else {
  safeSetText(breadcrumbNameEl, gameName || ("#" + gameId));
  safeSetText(titleEl, "æ­£åœ¨åŠ è½½ï¼š" + (gameName || ("ID " + gameId)));
}

// åˆ›å»ºåˆ—è¡¨é¡¹
function createListItem(label, value) {
  const li = document.createElement('li');
  const labelSpan = document.createElement('span');
  labelSpan.className = 'sysreq-label';
  labelSpan.textContent = label;
  const valueSpan = document.createElement('span');
  valueSpan.className = 'sysreq-value';
  valueSpan.textContent = value || 'æš‚æ— æ•°æ®';
  li.appendChild(labelSpan);
  li.appendChild(valueSpan);
  return li;
}

// å¡«å…… Steam æ•°æ®
function fillSteamData(game) {
  steamStatsList.innerHTML = '';
  steamReviewsList.innerHTML = '';
  
  if (game.steamData) {
    const data = game.steamData;
    
    // Steam ç»Ÿè®¡
    steamStatsList.appendChild(createListItem('ğŸ® Steam App ID', game.appid || 'æœªçŸ¥'));
    steamStatsList.appendChild(createListItem('ğŸ‘¥ æ‹¥æœ‰è€…', data.owners || 'æœªçŸ¥'));
    steamStatsList.appendChild(createListItem('ğŸ“Š æ•°æ®æ¥æº', data.source || 'SteamSpy'));
    steamStatsList.appendChild(createListItem('ğŸ¯ æ¸¸æˆç±»å‹', game.category || game.genre || 'æœªçŸ¥'));
    steamStatsList.appendChild(createListItem('ğŸ“… å‘å”®å¹´ä»½', game.year || 'æœªçŸ¥'));
    
    // è¯„ä»·è¯¦æƒ…
    const positive = data.positive || 0;
    const negative = data.negative || 0;
    const total = positive + negative;
    const ratio = total > 0 ? (positive / total * 100).toFixed(1) : '0';
    
    steamReviewsList.appendChild(createListItem('ğŸ‘ å¥½è¯„æ•°', positive ? positive.toLocaleString() : 'æœªçŸ¥'));
    steamReviewsList.appendChild(createListItem('ğŸ‘ å·®è¯„æ•°', negative ? negative.toLocaleString() : 'æœªçŸ¥'));
    steamReviewsList.appendChild(createListItem('ğŸ“ æ€»è¯„æµ‹æ•°', total ? total.toLocaleString() : 'æœªçŸ¥'));
    steamReviewsList.appendChild(createListItem('â­ å¥½è¯„ç‡', total > 0 ? `${ratio}%` : 'æœªçŸ¥'));
    
    // è¯„ä»·ç­‰çº§
    let ratingLevel = 'æœªçŸ¥';
    if (total > 0) {
      const r = parseFloat(ratio);
      if (r >= 95) ratingLevel = 'å¥½è¯„å¦‚æ½®';
      else if (r >= 85) ratingLevel = 'ç‰¹åˆ«å¥½è¯„';
      else if (r >= 80) ratingLevel = 'å¤šåŠå¥½è¯„';
      else if (r >= 70) ratingLevel = 'è¤’è´¬ä¸ä¸€';
      else if (r >= 40) ratingLevel = 'å¤šåŠå·®è¯„';
      else ratingLevel = 'å·®è¯„å¦‚æ½®';
    }
    steamReviewsList.appendChild(createListItem('ğŸ† è¯„ä»·ç­‰çº§', ratingLevel));
  } else {
    steamStatsList.innerHTML = '<li style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ“Š æš‚æ—  Steam ç»Ÿè®¡æ•°æ®</li>';
    steamReviewsList.innerHTML = '<li style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ“ æš‚æ— è¯„ä»·æ•°æ®</li>';
  }
}

// å¡«å……ç³»ç»Ÿé…ç½®
function fillSystemRequirements(minReq, recReq) {
  sysMinListEl.innerHTML = '';
  sysRecommendedListEl.innerHTML = '';
  
  if (minReq) {
    sysMinListEl.appendChild(createListItem('æ“ä½œç³»ç»Ÿ', minReq.os));
    sysMinListEl.appendChild(createListItem('å¤„ç†å™¨', minReq.processor));
    sysMinListEl.appendChild(createListItem('å†…å­˜', minReq.memory));
    sysMinListEl.appendChild(createListItem('æ˜¾å¡', minReq.graphics));
    sysMinListEl.appendChild(createListItem('å­˜å‚¨ç©ºé—´', minReq.storage));
  } else {
    sysMinListEl.innerHTML = '<li style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ’» æš‚æ— æœ€ä½é…ç½®æ•°æ®</li>';
  }
  
  if (recReq) {
    sysRecommendedListEl.appendChild(createListItem('æ“ä½œç³»ç»Ÿ', recReq.os));
    sysRecommendedListEl.appendChild(createListItem('å¤„ç†å™¨', recReq.processor));
    sysRecommendedListEl.appendChild(createListItem('å†…å­˜', recReq.memory));
    sysRecommendedListEl.appendChild(createListItem('æ˜¾å¡', recReq.graphics));
    sysRecommendedListEl.appendChild(createListItem('å­˜å‚¨ç©ºé—´', recReq.storage));
  } else {
    sysRecommendedListEl.innerHTML = '<li style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ’» æš‚æ— æ¨èé…ç½®æ•°æ®</li>';
  }
}

// ä» Steam API è·å–ç³»ç»Ÿé…ç½®
async function fetchSteamRequirements(gameTitle, appid) {
  try {
    console.log(`æ­£åœ¨è·å– ${gameTitle} çš„ç³»ç»Ÿé…ç½®...`);
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    sysMinListEl.innerHTML = '<li style="text-align: center; padding: 20px; color: var(--text-muted);">â³ æ­£åœ¨è·å–é…ç½®...</li>';
    sysRecommendedListEl.innerHTML = '<li style="text-align: center; padding: 20px; color: var(--text-muted);">â³ æ­£åœ¨è·å–é…ç½®...</li>';
    
    // å¦‚æœæœ‰ appidï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°ä»£ç†æœåŠ¡å™¨
    if (appid && typeof appid === 'number') {
      try {
        const response = await fetch(`/api/steam/appdetails?appid=${appid}`);
        if (response.ok) {
          const data = await response.json();
          if (data && data[appid] && data[appid].success) {
            const pcReq = data[appid].data.pc_requirements;
            if (pcReq) {
              const minReq = pcReq.minimum ? parseRequirementsHTML(pcReq.minimum) : null;
              const recReq = pcReq.recommended ? parseRequirementsHTML(pcReq.recommended) : null;
              fillSystemRequirements(minReq, recReq);
              console.log(`âœ… æˆåŠŸè·å– ${gameTitle} çš„ç³»ç»Ÿé…ç½®`);
              return;
            }
          }
        }
      } catch (proxyErr) {
        console.log('æœ¬åœ°ä»£ç†å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ–¹å¼...');
      }
    }
    
    // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ steamAPI å·¥å…·ç±»
    if (window.steamAPI) {
      try {
        const requirements = await window.steamAPI.getSystemRequirements(gameTitle);
        fillSystemRequirements(requirements.minimum, requirements.recommended);
        
        if (requirements.minimum || requirements.recommended) {
          console.log(`âœ… æˆåŠŸè·å– ${gameTitle} çš„ç³»ç»Ÿé…ç½®`);
        } else {
          console.log(`â„¹ï¸ ${gameTitle} æ— ç³»ç»Ÿé…ç½®æ•°æ®`);
        }
      } catch (apiErr) {
        console.log(`â„¹ï¸ ${gameTitle} æ— ç³»ç»Ÿé…ç½®æ•°æ®`);
        fillSystemRequirements(null, null);
      }
    } else {
      fillSystemRequirements(null, null);
    }
  } catch (err) {
    console.error(`âŒ è·å–ç³»ç»Ÿé…ç½®å¤±è´¥:`, err);
    fillSystemRequirements(null, null);
  }
}

// è§£æ Steam HTML æ ¼å¼çš„ç³»ç»Ÿé…ç½®
function parseRequirementsHTML(htmlString) {
  if (!htmlString || typeof htmlString !== 'string') return null;
  
  const parser = new DOMParser();
  const doc = parser.parseFromString(htmlString, 'text/html');
  const text = doc.body.textContent || '';
  
  const result = {};
  
  const patterns = {
    os: /OS[:\s]*([^\n]+)/i,
    processor: /Processor[:\s]*([^\n]+)/i,
    memory: /Memory[:\s]*([^\n]+)/i,
    graphics: /Graphics[:\s]*([^\n]+)/i,
    storage: /Storage[:\s]*([^\n]+)/i,
  };
  
  for (const [key, pattern] of Object.entries(patterns)) {
    const match = text.match(pattern);
    if (match && match[1]) {
      result[key] = match[1].trim();
    }
  }
  
  return Object.keys(result).length > 0 ? result : null;
}

// ä¸»åŠ è½½å‡½æ•°
async function loadDetail() {
  if (!gameId && !gameName) return;

  try {
    // ä»çœŸå®æ¸¸æˆæ•°æ®åº“è·å–æ¸¸æˆæ•°æ®
    let game = null;
    const allGames = window.megaGameDB.getAllGames();
    
    // ä¼˜å…ˆä½¿ç”¨åç§°ç²¾ç¡®åŒ¹é…ï¼ˆæ›´å‡†ç¡®ï¼‰
    if (gameName) {
      game = window.megaGameDB.getGameByName(gameName);
      
      // å¦‚æœç²¾ç¡®åŒ¹é…å¤±è´¥ï¼Œå°è¯•æ¨¡ç³ŠåŒ¹é…
      if (!game) {
        const lowerName = gameName.toLowerCase();
        game = allGames.find(g => 
          g.name.toLowerCase().includes(lowerName) ||
          g.title.toLowerCase().includes(lowerName)
        );
      }
    }
    
    // å¦‚æœåç§°åŒ¹é…å¤±è´¥ï¼Œå†å°è¯•ç”¨IDæŸ¥æ‰¾
    if (!game && gameId) {
      game = window.megaGameDB.getGameById(gameId);
    }

    if (!game) {
      safeSetText(titleEl, "æ¸¸æˆæœªæ‰¾åˆ°");
      safeSetText(descEl, "åœ¨æ¸¸æˆåº“ä¸­æ‰¾ä¸åˆ°è¯¥æ¸¸æˆï¼Œè¯·è¿”å›é‡æ–°é€‰æ‹©ã€‚");
      steamStatsList.innerHTML = '<li style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</li>';
      steamReviewsList.innerHTML = '<li style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</li>';
      sysMinListEl.innerHTML = '<li style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</li>';
      sysRecommendedListEl.innerHTML = '<li style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</li>';
      return;
    }

    // å¡«å……åŸºæœ¬ä¿¡æ¯
    safeSetText(breadcrumbNameEl, game.name || game.title);
    safeSetText(titleEl, game.name || game.title);
    safeSetText(platformEl, game.platform || "PC");
    safeSetText(devEl, game.developer || "æœªçŸ¥");
    safeSetText(pubEl, game.publisher || "æœªçŸ¥");
    safeSetText(dateEl, game.releaseDate || game.year || "æœªçŸ¥");
    safeSetText(tagEl, game.category || game.genre || "æ¸¸æˆ");
    safeSetText(platformTagEl, game.platform || "PC (Windows)");
    
    // æ¸¸æˆæè¿°
    let description = game.short_description || `${game.name} æ˜¯ä¸€æ¬¾ç”± ${game.developer || 'æœªçŸ¥'} å¼€å‘çš„ ${game.category || game.genre || ''} æ¸¸æˆã€‚`;
    safeSetText(descEl, description);
    
    // è¯„åˆ†
    const score = Number(game.rating) || 0;
    safeSetText(scoreEl, score.toFixed(1));
    
    // å°é¢å›¾
    const coverUrl = game.thumbnail;
    if (coverUrl) {
      coverEl.src = coverUrl;
      coverEl.alt = (game.name || game.title) + " å°é¢";
      coverEl.onerror = function() {
        this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOnJnYigxMDIsMTI2LDIzNCk7c3RvcC1vcGFjaXR5OjEiIC8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjpyZ2IoMTE4LDc1LDE2Mik7c3RvcC1vcGFjaXR5OjEiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSI0MDAiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSIxNTAiIHk9IjIyMCIgZm9udC1zaXplPSIxMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfjonuPC90ZXh0Pjwvc3ZnPg==';
      };
    }
    
    // Steam é“¾æ¥
    if (game.appid && typeof game.appid === 'number') {
      urlEl.href = `https://store.steampowered.com/app/${game.appid}`;
      urlEl.style.display = 'flex';
      profileEl.href = `https://steamdb.info/app/${game.appid}/`;
      profileEl.style.display = 'flex';
    } else {
      urlEl.style.display = 'none';
      profileEl.style.display = 'none';
    }

    // å¡«å…… Steam æ•°æ®
    fillSteamData(game);

    // è·å–ç³»ç»Ÿé…ç½®
    fetchSteamRequirements(game.name || game.title, game.appid);
    
  } catch (err) {
    console.error("åŠ è½½è¯¦æƒ…å¤±è´¥ï¼š", err);
    safeSetText(titleEl, "åŠ è½½å¤±è´¥");
    safeSetText(descEl, "æ— æ³•åŠ è½½æ¸¸æˆæ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚é”™è¯¯: " + err.message);
  }
}

loadDetail();
</script>
</body>
</html>
