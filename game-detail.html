<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GameBox æ¸¸ç›’ - æ¸¸æˆè¯¦æƒ…</title>
  <!-- Cyberpunk Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css" />
</head>
<body data-current-page="detail" class="cyberpunk-theme">
<div class="page">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">æ’è¡Œæ¦œ</a>
      </nav>
    </div>
  </header>

  <!-- Cyberpunk Effects -->
  <canvas id="matrix-canvas" class="matrix-bg"></canvas>
  <div id="particles-container" class="particles-container"></div>
  <div id="scroll-progress" class="scroll-progress"></div>
  <div id="loading-overlay" class="loading-overlay">
    <div class="cyberpunk-loader">
      <div class="loader-hexagon"></div>
      <div class="loader-text">LOADING...</div>
    </div>
  </div>

  <!-- ä¸»ä½“ -->
  <main class="main main--single">
    <section>
      <article class="card detail-card">
        <!-- é¡¶éƒ¨æ ‡é¢˜ + è¿”å› -->
        <div class="detail-header-bar">
          <div class="detail-breadcrumb">
            æ¸¸æˆè¯¦æƒ… / <span id="breadcrumbName">åŠ è½½ä¸­...</span>
          </div>
          <button class="btn-secondary" onclick="history.back()">â† è¿”å›ä¸Šä¸€é¡µ</button>
        </div>

        <!-- è§†è§‰ä¸»åŒºåŸŸï¼ˆå°é¢ + æ ‡é¢˜ + å¤§å·è¯„åˆ† + æ ‡ç­¾ï¼‰ -->
        <div class="detail-hero cyber-glow-box">
          <div class="detail-hero-left">
            <div class="detail-cover-large">
              <img id="gameCover" src="" alt="æ¸¸æˆå°é¢" />
            </div>
          </div>

          <div class="detail-hero-right">
            <div class="detail-title-row">
              <div class="detail-title-block">
                <h1 id="gameTitle" class="detail-title">æ¸¸æˆåç§°åŠ è½½ä¸­...</h1>
                <div id="gamePlatform" class="detail-platform">å¹³å°ä¿¡æ¯åŠ è½½ä¸­...</div>
              </div>

              <div class="detail-score-card cyber-score-card">
                <div class="detail-score-label">æ¸¸ç›’çƒ­åº¦è¯„åˆ†</div>
                <div class="detail-score-main">
                  <span id="gameScore" class="detail-score-value">-</span>
                  <span class="detail-score-outof">/ 10</span>
                </div>
                <div class="detail-score-sub">åŸºäºæ’è¡Œæ¦œä½ç½®æ¨¡æ‹Ÿ</div>
              </div>
            </div>

            <div class="detail-tag-row">
              <span class="pill" id="gameTag">æ ‡ç­¾åŠ è½½ä¸­...</span>
              <span class="pill pill-soft">
                å‘å”®ï¼š<span id="gameReleaseDate">æœªçŸ¥</span>
              </span>
              <span class="pill pill-soft">
                å¼€å‘ï¼š<span id="gameDeveloper">æœªçŸ¥</span>
              </span>
              <span class="pill pill-soft">
                å‘è¡Œï¼š<span id="gamePublisher">æœªçŸ¥</span>
              </span>
              <span class="pill pill-soft">
                å¹³å°ï¼š<span id="gamePlatformTag">æœªçŸ¥</span>
              </span>
            </div>

            <p id="gameDescription" class="detail-hero-desc">
              æ¸¸æˆç®€ä»‹åŠ è½½ä¸­...
            </p>

            <div class="detail-links">
              <a
                id="gameUrl"
                href="#"
                target="_blank"
                rel="noopener"
                class="detail-btn detail-btn-main"
              >
                <span>å‰å¾€æ¸¸æˆå®˜ç½‘ / å¯åŠ¨å¹³å°</span>
                <span class="detail-btn-icon">â†—</span>
              </a>

              <a
                id="gameProfileUrl"
                href="#"
                target="_blank"
                rel="noopener"
                class="detail-btn detail-btn-ghost"
              >
                <span>æŸ¥çœ‹ FreeToGame è¯¦æƒ…é¡µ</span>
                <span class="detail-btn-icon">â†—</span>
              </a>
            </div>
          </div>
        </div>

        <!-- ä¸‹æ–¹ä¿¡æ¯åŒº -->
        <div class="detail-info-grid">
          <!-- ç³»ç»Ÿé…ç½®ï¼ˆæœ€ä½ + æ¨èé…ç½®ï¼‰ -->
          <section class="detail-section detail-section--secondary cyber-sysreq-section">
            <h2 class="detail-section-title">ç³»ç»Ÿé…ç½®ï¼ˆæ¥è‡ª FreeToGameï¼‰</h2>

            <div class="sysreq-grid">
              <!-- æœ€ä½é…ç½® -->
              <div class="sysreq-column">
                <div class="sysreq-title">æœ€ä½é…ç½®</div>
                <ul class="sysreq-list" id="sysMinList">
                  <!-- æœ€ä½é…ç½®é¡¹å°†å¡«å……è¿™é‡Œ -->
                </ul>
              </div>

              <!-- æ¨èé…ç½® -->
              <div class="sysreq-column sysreq-column--recommended">
                <div class="sysreq-title">æ¨èé…ç½®</div>
                <ul class="sysreq-list" id="sysRecommendedList">
                  <!-- æ¨èé…ç½®é¡¹å°†å¡«å……è¿™é‡Œ -->
                </ul>
              </div>
            </div>

            <p class="detail-section-text sysreq-note">
              ä»¥ä¸Šæœ€ä½é…ç½®æ•°æ®ç›´æ¥æ¥è‡ª FreeToGame API çš„
              <code>minimum_system_requirements</code> å­—æ®µï¼›è‹¥æŸé¡¹ä»æ˜¾ç¤ºâ€œæ¥å£æœªæä¾›â€ï¼Œ
              è¡¨ç¤ºè¯¥æ¸¸æˆåœ¨æ¥å£ä¸­æ²¡æœ‰ç»™å‡ºå¯¹åº”é…ç½®ã€‚
            </p>
          </section>
        </div>
      </article>
    </section>
  </main>
</div>

<script src="common.js"></script>
<script src="cyber-effects.js"></script>
<script src="steam-api.js"></script>
<script src="mega-game-database.js"></script>
<script>
// åˆå§‹åŒ–é€šç”¨é€»è¾‘ï¼ˆå¯¼èˆªé«˜äº®ï¼‰
initCommon();

const params = new URLSearchParams(window.location.search);
const gameId = params.get("id"); // ä¼˜å…ˆç”¨ id ç²¾ç¡®å®šä½
const gameName = params.get("name");

// é¡¶éƒ¨å…ƒç´ 
const breadcrumbNameEl = document.getElementById("breadcrumbName");
const titleEl = document.getElementById("gameTitle");
const platformEl = document.getElementById("gamePlatform");
const coverEl = document.getElementById("gameCover");
const scoreEl = document.getElementById("gameScore");
const devEl = document.getElementById("gameDeveloper");
const pubEl = document.getElementById("gamePublisher");
const dateEl = document.getElementById("gameReleaseDate");
const tagEl = document.getElementById("gameTag");
const descEl = document.getElementById("gameDescription");
const urlEl = document.getElementById("gameUrl");
const profileEl = document.getElementById("gameProfileUrl");
const platformTagEl = document.getElementById("gamePlatformTag");

// ä¸‹æ–¹â€œåŸºç¡€ä¿¡æ¯â€åŒºåŸŸ
const devMetaEl = document.getElementById("gameDeveloperMeta");
const pubMetaEl = document.getElementById("gamePublisherMeta");
const releaseMetaEl = document.getElementById("gameReleaseMeta");
const platformMetaEl = document.getElementById("gamePlatformMeta");
const scoreMetaEl = document.getElementById("gameScoreMeta");

// ç³»ç»Ÿé…ç½® DOM
const sysMinListEl = document.getElementById("sysMinList");
const sysRecommendedListEl = document.getElementById("sysRecommendedList");

// å®‰å…¨è®¾ç½®æ–‡æœ¬
function safeSetText(el, text) {
  if (el) el.textContent = text;
}

if (!gameId && !gameName) {
  safeSetText(breadcrumbNameEl, "æœªæŒ‡å®š");
  safeSetText(titleEl, "æœªæŒ‡å®šæ¸¸æˆåç§°");
  safeSetText(
    descEl,
    "URL ä¸­æ²¡æœ‰æºå¸¦ id æˆ– name å‚æ•°ï¼Œæ— æ³•è¯†åˆ«è¦æŸ¥çœ‹çš„æ¸¸æˆã€‚"
  );
} else {
  safeSetText(breadcrumbNameEl, gameName || ("#" + gameId));
  safeSetText(
    titleEl,
    "æ­£åœ¨åŠ è½½ï¼š" + (gameName || ("ID " + gameId))
  );
}

// æ¸¸æˆæ•°æ®ç°åœ¨ä» mega-game-database.js åŠ è½½

// å¡«å……æœ€ä½é…ç½®çš„å‡½æ•°
function fillMinSysReq(sys) {
  const fallback = "æ¥å£æœªæä¾›";

  if (!sys) {
    sysMinListEl.innerHTML = `
      <li><span class="sysreq-label">ç³»ç»Ÿ</span><span class="sysreq-value">${fallback}</span></li>
      <li><span class="sysreq-label">å¤„ç†å™¨</span><span class="sysreq-value">${fallback}</span></li>
      <li><span class="sysreq-label">å†…å­˜</span><span class="sysreq-value">${fallback}</span></li>
      <li><span class="sysreq-label">æ˜¾å¡</span><span class="sysreq-value">${fallback}</span></li>
      <li><span class="sysreq-label">å­˜å‚¨</span><span class="sysreq-value">${fallback}</span></li>
    `;
    return;
  }

  // ä½¿ç”¨ textContent è€Œä¸æ˜¯ innerHTML æ¥é˜²æ­¢ XSS
  const createListItem = (label, value) => {
    const li = document.createElement('li');
    const labelSpan = document.createElement('span');
    labelSpan.className = 'sysreq-label';
    labelSpan.textContent = label;
    const valueSpan = document.createElement('span');
    valueSpan.className = 'sysreq-value';
    valueSpan.textContent = value || fallback;
    li.appendChild(labelSpan);
    li.appendChild(valueSpan);
    return li;
  };

  sysMinListEl.innerHTML = '';
  sysMinListEl.appendChild(createListItem('ç³»ç»Ÿ', sys.os));
  sysMinListEl.appendChild(createListItem('å¤„ç†å™¨', sys.processor));
  sysMinListEl.appendChild(createListItem('å†…å­˜', sys.memory));
  sysMinListEl.appendChild(createListItem('æ˜¾å¡', sys.graphics));
  sysMinListEl.appendChild(createListItem('å­˜å‚¨', sys.storage));
}

// å¡«å……æ¨èé…ç½®çš„å‡½æ•°
function fillRecommendedSysReq(sys) {
  const fallback = "æš‚æ— æ¨èé…ç½®";

  if (!sys) {
    sysRecommendedListEl.innerHTML = `
      <li style="text-align: center; padding: 20px; color: var(--text-soft);">
        <span>${fallback}</span><br>
        <span style="font-size: 11px; opacity: 0.8;">æ¨èé…ç½®éœ€è¦ä» Steam è·å–ï¼Œå¯èƒ½æ— æ³•è·å–åˆ°æ•°æ®</span>
      </li>
    `;
    return;
  }

  // ä½¿ç”¨ textContent è€Œä¸æ˜¯ innerHTML æ¥é˜²æ­¢ XSS
  const createListItem = (label, value) => {
    const li = document.createElement('li');
    const labelSpan = document.createElement('span');
    labelSpan.className = 'sysreq-label';
    labelSpan.textContent = label;
    const valueSpan = document.createElement('span');
    valueSpan.className = 'sysreq-value';
    valueSpan.textContent = value || fallback;
    li.appendChild(labelSpan);
    li.appendChild(valueSpan);
    return li;
  };

  sysRecommendedListEl.innerHTML = '';
  sysRecommendedListEl.appendChild(createListItem('ç³»ç»Ÿ', sys.os));
  sysRecommendedListEl.appendChild(createListItem('å¤„ç†å™¨', sys.processor));
  sysRecommendedListEl.appendChild(createListItem('å†…å­˜', sys.memory));
  sysRecommendedListEl.appendChild(createListItem('æ˜¾å¡', sys.graphics));
  sysRecommendedListEl.appendChild(createListItem('å­˜å‚¨', sys.storage));
}

// è·å– Steam æ¨èé…ç½®å¹¶å¡«å……ï¼ˆä½¿ç”¨æ–°çš„ steamAPI å·¥å…·ç±»ï¼‰
async function fetchSteamRecommendedSysReq(gameTitle) {
  try {
    console.log(`æ­£åœ¨è·å– ${gameTitle} çš„æ¨èé…ç½®...`);
    
    // ä½¿ç”¨å…¨å±€ steamAPI å®ä¾‹ï¼ˆå·²ä» steam-api.js åŠ è½½ï¼‰
    const requirements = await window.steamAPI.getRecommendedRequirements(gameTitle);
    
    if (requirements) {
      console.log(`âœ… æˆåŠŸè·å– ${gameTitle} çš„æ¨èé…ç½®`);
      fillRecommendedSysReq(requirements);
    } else {
      console.log(`â„¹ï¸ ${gameTitle} æ— æ¨èé…ç½®æ•°æ®`);
      fillRecommendedSysReq(null);
    }
  } catch (err) {
    console.error(`âŒ ä» Steam è·å–æ¨èé…ç½®æ—¶å‡ºé”™:`, err);
    fillRecommendedSysReq(null);
  }
}

async function loadDetail() {
  if (!gameId && !gameName) return;

  // æ˜¾ç¤ºåŠ è½½æç¤º
  sysMinListEl.innerHTML = '<li style="text-align: center; color: var(--text-muted); padding: 20px;">åŠ è½½ä¸­...</li>';
  sysRecommendedListEl.innerHTML = '<li style="text-align: center; color: var(--text-muted); padding: 20px;">åŠ è½½ä¸­...</li>';

  try {
    // ä»mega-game-database.jsè·å–æ¸¸æˆæ•°æ®
    const allGames = await window.megaGameDB.getAllGames();
    
    // æ ¹æ®IDæˆ–åç§°æŸ¥æ‰¾æ¸¸æˆ
    let game = null;
    if (gameId) {
      // æ³¨æ„ï¼šmega-game-databaseç”Ÿæˆçš„æ¸¸æˆæ²¡æœ‰idå­—æ®µï¼Œéœ€è¦ç”¨ç´¢å¼•
      const index = parseInt(gameId) - 1;
      if (index >= 0 && index < allGames.length) {
        game = allGames[index];
        game.id = index + 1; // æ·»åŠ idå­—æ®µ
      }
    }
    if (!game && gameName) {
      game = allGames.find(g => g.name === gameName || g.title === gameName);
    }

    if (!game) {
      safeSetText(titleEl, "æ¸¸æˆæœªæ‰¾åˆ°");
      safeSetText(descEl, "åœ¨æ¸¸æˆåº“ä¸­æ‰¾ä¸åˆ°è¯¥æ¸¸æˆï¼Œè¯·è¿”å›é‡æ–°é€‰æ‹©ã€‚");
      sysMinListEl.innerHTML = '<li style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</li>';
      sysRecommendedListEl.innerHTML = '<li style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</li>';
      return;
    }

    // å¡«å……åŸºæœ¬ä¿¡æ¯ - ä½¿ç”¨mega-game-databaseçš„å­—æ®µ
    safeSetText(breadcrumbNameEl, game.name || game.title);
    safeSetText(titleEl, game.name || game.title);
    safeSetText(platformEl, game.platform || "PC");
    safeSetText(devEl, game.developer || "æœªçŸ¥");
    safeSetText(pubEl, game.publisher || "æœªçŸ¥");
    safeSetText(dateEl, game.releaseDate || "æœªçŸ¥");
    safeSetText(tagEl, game.genre || game.category || "æ¸¸æˆ");
    safeSetText(descEl, game.short_description || "æš‚æ— æ¸¸æˆç®€ä»‹");
    safeSetText(platformTagEl, game.platform || "PC (Windows)");
    
    // è¯„åˆ†
    const score = Number(game.rating) || 0;
    safeSetText(scoreEl, score.toFixed(1));
    
    // å°é¢å›¾
    const coverUrl = game.thumbnail;
    if (coverUrl) {
      coverEl.src = coverUrl;
      coverEl.alt = (game.name || game.title) + " å°é¢";
      coverEl.onerror = function() {
        this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOnJnYigxMDIsMTI2LDIzNCk7c3RvcC1vcGFjaXR5OjEiIC8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjpyZ2IoMTE4LDc1LDE2Mik7c3RvcC1vcGFjaXR5OjEiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSI0MDAiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSIxNTAiIHk9IjIyMCIgZm9udC1zaXplPSIxMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfjonuPC90ZXh0Pjwvc3ZnPg==';
      };
    }
    
    // éšè—å¤–éƒ¨é“¾æ¥ï¼ˆmega-game-databaseæ²¡æœ‰è¿™äº›å­—æ®µï¼‰
    urlEl.style.display = 'none';
    profileEl.style.display = 'none';

    // mega-game-databaseæ²¡æœ‰ç³»ç»Ÿé…ç½®æ•°æ®ï¼Œæ˜¾ç¤ºæç¤º
    fillMinSysReq(null);
    sysMinListEl.innerHTML = '<li style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ“Š ç³»ç»Ÿé…ç½®æ•°æ®æ­£åœ¨å¼€å‘ä¸­</li>';

    // å°è¯•è·å– Steam æ¨èé…ç½®ï¼ˆå¯é€‰ï¼Œå¯èƒ½å¤±è´¥ï¼‰
    fetchSteamRecommendedSysReq(game.name || game.title);
    
  } catch (err) {
    console.error("åŠ è½½è¯¦æƒ…å¤±è´¥ï¼š", err);
    safeSetText(titleEl, "åŠ è½½å¤±è´¥");
    safeSetText(descEl, "æ— æ³•åŠ è½½æ¸¸æˆæ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚é”™è¯¯: " + err.message);
    sysMinListEl.innerHTML = '<li style="color: var(--danger);">æ•°æ®åŠ è½½å¤±è´¥</li>';
    sysRecommendedListEl.innerHTML = '<li style="color: var(--danger);">æ•°æ®åŠ è½½å¤±è´¥</li>';
  }
}

loadDetail();
</script>
</body>
</html>
