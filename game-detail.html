<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GameBox 游盒 - 游戏详情</title>
  <link rel="stylesheet" href="index.css" />
</head>
<body data-current-page="detail">
<div class="page">
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox 游盒</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">首页</a>
        <a href="game-library.html" data-page="library" class="nav-link">游戏库</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">排行榜</a>
      </nav>
    </div>
  </header>

  <main class="main main--single">
    <section>
      <article class="card" id="detailCard">
        <div class="card-header">
          <div>
            <div class="card-title" id="gameTitle">游戏名称加载中...</div>
            <div class="card-subtitle" id="gamePlatform">平台信息加载中...</div>
          </div>
          <button class="btn-secondary" onclick="history.back()">← 返回上一页</button>
        </div>

        <div class="detail-layout">
          <div class="detail-cover">
            <img id="gameCover" src="" alt="游戏封面" />
          </div>
          <div class="detail-main">
            <div class="detail-row">
              <span class="detail-label">评分：</span>
              <span id="gameScore" class="detail-score">N/A</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">开发商：</span>
              <span id="gameDeveloper">N/A</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">发行商：</span>
              <span id="gamePublisher">N/A</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">发售日期：</span>
              <span id="gameReleaseDate">N/A</span>
            </div>
            <div class="detail-row">
              <span class="detail-label">标签：</span>
              <span id="gameTag">N/A</span>
            </div>

            <div class="detail-desc">
              <div class="detail-desc-title">简介</div>
              <p id="gameDescription">游戏描述加载中...</p>
            </div>

            <div class="detail-links">
              <a id="gameUrl" href="#" target="_blank" rel="noopener" class="btn-primary">
                前往游戏官网 / 启动平台
              </a>
              <a id="gameProfileUrl" href="#" target="_blank" rel="noopener" class="btn-link">
                查看 FreeToGame 页面
              </a>
            </div>
          </div>
        </div>
      </article>
    </section>
  </main>
</div>

<script src="common.js"></script>
<script>
  initCommon();

  const params = new URLSearchParams(window.location.search);
  const gameName = params.get("name");

  const titleEl = document.getElementById("gameTitle");
  const platformEl = document.getElementById("gamePlatform");
  const coverEl = document.getElementById("gameCover");
  const scoreEl = document.getElementById("gameScore");
  const devEl = document.getElementById("gameDeveloper");
  const pubEl = document.getElementById("gamePublisher");
  const dateEl = document.getElementById("gameReleaseDate");
  const tagEl = document.getElementById("gameTag");
  const descEl = document.getElementById("gameDescription");
  const urlEl = document.getElementById("gameUrl");
  const profileEl = document.getElementById("gameProfileUrl");

  if (!gameName) {
    titleEl.textContent = "未指定游戏名称";
    platformEl.textContent = "";
    descEl.textContent = "URL 中没有携带 name 参数，无法识别要查看的游戏。";
  } else {
    titleEl.textContent = `正在加载：${gameName}`;
  }

  function findGame(data, name) {
    const all = []
      .concat(data.hot || [], data.score || [], data.new || [], data.discount || []);
    return all.find((g) => g.name === name);
  }

  function loadDetail() {
    if (!gameName) return;

    fetch("ranking.json")
      .then((res) => {
        if (!res.ok) throw new Error("HTTP 状态码 " + res.status);
        return res.json();
      })
      .then((data) => {
        const game = findGame(data, gameName);
        if (!game) {
          titleEl.textContent = gameName;
          platformEl.textContent = "";
          descEl.textContent = "没有在当前排行榜数据中找到这个游戏，可能已经下架或未被收录。";
          coverEl.style.display = "none";
          return;
        }

        titleEl.textContent = game.name;
        platformEl.textContent = game.platform || "";
        coverEl.src = game.cover;
        coverEl.alt = game.name + " 封面";

        const score = Number(game.score) || 0;
        scoreEl.textContent = score ? score.toFixed(1) : "-";

        devEl.textContent = game.developer || "未知";
        pubEl.textContent = game.publisher || "未知";
        dateEl.textContent = game.releaseDate || "未知";
        tagEl.textContent = game.tag || "暂无";

        descEl.textContent = game.description || "暂无简介（原 API 未提供详细介绍）";

        if (game.gameUrl) {
          urlEl.href = game.gameUrl;
        } else {
          urlEl.style.display = "none";
        }

        if (game.profileUrl) {
          profileEl.href = game.profileUrl;
        } else {
          profileEl.style.display = "none";
        }
      })
      .catch((err) => {
        console.error("加载详情失败：", err);
        descEl.textContent = "加载详情失败，请稍后再试。";
      });
  }

  loadDetail();
</script>
</body>
</html>
