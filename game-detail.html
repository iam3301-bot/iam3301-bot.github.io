<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GameBox æ¸¸ç›’ - æ¸¸æˆè¯¦æƒ…</title>
  <!-- Cyberpunk Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="index.css" />
  <style>
    /* ===== æ¸¸æˆè¯¦æƒ…é¡µä¼˜åŒ–æ ·å¼ ===== */
    
    /* ===== é¡¶éƒ¨åŒºåŸŸ - æè‡´å‹ç¼©é«˜åº¦ ===== */
    .detail-hero {
      padding: 8px 12px !important;
      gap: 10px !important;
      grid-template-columns: 100px minmax(0, 1fr) !important;
      min-height: auto !important;
      max-height: 130px !important;
      background: linear-gradient(135deg, rgba(10, 10, 10, 0.95) 0%, rgba(20, 0, 30, 0.9) 100%) !important;
      overflow: hidden;
    }
    
    .detail-cover-large {
      max-height: 110px !important;
      height: 110px !important;
      width: 100px !important;
    }
    
    .detail-cover-large img {
      max-height: 110px !important;
      height: 110px !important;
      width: 100% !important;
      object-fit: cover !important;
      border-radius: 6px !important;
    }
    
    .detail-hero-left {
      display: flex;
      align-items: center;
    }
    
    .detail-hero-right {
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 4px;
      overflow: hidden;
    }
    
    .detail-title-row {
      gap: 8px !important;
      align-items: center !important;
    }
    
    .detail-title {
      font-size: 15px !important;
      margin-bottom: 0 !important;
      line-height: 1.1 !important;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .detail-title-block {
      flex: 1;
      overflow: hidden;
    }
    
    .detail-platform {
      font-size: 10px !important;
      margin-top: 2px;
    }
    
    .detail-score-card {
      padding: 4px 8px !important;
      width: 70px !important;
      min-width: 70px !important;
      flex-shrink: 0;
    }
    
    .detail-score-value {
      font-size: 18px !important;
    }
    
    .detail-score-label {
      font-size: 7px !important;
    }
    
    .detail-score-sub,
    .detail-score-outof {
      font-size: 8px !important;
    }
    
    .detail-tag-row {
      margin-top: 2px !important;
      gap: 3px !important;
      flex-wrap: nowrap;
      overflow: hidden;
    }
    
    .detail-tag-row .pill {
      padding: 1px 5px !important;
      font-size: 8px !important;
      white-space: nowrap;
    }
    
    .detail-hero-desc {
      margin-top: 2px !important;
      font-size: 10px !important;
      line-height: 1.3 !important;
      max-height: 26px;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    
    .detail-links {
      margin-top: 4px !important;
      gap: 4px !important;
    }
    
    .detail-btn {
      padding: 3px 8px !important;
      font-size: 9px !important;
    }
    
    /* ===== Steamæ•°æ®å’Œç³»ç»Ÿé…ç½®åŒºåŸŸä¼˜åŒ– ===== */
    .detail-info-grid {
      margin-top: 16px !important;
    }
    
    .detail-section {
      padding: 14px 16px !important;
      margin-bottom: 14px !important;
    }
    
    .detail-section-header {
      margin-bottom: 12px !important;
    }
    
    .detail-section-title {
      font-size: 13px !important;
    }
    
    /* ===== ç³»ç»Ÿé…ç½® - è¶…ç´§å‡‘ä¸€è¡Œæ˜¾ç¤º ===== */
    .sysreq-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .sysreq-column {
      background: rgba(0, 0, 0, 0.3) !important;
      border: 1px solid rgba(85, 234, 212, 0.2) !important;
      border-radius: 6px !important;
      padding: 8px !important;
    }
    
    .sysreq-column--recommended {
      border-color: rgba(255, 211, 0, 0.2) !important;
    }
    
    .sysreq-title {
      font-size: 11px !important;
      font-weight: 700 !important;
      padding: 4px 8px !important;
      margin-bottom: 8px !important;
      background: rgba(85, 234, 212, 0.15) !important;
      border-left: 3px solid var(--cyber-cyan) !important;
      color: var(--cyber-cyan) !important;
    }
    
    .sysreq-column--recommended .sysreq-title {
      background: rgba(255, 211, 0, 0.15) !important;
      border-left-color: var(--cyber-yellow) !important;
      color: var(--cyber-yellow) !important;
    }
    
    /* é…ç½®åˆ—è¡¨ - ä¸€è¡Œæ˜¾ç¤º */
    .sysreq-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    
    .sysreq-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 6px !important;
      margin-bottom: 3px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      border-left: 2px solid rgba(85, 234, 212, 0.3);
      font-size: 10px !important;
      gap: 8px;
      min-height: 22px;
    }
    
    .sysreq-list li:last-child {
      margin-bottom: 0;
    }
    
    .sysreq-column--recommended .sysreq-list li {
      border-left-color: rgba(255, 211, 0, 0.3);
    }
    
    .sysreq-label {
      font-weight: 600;
      color: rgba(255, 255, 255, 0.6);
      font-size: 9px !important;
      min-width: 45px;
      flex-shrink: 0;
      text-transform: uppercase;
      letter-spacing: 0.2px;
    }
    
    .sysreq-value {
      color: rgba(255, 255, 255, 0.9);
      font-size: 10px !important;
      text-align: right;
      flex: 1;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .sysreq-note {
      font-size: 9px !important;
      margin-top: 8px !important;
      padding: 6px 8px !important;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      color: rgba(255, 255, 255, 0.5);
    }
    
    /* ===== ç´§å‡‘å‹é…ç½®è¡Œ - å•è¡Œæ˜¾ç¤º ===== */
    .sysreq-compact {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    
    .sysreq-row {
      display: flex;
      align-items: center;
      padding: 4px 8px;
      background: rgba(0, 0, 0, 0.35);
      border-radius: 4px;
      border-left: 2px solid rgba(85, 234, 212, 0.3);
      min-height: 24px;
    }
    
    .sysreq-column--recommended .sysreq-row {
      border-left-color: rgba(255, 211, 0, 0.3);
    }
    
    .sysreq-row-label {
      font-size: 9px;
      font-weight: 600;
      color: var(--cyber-cyan);
      min-width: 50px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      flex-shrink: 0;
    }
    
    .sysreq-column--recommended .sysreq-row-label {
      color: var(--cyber-yellow);
    }
    
    .sysreq-row-value {
      font-size: 10px;
      color: rgba(255, 255, 255, 0.9);
      flex: 1;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* ===== å“åº”å¼ ===== */
    @media (max-width: 900px) {
      .sysreq-grid {
        grid-template-columns: 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .detail-hero {
        grid-template-columns: 1fr !important;
        padding: 10px !important;
      }
      
      .detail-cover-large {
        max-height: 120px !important;
        height: 120px !important;
        width: 100% !important;
        max-width: 200px !important;
        margin: 0 auto;
      }
      
      .detail-title {
        font-size: 16px !important;
        text-align: center;
      }
      
      .detail-title-row {
        flex-direction: column;
        align-items: center;
      }
      
      .detail-tag-row {
        justify-content: center;
      }
      
      .detail-links {
        justify-content: center;
      }
    }
  </style>
</head>
<body data-current-page="detail">
<div class="page">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="header">
    <div class="header-inner">
      <a href="index.html" class="logo">
        <div class="logo-mark">G</div>
        <div>
          <div>GameBox æ¸¸ç›’</div>
          <div class="logo-sub">LIGHTWEIGHT GAME HUB</div>
        </div>
      </a>

      <nav class="nav-main">
        <a href="index.html" data-page="home" class="nav-link">é¦–é¡µ</a>
        <a href="game-library.html" data-page="library" class="nav-link">æ¸¸æˆåº“</a>
        <a href="ranking.html" data-page="ranking" class="nav-link">
          æ’è¡Œæ¦œ <span class="badge">HOT</span>
        </a>
        <a href="discount.html" data-page="discount" class="nav-link">æŠ˜æ‰£ / å²ä½</a>
        <a href="community.html" data-page="community" class="nav-link">ç¤¾åŒº</a>
        <a href="news-list.html" data-page="news" class="nav-link">èµ„è®¯</a>
        <a href="tools.html" data-page="tools" class="nav-link">å·¥å…·</a>
        <a href="my-library.html" data-page="my" class="nav-link">æˆ‘çš„æ¸¸æˆ</a>
        <a href="profile.html" data-page="profile" class="nav-link">ç”¨æˆ·ä¸­å¿ƒ</a>
      </nav>
    </div>
  </header>

  <!-- Cyberpunk Effects -->
  <canvas id="matrix-canvas" class="matrix-bg"></canvas>
  <div id="particles-container" class="particles-container"></div>
  <div id="scroll-progress" class="scroll-progress"></div>
  <div id="loading-overlay" class="loading-overlay">
    <div class="cyberpunk-loader">
      <div class="loader-hexagon"></div>
      <div class="loader-text">LOADING...</div>
    </div>
  </div>

  <!-- ä¸»ä½“ -->
  <main class="main main--single">
    <section>
      <article class="card detail-card">
        <!-- é¡¶éƒ¨æ ‡é¢˜ + è¿”å› -->
        <div class="detail-header-bar">
          <div class="detail-breadcrumb">
            æ¸¸æˆè¯¦æƒ… / <span id="breadcrumbName">åŠ è½½ä¸­...</span>
          </div>
          <button class="btn-secondary" onclick="history.back()">â† è¿”å›ä¸Šä¸€é¡µ</button>
        </div>

        <!-- è§†è§‰ä¸»åŒºåŸŸï¼ˆå°é¢ + æ ‡é¢˜ + å¤§å·è¯„åˆ† + æ ‡ç­¾ï¼‰- é«˜åº¦ç¼©å‡ -->
        <div class="detail-hero cyber-glow-box">
          <div class="detail-hero-left">
            <div class="detail-cover-large">
              <img id="gameCover" src="" alt="æ¸¸æˆå°é¢" />
            </div>
          </div>

          <div class="detail-hero-right">
            <div class="detail-title-row">
              <div class="detail-title-block">
                <h1 id="gameTitle" class="detail-title">æ¸¸æˆåç§°åŠ è½½ä¸­...</h1>
                <div id="gamePlatform" class="detail-platform">å¹³å°ä¿¡æ¯åŠ è½½ä¸­...</div>
              </div>

              <div class="detail-score-card cyber-score-card">
                <div class="detail-score-label">æ¸¸ç›’çƒ­åº¦è¯„åˆ†</div>
                <div class="detail-score-main">
                  <span id="gameScore" class="detail-score-value">-</span>
                  <span class="detail-score-outof">/ 10</span>
                </div>
                <div class="detail-score-sub">åŸºäºSteamå¥½è¯„ç‡</div>
              </div>
            </div>

            <div class="detail-tag-row">
              <span class="pill" id="gameTag">æ ‡ç­¾</span>
              <span class="pill pill-soft">å‘å”®ï¼š<span id="gameReleaseDate">æœªçŸ¥</span></span>
              <span class="pill pill-soft">å¼€å‘ï¼š<span id="gameDeveloper">æœªçŸ¥</span></span>
              <span class="pill pill-soft">å‘è¡Œï¼š<span id="gamePublisher">æœªçŸ¥</span></span>
            </div>

            <p id="gameDescription" class="detail-hero-desc">æ¸¸æˆç®€ä»‹åŠ è½½ä¸­...</p>

            <div class="detail-links">
              <a id="gameUrl" href="#" target="_blank" rel="noopener" class="detail-btn detail-btn-main">
                <span>å‰å¾€ Steam å•†åº—</span>
                <span class="detail-btn-icon">â†—</span>
              </a>
              <a id="gameProfileUrl" href="#" target="_blank" rel="noopener" class="detail-btn detail-btn-ghost">
                <span>æŸ¥çœ‹ SteamDB</span>
                <span class="detail-btn-icon">â†—</span>
              </a>
            </div>
          </div>
        </div>

        <!-- ä¸‹æ–¹ä¿¡æ¯åŒº -->
        <div class="detail-info-grid">
          
          <!-- Steam æ•°æ®ç»Ÿè®¡ -->
          <section class="detail-section detail-section--primary cyber-sysreq-section" style="margin-bottom: 16px;">
            <div class="detail-section-header" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span style="font-size: 18px;">ğŸ“Š</span>
              <h2 class="detail-section-title" style="margin: 0;">// STEAM DATA</h2>
            </div>

            <div class="sysreq-grid" id="steamDataGrid">
              <!-- Steam ç»Ÿè®¡ -->
              <div class="sysreq-column">
                <div class="sysreq-title">STEAM ç»Ÿè®¡</div>
                <div class="sysreq-compact" id="steamStatsList">
                  <div style="text-align: center; padding: 20px; color: var(--text-muted);">åŠ è½½ä¸­...</div>
                </div>
              </div>

              <!-- è¯„ä»·è¯¦æƒ… -->
              <div class="sysreq-column sysreq-column--recommended">
                <div class="sysreq-title">è¯„ä»·è¯¦æƒ…</div>
                <div class="sysreq-compact" id="steamReviewsList">
                  <div style="text-align: center; padding: 20px; color: var(--text-muted);">åŠ è½½ä¸­...</div>
                </div>
              </div>
            </div>
          </section>

          <!-- ç³»ç»Ÿé…ç½®è¦æ±‚ -->
          <section class="detail-section detail-section--secondary cyber-sysreq-section">
            <div class="detail-section-header" style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
              <span style="font-size: 18px;">ğŸ’»</span>
              <h2 class="detail-section-title" style="margin: 0;">// SYSTEM SPECS</h2>
            </div>

            <div class="sysreq-grid">
              <!-- æœ€ä½é…ç½® -->
              <div class="sysreq-column">
                <div class="sysreq-title">æœ€ä½é…ç½®</div>
                <div class="sysreq-compact" id="sysMinList">
                  <div style="text-align: center; padding: 20px; color: var(--text-muted);">åŠ è½½ä¸­...</div>
                </div>
              </div>

              <!-- æ¨èé…ç½® -->
              <div class="sysreq-column sysreq-column--recommended">
                <div class="sysreq-title">æ¨èé…ç½®</div>
                <div class="sysreq-compact" id="sysRecommendedList">
                  <div style="text-align: center; padding: 20px; color: var(--text-muted);">åŠ è½½ä¸­...</div>
                </div>
              </div>
            </div>

            <p class="sysreq-note">
              ğŸ’¡ ç³»ç»Ÿé…ç½®æ•°æ®æ¥è‡ª Steam å•†åº—é¡µé¢ã€‚è‹¥æ˜¾ç¤º"æš‚æ— æ•°æ®"ï¼Œè¡¨ç¤ºè¯¥æ¸¸æˆåœ¨ Steam æ¥å£ä¸­æ²¡æœ‰æä¾›å¯¹åº”é…ç½®ä¿¡æ¯ã€‚
            </p>
          </section>
        </div>
      </article>
    </section>
  </main>
</div>

<script src="common.js"></script>
<script src="cyber-effects.js"></script>
<script src="steam-api.js"></script>
<!-- ğŸ® 5000æ¬¾çœŸå®Steamæ¸¸æˆæ•°æ®åº“ -->
<script src="real-5000-games-database.js"></script>
<script src="mega-game-database-real.js"></script>
<script src="chinese-game-names.js"></script>
<script src="multi-platform-games.js"></script>
<script>
// åˆå§‹åŒ–é€šç”¨é€»è¾‘ï¼ˆå¯¼èˆªé«˜äº®ï¼‰
initCommon();

const params = new URLSearchParams(window.location.search);
const gameId = params.get("id");
const gameName = params.get("name");

// DOM å…ƒç´ 
const breadcrumbNameEl = document.getElementById("breadcrumbName");
const titleEl = document.getElementById("gameTitle");
const platformEl = document.getElementById("gamePlatform");
const coverEl = document.getElementById("gameCover");
const scoreEl = document.getElementById("gameScore");
const devEl = document.getElementById("gameDeveloper");
const pubEl = document.getElementById("gamePublisher");
const dateEl = document.getElementById("gameReleaseDate");
const tagEl = document.getElementById("gameTag");
const descEl = document.getElementById("gameDescription");
const urlEl = document.getElementById("gameUrl");
const profileEl = document.getElementById("gameProfileUrl");

// Steam æ•°æ® DOM
const steamStatsList = document.getElementById("steamStatsList");
const steamReviewsList = document.getElementById("steamReviewsList");

// ç³»ç»Ÿé…ç½® DOM
const sysMinListEl = document.getElementById("sysMinList");
const sysRecommendedListEl = document.getElementById("sysRecommendedList");

// å®‰å…¨è®¾ç½®æ–‡æœ¬
function safeSetText(el, text) {
  if (el) el.textContent = text;
}

if (!gameId && !gameName) {
  safeSetText(breadcrumbNameEl, "æœªæŒ‡å®š");
  safeSetText(titleEl, "æœªæŒ‡å®šæ¸¸æˆåç§°");
  safeSetText(descEl, "URL ä¸­æ²¡æœ‰æºå¸¦ id æˆ– name å‚æ•°ï¼Œæ— æ³•è¯†åˆ«è¦æŸ¥çœ‹çš„æ¸¸æˆã€‚");
} else {
  safeSetText(breadcrumbNameEl, gameName || ("#" + gameId));
  safeSetText(titleEl, "æ­£åœ¨åŠ è½½ï¼š" + (gameName || ("ID " + gameId)));
}

// åˆ›å»ºç´§å‡‘å‹é…ç½®è¡Œï¼ˆå•è¡Œæ˜¾ç¤ºï¼Œå¸¦æ‚¬åœæ˜¾ç¤ºå®Œæ•´å†…å®¹ï¼‰
function createCompactRow(label, value, icon = '') {
  const div = document.createElement('div');
  div.className = 'sysreq-row';
  
  // å¤„ç†å€¼ï¼Œæˆªæ–­è¿‡é•¿çš„æ–‡æœ¬
  let displayValue = value || 'æš‚æ— æ•°æ®';
  let fullValue = displayValue;
  
  // å¦‚æœå€¼å¤ªé•¿ï¼Œæˆªæ–­å¹¶æ·»åŠ çœç•¥å·
  if (displayValue.length > 50) {
    displayValue = displayValue.substring(0, 47) + '...';
  }
  
  div.innerHTML = `
    <span class="sysreq-row-label">${icon}${label}</span>
    <span class="sysreq-row-value" title="${fullValue}">${displayValue}</span>
  `;
  return div;
}

// å¡«å…… Steam æ•°æ®ï¼ˆç´§å‡‘ç‰ˆï¼‰
function fillSteamData(game) {
  steamStatsList.innerHTML = '';
  steamReviewsList.innerHTML = '';
  
  if (game.steamData) {
    const data = game.steamData;
    
    // Steam ç»Ÿè®¡ - ç´§å‡‘è¡Œ
    steamStatsList.appendChild(createCompactRow('App ID', game.appid || 'æœªçŸ¥', 'ğŸ® '));
    steamStatsList.appendChild(createCompactRow('æ‹¥æœ‰è€…', data.owners || 'æœªçŸ¥', 'ğŸ‘¥ '));
    steamStatsList.appendChild(createCompactRow('æ•°æ®æº', data.source || 'SteamSpy', 'ğŸ“Š '));
    steamStatsList.appendChild(createCompactRow('ç±»å‹', game.category || game.genre || 'æœªçŸ¥', 'ğŸ¯ '));
    steamStatsList.appendChild(createCompactRow('å¹´ä»½', game.year || 'æœªçŸ¥', 'ğŸ“… '));
    
    // è¯„ä»·è¯¦æƒ…
    const positive = data.positive || 0;
    const negative = data.negative || 0;
    const total = positive + negative;
    const ratio = total > 0 ? (positive / total * 100).toFixed(1) : '0';
    
    steamReviewsList.appendChild(createCompactRow('å¥½è¯„æ•°', positive ? positive.toLocaleString() : 'æœªçŸ¥', 'ğŸ‘ '));
    steamReviewsList.appendChild(createCompactRow('å·®è¯„æ•°', negative ? negative.toLocaleString() : 'æœªçŸ¥', 'ğŸ‘ '));
    steamReviewsList.appendChild(createCompactRow('æ€»è¯„æµ‹', total ? total.toLocaleString() : 'æœªçŸ¥', 'ğŸ“ '));
    steamReviewsList.appendChild(createCompactRow('å¥½è¯„ç‡', total > 0 ? `${ratio}%` : 'æœªçŸ¥', 'â­ '));
    
    // è¯„ä»·ç­‰çº§
    let ratingLevel = 'æœªçŸ¥';
    if (total > 0) {
      const r = parseFloat(ratio);
      if (r >= 95) ratingLevel = 'å¥½è¯„å¦‚æ½®';
      else if (r >= 85) ratingLevel = 'ç‰¹åˆ«å¥½è¯„';
      else if (r >= 80) ratingLevel = 'å¤šåŠå¥½è¯„';
      else if (r >= 70) ratingLevel = 'è¤’è´¬ä¸ä¸€';
      else if (r >= 40) ratingLevel = 'å¤šåŠå·®è¯„';
      else ratingLevel = 'å·®è¯„å¦‚æ½®';
    }
    steamReviewsList.appendChild(createCompactRow('ç­‰çº§', ratingLevel, 'ğŸ† '));
  } else {
    steamStatsList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ“Š æš‚æ—  Steam ç»Ÿè®¡æ•°æ®</div>';
    steamReviewsList.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ“ æš‚æ— è¯„ä»·æ•°æ®</div>';
  }
}

// å¡«å……ç³»ç»Ÿé…ç½®ï¼ˆç´§å‡‘ç‰ˆä¸€è¡Œæ˜¾ç¤ºï¼‰
function fillSystemRequirements(minReq, recReq) {
  sysMinListEl.innerHTML = '';
  sysRecommendedListEl.innerHTML = '';
  
  if (minReq && Object.keys(minReq).length > 0) {
    if (minReq.os) sysMinListEl.appendChild(createCompactRow('ç³»ç»Ÿ', minReq.os, 'ğŸ’¿ '));
    if (minReq.processor) sysMinListEl.appendChild(createCompactRow('CPU', minReq.processor, 'ğŸ”² '));
    if (minReq.memory) sysMinListEl.appendChild(createCompactRow('å†…å­˜', minReq.memory, 'ğŸ“Ÿ '));
    if (minReq.graphics) sysMinListEl.appendChild(createCompactRow('æ˜¾å¡', minReq.graphics, 'ğŸ¨ '));
    if (minReq.storage) sysMinListEl.appendChild(createCompactRow('ç¡¬ç›˜', minReq.storage, 'ğŸ’¾ '));
    
    // å¦‚æœæ²¡æœ‰ä»»ä½•æ•°æ®é¡¹è¢«æ·»åŠ 
    if (sysMinListEl.children.length === 0) {
      sysMinListEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ’» æš‚æ— æœ€ä½é…ç½®æ•°æ®</div>';
    }
  } else {
    sysMinListEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ’» æš‚æ— æœ€ä½é…ç½®æ•°æ®</div>';
  }
  
  if (recReq && Object.keys(recReq).length > 0) {
    if (recReq.os) sysRecommendedListEl.appendChild(createCompactRow('ç³»ç»Ÿ', recReq.os, 'ğŸ’¿ '));
    if (recReq.processor) sysRecommendedListEl.appendChild(createCompactRow('CPU', recReq.processor, 'ğŸ”² '));
    if (recReq.memory) sysRecommendedListEl.appendChild(createCompactRow('å†…å­˜', recReq.memory, 'ğŸ“Ÿ '));
    if (recReq.graphics) sysRecommendedListEl.appendChild(createCompactRow('æ˜¾å¡', recReq.graphics, 'ğŸ¨ '));
    if (recReq.storage) sysRecommendedListEl.appendChild(createCompactRow('ç¡¬ç›˜', recReq.storage, 'ğŸ’¾ '));
    
    if (sysRecommendedListEl.children.length === 0) {
      sysRecommendedListEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ’» æš‚æ— æ¨èé…ç½®æ•°æ®</div>';
    }
  } else {
    sysRecommendedListEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">ğŸ’» æš‚æ— æ¨èé…ç½®æ•°æ®</div>';
  }
}

// ä» Steam API è·å–ç³»ç»Ÿé…ç½®
async function fetchSteamRequirements(gameTitle, appid) {
  try {
    console.log(`æ­£åœ¨è·å– ${gameTitle} çš„ç³»ç»Ÿé…ç½®...`);
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    sysMinListEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">â³ æ­£åœ¨è·å–é…ç½®...</div>';
    sysRecommendedListEl.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-muted);">â³ æ­£åœ¨è·å–é…ç½®...</div>';
    
    // å¦‚æœæœ‰ appidï¼Œç›´æ¥ä½¿ç”¨æœ¬åœ°ä»£ç†æœåŠ¡å™¨
    if (appid && typeof appid === 'number') {
      try {
        const response = await fetch(`/api/steam/appdetails?appid=${appid}`);
        if (response.ok) {
          const data = await response.json();
          if (data && data[appid] && data[appid].success) {
            const pcReq = data[appid].data.pc_requirements;
            if (pcReq) {
              const minReq = pcReq.minimum ? parseRequirementsHTML(pcReq.minimum) : null;
              const recReq = pcReq.recommended ? parseRequirementsHTML(pcReq.recommended) : null;
              fillSystemRequirements(minReq, recReq);
              console.log(`âœ… æˆåŠŸè·å– ${gameTitle} çš„ç³»ç»Ÿé…ç½®`);
              return;
            }
          }
        }
      } catch (proxyErr) {
        console.log('æœ¬åœ°ä»£ç†å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ–¹å¼...');
      }
    }
    
    // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨ steamAPI å·¥å…·ç±»
    if (window.steamAPI) {
      try {
        const requirements = await window.steamAPI.getSystemRequirements(gameTitle);
        fillSystemRequirements(requirements.minimum, requirements.recommended);
        
        if (requirements.minimum || requirements.recommended) {
          console.log(`âœ… æˆåŠŸè·å– ${gameTitle} çš„ç³»ç»Ÿé…ç½®`);
        } else {
          console.log(`â„¹ï¸ ${gameTitle} æ— ç³»ç»Ÿé…ç½®æ•°æ®`);
        }
      } catch (apiErr) {
        console.log(`â„¹ï¸ ${gameTitle} æ— ç³»ç»Ÿé…ç½®æ•°æ®`);
        fillSystemRequirements(null, null);
      }
    } else {
      fillSystemRequirements(null, null);
    }
  } catch (err) {
    console.error(`âŒ è·å–ç³»ç»Ÿé…ç½®å¤±è´¥:`, err);
    fillSystemRequirements(null, null);
  }
}

// è§£æ Steam HTML æ ¼å¼çš„ç³»ç»Ÿé…ç½®
function parseRequirementsHTML(htmlString) {
  if (!htmlString || typeof htmlString !== 'string') return null;
  
  const parser = new DOMParser();
  const doc = parser.parseFromString(htmlString, 'text/html');
  const text = doc.body.textContent || '';
  
  const result = {};
  
  const patterns = {
    os: /(?:OS|æ“ä½œç³»ç»Ÿ)[:\sï¼š]*([^\n]+)/i,
    processor: /(?:Processor|CPU|å¤„ç†å™¨)[:\sï¼š]*([^\n]+)/i,
    memory: /(?:Memory|RAM|å†…å­˜)[:\sï¼š]*([^\n]+)/i,
    graphics: /(?:Graphics|GPU|æ˜¾å¡|å›¾å½¢)[:\sï¼š]*([^\n]+)/i,
    storage: /(?:Storage|Hard Drive|ç¡¬ç›˜|å­˜å‚¨ç©ºé—´)[:\sï¼š]*([^\n]+)/i,
  };
  
  for (const [key, pattern] of Object.entries(patterns)) {
    const match = text.match(pattern);
    if (match && match[1]) {
      result[key] = match[1].trim().substring(0, 100); // é™åˆ¶é•¿åº¦
    }
  }
  
  return Object.keys(result).length > 0 ? result : null;
}

// ä¸»åŠ è½½å‡½æ•°
async function loadDetail() {
  if (!gameId && !gameName) return;

  try {
    // ä»çœŸå®æ¸¸æˆæ•°æ®åº“è·å–æ¸¸æˆæ•°æ®
    let game = null;
    
    // åŠ è½½Steamæ¸¸æˆæ•°æ®
    const steamGames = await window.megaGameDB.getAllGames();
    
    // åŠ è½½å¤šå¹³å°æ¸¸æˆæ•°æ®
    const multiPlatformGames = window.multiPlatformGames ? window.multiPlatformGames.all : [];
    
    // åˆå¹¶æ‰€æœ‰æ¸¸æˆæ•°æ®
    const allGames = [
      ...steamGames,
      ...multiPlatformGames.map(g => ({
        id: g.id,
        appid: g.id,
        name: g.name,
        chineseName: g.chineseName,
        genre: g.genre,
        rating: g.rating,
        price: g.price,
        year: g.year,
        platform: g.platform,
        thumbnail: g.cover,
        developer: 'Official',
        publisher: 'Official',
        releaseDate: g.year,
        category: g.genre,
        short_description: `${g.name} is a ${g.genre} game released in ${g.year}.`,
        source: g.platform.includes(',') ? 'Multi-Platform' : g.platform
      }))
    ];
    
    console.log(`âœ… æ¸¸æˆè¯¦æƒ…é¡µåŠ è½½ ${allGames.length} æ¬¾æ¸¸æˆï¼ˆSteam: ${steamGames.length}, å¤šå¹³å°: ${multiPlatformGames.length}ï¼‰`);
    
    // ä¼˜å…ˆä½¿ç”¨åç§°ç²¾ç¡®åŒ¹é…ï¼ˆæ›´å‡†ç¡®ï¼‰
    if (gameName) {
      game = window.megaGameDB.getGameByName(gameName);
      
      // å¦‚æœåœ¨Steamæ•°æ®åº“æ²¡æ‰¾åˆ°ï¼Œæœç´¢å¤šå¹³å°æ¸¸æˆ
      if (!game && multiPlatformGames.length > 0) {
        const foundMulti = multiPlatformGames.find(g => 
          g.name.toLowerCase() === gameName.toLowerCase() ||
          (g.chineseName && g.chineseName === gameName)
        );
        if (foundMulti) {
          game = {
            id: foundMulti.id,
            appid: foundMulti.id,
            name: foundMulti.name,
            chineseName: foundMulti.chineseName,
            genre: foundMulti.genre,
            rating: foundMulti.rating,
            price: foundMulti.price,
            year: foundMulti.year,
            platform: foundMulti.platform,
            thumbnail: foundMulti.cover,
            developer: 'Official',
            publisher: 'Official',
            releaseDate: foundMulti.year,
            category: foundMulti.genre,
            short_description: `${foundMulti.name} is a ${foundMulti.genre} game released in ${foundMulti.year}.`,
            source: foundMulti.platform.includes(',') ? 'Multi-Platform' : foundMulti.platform
          };
        }
      }
      
      // å¦‚æœç²¾ç¡®åŒ¹é…å¤±è´¥ï¼Œå°è¯•æ¨¡ç³ŠåŒ¹é…
      if (!game) {
        const lowerName = gameName.toLowerCase();
        game = allGames.find(g => 
          g.name.toLowerCase().includes(lowerName) ||
          (g.title && g.title.toLowerCase().includes(lowerName)) ||
          (g.chineseName && g.chineseName.includes(gameName))
        );
      }
    }
    
    // å¦‚æœåç§°åŒ¹é…å¤±è´¥ï¼Œå†å°è¯•ç”¨IDæŸ¥æ‰¾
    if (!game && gameId) {
      game = window.megaGameDB.getGameById(gameId);
      
      // æœç´¢å¤šå¹³å°æ¸¸æˆ
      if (!game && multiPlatformGames.length > 0) {
        const foundMulti = multiPlatformGames.find(g => g.id === gameId);
        if (foundMulti) {
          game = {
            id: foundMulti.id,
            appid: foundMulti.id,
            name: foundMulti.name,
            chineseName: foundMulti.chineseName,
            genre: foundMulti.genre,
            rating: foundMulti.rating,
            price: foundMulti.price,
            year: foundMulti.year,
            platform: foundMulti.platform,
            thumbnail: foundMulti.cover,
            developer: 'Official',
            publisher: 'Official',
            releaseDate: foundMulti.year,
            category: foundMulti.genre,
            short_description: `${foundMulti.name} is a ${foundMulti.genre} game released in ${foundMulti.year}.`,
            source: foundMulti.platform.includes(',') ? 'Multi-Platform' : foundMulti.platform
          };
        }
      }
    }

    if (!game) {
      safeSetText(titleEl, "æ¸¸æˆæœªæ‰¾åˆ°");
      safeSetText(descEl, "åœ¨æ¸¸æˆåº“ä¸­æ‰¾ä¸åˆ°è¯¥æ¸¸æˆï¼Œè¯·è¿”å›é‡æ–°é€‰æ‹©ã€‚");
      steamStatsList.innerHTML = '<div style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</div>';
      steamReviewsList.innerHTML = '<div style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</div>';
      sysMinListEl.innerHTML = '<div style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</div>';
      sysRecommendedListEl.innerHTML = '<div style="color: var(--danger);">æ¸¸æˆæ•°æ®æœªæ‰¾åˆ°</div>';
      return;
    }

    // å¡«å……åŸºæœ¬ä¿¡æ¯
    safeSetText(breadcrumbNameEl, game.name || game.title);
    safeSetText(titleEl, game.name || game.title);
    safeSetText(platformEl, game.platform || "PC");
    safeSetText(devEl, game.developer || "æœªçŸ¥");
    safeSetText(pubEl, game.publisher || "æœªçŸ¥");
    safeSetText(dateEl, game.releaseDate || game.year || "æœªçŸ¥");
    safeSetText(tagEl, game.category || game.genre || "æ¸¸æˆ");
    
    // æ¸¸æˆæè¿°
    let description = game.short_description || `${game.name} æ˜¯ä¸€æ¬¾ç”± ${game.developer || 'æœªçŸ¥'} å¼€å‘çš„ ${game.category || game.genre || ''} æ¸¸æˆã€‚`;
    safeSetText(descEl, description);
    
    // è¯„åˆ†
    const score = Number(game.rating) || 0;
    safeSetText(scoreEl, score.toFixed(1));
    
    // å°é¢å›¾
    const coverUrl = game.thumbnail;
    if (coverUrl) {
      coverEl.src = coverUrl;
      coverEl.alt = (game.name || game.title) + " å°é¢";
      coverEl.onerror = function() {
        this.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzAwIiBoZWlnaHQ9IjQwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZGVmcz48bGluZWFyR3JhZGllbnQgaWQ9ImdyYWQiIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPjxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOnJnYigxMDIsMTI2LDIzNCk7c3RvcC1vcGFjaXR5OjEiIC8+PHN0b3Agb2Zmc2V0PSIxMDAlIiBzdHlsZT0ic3RvcC1jb2xvcjpyZ2IoMTE4LDc1LDE2Mik7c3RvcC1vcGFjaXR5OjEiIC8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHJlY3Qgd2lkdGg9IjMwMCIgaGVpZ2h0PSI0MDAiIGZpbGw9InVybCgjZ3JhZCkiLz48dGV4dCB4PSIxNTAiIHk9IjIyMCIgZm9udC1zaXplPSIxMjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiPvCfjonuPC90ZXh0Pjwvc3ZnPg==';
      };
    }
    
    // Steam é“¾æ¥
    if (game.appid && typeof game.appid === 'number') {
      urlEl.href = `https://store.steampowered.com/app/${game.appid}`;
      urlEl.style.display = 'flex';
      profileEl.href = `https://steamdb.info/app/${game.appid}/`;
      profileEl.style.display = 'flex';
    } else {
      urlEl.style.display = 'none';
      profileEl.style.display = 'none';
    }

    // å¡«å…… Steam æ•°æ®
    fillSteamData(game);

    // è·å–ç³»ç»Ÿé…ç½®
    fetchSteamRequirements(game.name || game.title, game.appid);
    
  } catch (err) {
    console.error("åŠ è½½è¯¦æƒ…å¤±è´¥ï¼š", err);
    safeSetText(titleEl, "åŠ è½½å¤±è´¥");
    safeSetText(descEl, "æ— æ³•åŠ è½½æ¸¸æˆæ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚é”™è¯¯: " + err.message);
  }
}

loadDetail();
</script>
</body>
</html>
