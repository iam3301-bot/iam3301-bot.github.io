<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Supabase ä¸€é”®ä¿®å¤å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 800px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 32px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 16px;
    }
    
    .step {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid #667eea;
    }
    
    .step h3 {
      color: #333;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .step-num {
      background: #667eea;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    .btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
      margin: 10px 0;
    }
    
    .btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102,126,234,0.4);
    }
    
    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }
    
    .result {
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      max-height: 400px;
      overflow-y: auto;
      display: none;
    }
    
    .result.success {
      background: #d4edda;
      border: 2px solid #28a745;
      color: #155724;
      display: block;
    }
    
    .result.error {
      background: #f8d7da;
      border: 2px solid #dc3545;
      color: #721c24;
      display: block;
    }
    
    .result.info {
      background: #d1ecf1;
      border: 2px solid #17a2b8;
      color: #0c5460;
      display: block;
    }
    
    .sql-code {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 20px;
      border-radius: 8px;
      overflow-x: auto;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      line-height: 1.5;
      margin: 15px 0;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .copy-btn {
      background: #28a745;
      font-size: 14px;
      padding: 10px 20px;
    }
    
    .copy-btn:hover {
      background: #218838;
    }
    
    .link {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
    }
    
    .link:hover {
      text-decoration: underline;
    }
    
    .warning {
      background: #fff3cd;
      border: 2px solid #ffc107;
      color: #856404;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ Supabase ä¸€é”®ä¿®å¤å·¥å…·</h1>
    <p class="subtitle">è‡ªåŠ¨æ£€æµ‹å¹¶ä¿®å¤ç¤¾åŒºæ•°æ®åº“è¿æ¥é—®é¢˜</p>
    
    <div class="step">
      <h3>
        <span class="step-num">1</span>
        æ£€æŸ¥å½“å‰çŠ¶æ€
      </h3>
      <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ£€æµ‹ Supabase è¿æ¥çŠ¶æ€å’Œæ•°æ®åº“è¡¨</p>
      <button class="btn" onclick="checkStatus()">ğŸ” å¼€å§‹è¯Šæ–­</button>
    </div>
    
    <div class="step">
      <h3>
        <span class="step-num">2</span>
        æ‰§è¡Œä¿®å¤
      </h3>
      <p>å¦‚æœæ£€æµ‹åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ç…§ä¸‹æ–¹æŒ‡å¼•åœ¨ Supabase æ‰§è¡Œ SQL</p>
      <a href="https://supabase.com/dashboard/project/gybgiqyyltckgxbdtzwu/sql" target="_blank" class="btn">
        ğŸš€ æ‰“å¼€ Supabase SQL Editor
      </a>
      <button class="btn copy-btn" onclick="copySQL()">ğŸ“‹ å¤åˆ¶ SQL è„šæœ¬</button>
    </div>
    
    <div class="step">
      <h3>
        <span class="step-num">3</span>
        éªŒè¯ä¿®å¤ç»“æœ
      </h3>
      <p>æ‰§è¡Œ SQL åï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®éªŒè¯</p>
      <button class="btn" onclick="verifyFix()">âœ… éªŒè¯ä¿®å¤</button>
    </div>
    
    <div id="result" class="result"></div>
    
    <div id="sql-container" style="display:none;">
      <h3 style="margin: 20px 0 10px 0;">ğŸ“ SQL ä¿®å¤è„šæœ¬</h3>
      <div class="sql-code" id="sql-code"></div>
    </div>
  </div>

  <script>
    const SQL_SCRIPT = `-- =============================================
-- GameBox Supabase æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
-- ä¸€é”®ä¿®å¤ç‰ˆæœ¬
-- =============================================

-- 0. ç”¨æˆ·æ³¨å†Œè¡¨
CREATE TABLE IF NOT EXISTS user_profiles (
  id TEXT PRIMARY KEY,
  username TEXT NOT NULL UNIQUE,
  email TEXT,
  avatar TEXT DEFAULT 'ğŸ‘¤',
  bio TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  last_login_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 1. ç¤¾åŒºå¸–å­è¡¨
CREATE TABLE IF NOT EXISTS community_posts (
  id TEXT PRIMARY KEY,
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  author TEXT NOT NULL DEFAULT 'æ¸¸å®¢',
  avatar TEXT DEFAULT 'ğŸ‘¤',
  game TEXT DEFAULT 'æœªåˆ†ç±»',
  board TEXT DEFAULT 'general',
  replies INTEGER DEFAULT 0,
  likes INTEGER DEFAULT 0,
  views INTEGER DEFAULT 0,
  is_pinned BOOLEAN DEFAULT FALSE,
  is_new BOOLEAN DEFAULT TRUE,
  user_id TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- 2. å¸–å­è¯„è®ºè¡¨
CREATE TABLE IF NOT EXISTS community_comments (
  id TEXT PRIMARY KEY,
  post_id TEXT NOT NULL REFERENCES community_posts(id) ON DELETE CASCADE,
  author TEXT NOT NULL DEFAULT 'æ¸¸å®¢',
  avatar TEXT DEFAULT 'ğŸ‘¤',
  content TEXT NOT NULL,
  likes INTEGER DEFAULT 0,
  user_id TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 3. ç‚¹èµè®°å½•è¡¨
CREATE TABLE IF NOT EXISTS community_likes (
  id TEXT PRIMARY KEY,
  target_type TEXT NOT NULL,
  target_id TEXT NOT NULL,
  user_id TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(target_type, target_id, user_id)
);

-- 4. ç¤¾åŒºç»Ÿè®¡è¡¨
CREATE TABLE IF NOT EXISTS community_stats (
  id INTEGER PRIMARY KEY DEFAULT 1,
  total_members INTEGER DEFAULT 0,
  total_replies INTEGER DEFAULT 0,
  start_time TIMESTAMPTZ DEFAULT NOW(),
  last_update TIMESTAMPTZ DEFAULT NOW()
);

-- 5. åœ¨çº¿ç”¨æˆ·è¿½è¸ªè¡¨
CREATE TABLE IF NOT EXISTS online_users (
  user_id TEXT PRIMARY KEY,
  username TEXT NOT NULL,
  last_active TIMESTAMPTZ DEFAULT NOW()
);

-- 6. æ´»åŠ¨æ—¥å¿—è¡¨
CREATE TABLE IF NOT EXISTS activity_logs (
  id TEXT PRIMARY KEY,
  action TEXT NOT NULL,
  user_id TEXT,
  details JSONB DEFAULT '{}',
  session_id TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 7. ç”¨æˆ·å¹³å°ç»‘å®šè¡¨
CREATE TABLE IF NOT EXISTS user_platform_bindings (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id TEXT NOT NULL,
  platform VARCHAR(50) NOT NULL,
  platform_user_id VARCHAR(255) NOT NULL,
  platform_username VARCHAR(255),
  platform_avatar TEXT,
  platform_profile_url TEXT,
  platform_data JSONB,
  linked_at TIMESTAMPTZ DEFAULT NOW(),
  last_sync_at TIMESTAMPTZ DEFAULT NOW(),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(user_id, platform)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_posts_board ON community_posts(board);
CREATE INDEX IF NOT EXISTS idx_posts_created ON community_posts(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_posts_is_pinned ON community_posts(is_pinned DESC, created_at DESC);
CREATE INDEX IF NOT EXISTS idx_comments_post ON community_comments(post_id);
CREATE INDEX IF NOT EXISTS idx_comments_created ON community_comments(created_at);
CREATE INDEX IF NOT EXISTS idx_likes_target ON community_likes(target_type, target_id);
CREATE INDEX IF NOT EXISTS idx_likes_user ON community_likes(user_id);
CREATE INDEX IF NOT EXISTS idx_online_users_active ON online_users(last_active);
CREATE INDEX IF NOT EXISTS idx_activity_logs_user ON activity_logs(user_id);
CREATE INDEX IF NOT EXISTS idx_activity_logs_created ON activity_logs(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_platform_bindings_user ON user_platform_bindings(user_id);
CREATE INDEX IF NOT EXISTS idx_platform_bindings_platform ON user_platform_bindings(platform);
CREATE INDEX IF NOT EXISTS idx_user_profiles_username ON user_profiles(username);
CREATE INDEX IF NOT EXISTS idx_user_profiles_created ON user_profiles(created_at DESC);

-- å¯ç”¨è¡Œçº§å®‰å…¨ç­–ç•¥
ALTER TABLE user_profiles ENABLE ROW LEVEL SECURITY;
ALTER TABLE community_posts ENABLE ROW LEVEL SECURITY;
ALTER TABLE community_comments ENABLE ROW LEVEL SECURITY;
ALTER TABLE community_likes ENABLE ROW LEVEL SECURITY;
ALTER TABLE community_stats ENABLE ROW LEVEL SECURITY;
ALTER TABLE online_users ENABLE ROW LEVEL SECURITY;
ALTER TABLE activity_logs ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_platform_bindings ENABLE ROW LEVEL SECURITY;

-- åˆ›å»º RLS ç­–ç•¥
DROP POLICY IF EXISTS "å…è®¸å…¬å¼€è¯»å–ç”¨æˆ·èµ„æ–™" ON user_profiles;
CREATE POLICY "å…è®¸å…¬å¼€è¯»å–ç”¨æˆ·èµ„æ–™" ON user_profiles FOR SELECT USING (true);
DROP POLICY IF EXISTS "å…è®¸åˆ›å»ºç”¨æˆ·èµ„æ–™" ON user_profiles;
CREATE POLICY "å…è®¸åˆ›å»ºç”¨æˆ·èµ„æ–™" ON user_profiles FOR INSERT WITH CHECK (true);
DROP POLICY IF EXISTS "å…è®¸æ›´æ–°ç”¨æˆ·èµ„æ–™" ON user_profiles;
CREATE POLICY "å…è®¸æ›´æ–°ç”¨æˆ·èµ„æ–™" ON user_profiles FOR UPDATE USING (true);

DROP POLICY IF EXISTS "å…è®¸å…¬å¼€è¯»å–å¸–å­" ON community_posts;
CREATE POLICY "å…è®¸å…¬å¼€è¯»å–å¸–å­" ON community_posts FOR SELECT USING (true);
DROP POLICY IF EXISTS "å…è®¸åˆ›å»ºå¸–å­" ON community_posts;
CREATE POLICY "å…è®¸åˆ›å»ºå¸–å­" ON community_posts FOR INSERT WITH CHECK (true);
DROP POLICY IF EXISTS "å…è®¸æ›´æ–°å¸–å­" ON community_posts;
CREATE POLICY "å…è®¸æ›´æ–°å¸–å­" ON community_posts FOR UPDATE USING (true);
DROP POLICY IF EXISTS "å…è®¸åˆ é™¤å¸–å­" ON community_posts;
CREATE POLICY "å…è®¸åˆ é™¤å¸–å­" ON community_posts FOR DELETE USING (true);

DROP POLICY IF EXISTS "å…è®¸å…¬å¼€è¯»å–è¯„è®º" ON community_comments;
CREATE POLICY "å…è®¸å…¬å¼€è¯»å–è¯„è®º" ON community_comments FOR SELECT USING (true);
DROP POLICY IF EXISTS "å…è®¸åˆ›å»ºè¯„è®º" ON community_comments;
CREATE POLICY "å…è®¸åˆ›å»ºè¯„è®º" ON community_comments FOR INSERT WITH CHECK (true);
DROP POLICY IF EXISTS "å…è®¸æ›´æ–°è¯„è®º" ON community_comments;
CREATE POLICY "å…è®¸æ›´æ–°è¯„è®º" ON community_comments FOR UPDATE USING (true);
DROP POLICY IF EXISTS "å…è®¸åˆ é™¤è¯„è®º" ON community_comments;
CREATE POLICY "å…è®¸åˆ é™¤è¯„è®º" ON community_comments FOR DELETE USING (true);

DROP POLICY IF EXISTS "å…è®¸æŸ¥çœ‹ç‚¹èµ" ON community_likes;
CREATE POLICY "å…è®¸æŸ¥çœ‹ç‚¹èµ" ON community_likes FOR SELECT USING (true);
DROP POLICY IF EXISTS "å…è®¸ç‚¹èµ" ON community_likes;
CREATE POLICY "å…è®¸ç‚¹èµ" ON community_likes FOR INSERT WITH CHECK (true);
DROP POLICY IF EXISTS "å…è®¸åˆ é™¤ç‚¹èµ" ON community_likes;
CREATE POLICY "å…è®¸åˆ é™¤ç‚¹èµ" ON community_likes FOR DELETE USING (true);

DROP POLICY IF EXISTS "å…è®¸å…¬å¼€è¯»å–ç»Ÿè®¡" ON community_stats;
CREATE POLICY "å…è®¸å…¬å¼€è¯»å–ç»Ÿè®¡" ON community_stats FOR SELECT USING (true);
DROP POLICY IF EXISTS "å…è®¸æ›´æ–°ç»Ÿè®¡" ON community_stats;
CREATE POLICY "å…è®¸æ›´æ–°ç»Ÿè®¡" ON community_stats FOR UPDATE USING (true);
DROP POLICY IF EXISTS "å…è®¸æ’å…¥ç»Ÿè®¡" ON community_stats;
CREATE POLICY "å…è®¸æ’å…¥ç»Ÿè®¡" ON community_stats FOR INSERT WITH CHECK (true);

DROP POLICY IF EXISTS "å…è®¸å…¬å¼€è¯»å–åœ¨çº¿ç”¨æˆ·" ON online_users;
CREATE POLICY "å…è®¸å…¬å¼€è¯»å–åœ¨çº¿ç”¨æˆ·" ON online_users FOR SELECT USING (true);
DROP POLICY IF EXISTS "å…è®¸æ›´æ–°åœ¨çº¿çŠ¶æ€" ON online_users;
CREATE POLICY "å…è®¸æ›´æ–°åœ¨çº¿çŠ¶æ€" ON online_users FOR ALL USING (true);

DROP POLICY IF EXISTS "å…è®¸æŸ¥çœ‹æ´»åŠ¨æ—¥å¿—" ON activity_logs;
CREATE POLICY "å…è®¸æŸ¥çœ‹æ´»åŠ¨æ—¥å¿—" ON activity_logs FOR SELECT USING (true);
DROP POLICY IF EXISTS "å…è®¸è®°å½•æ´»åŠ¨" ON activity_logs;
CREATE POLICY "å…è®¸è®°å½•æ´»åŠ¨" ON activity_logs FOR INSERT WITH CHECK (true);

DROP POLICY IF EXISTS "å…è®¸æŸ¥çœ‹ç»‘å®š" ON user_platform_bindings;
CREATE POLICY "å…è®¸æŸ¥çœ‹ç»‘å®š" ON user_platform_bindings FOR SELECT USING (true);
DROP POLICY IF EXISTS "å…è®¸ç®¡ç†å¹³å°ç»‘å®š" ON user_platform_bindings;
CREATE POLICY "å…è®¸ç®¡ç†å¹³å°ç»‘å®š" ON user_platform_bindings FOR ALL USING (true);

-- åˆ›å»ºè§¦å‘å™¨å‡½æ•°
CREATE OR REPLACE FUNCTION update_community_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

DROP TRIGGER IF EXISTS trigger_update_posts_updated_at ON community_posts;
CREATE TRIGGER trigger_update_posts_updated_at
  BEFORE UPDATE ON community_posts
  FOR EACH ROW
  EXECUTE FUNCTION update_community_updated_at();

DROP TRIGGER IF EXISTS trigger_update_bindings_updated_at ON user_platform_bindings;
CREATE TRIGGER trigger_update_bindings_updated_at
  BEFORE UPDATE ON user_platform_bindings
  FOR EACH ROW
  EXECUTE FUNCTION update_community_updated_at();

-- æ’å…¥åˆå§‹æ•°æ®
INSERT INTO community_stats (id, total_members, total_replies, start_time, last_update)
VALUES (1, 0, 0, NOW(), NOW())
ON CONFLICT (id) DO UPDATE SET last_update = NOW();

INSERT INTO community_posts (id, title, content, author, avatar, game, board, replies, likes, views, is_pinned, is_new, created_at)
VALUES 
  ('pinned-welcome', 'ã€å…¬å‘Šã€‘æ¬¢è¿æ¥åˆ° GameBox ç¤¾åŒºï¼', 'è¿™æ˜¯ä¸€ä¸ªç”±ç©å®¶å…±å»ºçš„æ¸¸æˆç¤¾åŒºã€‚åœ¨è¿™é‡Œä½ å¯ä»¥ï¼š

ğŸ® åˆ†äº«æ¸¸æˆå¿ƒå¾—å’Œæ”»ç•¥
ğŸ“· å±•ç¤ºç²¾å½©æ¸¸æˆæˆªå›¾
ğŸ’¬ ä¸å…¶ä»–ç©å®¶äº¤æµè®¨è®º
ğŸ”„ äº¤æ˜“æ¸¸æˆç‰©å“

è¯·éµå®ˆç¤¾åŒºè§„åˆ™ï¼Œå‹å–„äº¤æµã€‚ç¥ä½ æ¸¸æˆæ„‰å¿«ï¼', 'GameBoxå®˜æ–¹', 'ğŸ®', 'GameBox', 'general', 0, 0, 0, true, false, NOW() - INTERVAL '30 days')
ON CONFLICT (id) DO NOTHING;

-- åˆ›å»ºå®ç”¨å‡½æ•°
CREATE OR REPLACE FUNCTION increment_post_views(post_id TEXT)
RETURNS void AS $$
BEGIN
  UPDATE community_posts 
  SET views = views + 1 
  WHERE id = post_id;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION get_hot_posts(limit_count INT DEFAULT 10)
RETURNS TABLE (
  id TEXT,
  title TEXT,
  author TEXT,
  game TEXT,
  likes INTEGER,
  replies INTEGER,
  views INTEGER,
  heat_score NUMERIC
) AS $$
BEGIN
  RETURN QUERY
  SELECT 
    p.id,
    p.title,
    p.author,
    p.game,
    p.likes,
    p.replies,
    p.views,
    (p.likes * 3 + p.replies * 2 + p.views * 0.1) as heat_score
  FROM community_posts p
  WHERE p.is_pinned = false
  ORDER BY heat_score DESC, p.created_at DESC
  LIMIT limit_count;
END;
$$ LANGUAGE plpgsql;

CREATE OR REPLACE FUNCTION cleanup_expired_online_users()
RETURNS void AS $$
BEGIN
  DELETE FROM online_users
  WHERE last_active < NOW() - INTERVAL '10 minutes';
END;
$$ LANGUAGE plpgsql;`;

    async function checkStatus() {
      const result = document.getElementById('result');
      result.className = 'result info';
      result.innerHTML = 'ğŸ” æ­£åœ¨æ£€æµ‹ Supabase è¿æ¥çŠ¶æ€...<br><br>';
      
      try {
        // æ£€æŸ¥é…ç½®
        if (typeof SUPABASE_CONFIG === 'undefined') {
          result.className = 'result error';
          result.innerHTML += 'âŒ é”™è¯¯: SUPABASE_CONFIG æœªå®šä¹‰<br>';
          result.innerHTML += 'è¯·ç¡®ä¿åœ¨ community.html ä¸­åŠ è½½äº† supabase-config.js';
          return;
        }
        
        result.innerHTML += `âœ… é…ç½®æ–‡ä»¶å·²åŠ è½½<br>`;
        result.innerHTML += `ğŸ“ Supabase URL: ${SUPABASE_CONFIG.url}<br>`;
        result.innerHTML += `ğŸ”‘ anonKey: ${SUPABASE_CONFIG.anonKey ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}<br>`;
        result.innerHTML += `âš™ï¸ å·²å¯ç”¨: ${SUPABASE_CONFIG.enabled}<br><br>`;
        
        if (!SUPABASE_CONFIG.enabled) {
          result.className = 'result error';
          result.innerHTML += 'âŒ Supabase æœªå¯ç”¨<br>';
          result.innerHTML += 'è¯·åœ¨ supabase-config.js ä¸­è®¾ç½® enabled: true';
          return;
        }
        
        // æ£€æŸ¥ SDK
        if (typeof supabase === 'undefined') {
          result.className = 'result error';
          result.innerHTML += 'âŒ Supabase SDK æœªåŠ è½½<br>';
          result.innerHTML += 'è¯·ç¡®ä¿åŠ è½½äº† @supabase/supabase-js';
          return;
        }
        
        result.innerHTML += 'âœ… Supabase SDK å·²åŠ è½½<br><br>';
        result.innerHTML += 'ğŸ”Œ æ­£åœ¨æµ‹è¯•æ•°æ®åº“è¿æ¥...<br>';
        
        const client = supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
        
        // æµ‹è¯•è¡¨
        const tables = ['community_posts', 'user_profiles', 'community_stats', 'online_users'];
        let allTablesExist = true;
        
        for (const table of tables) {
          try {
            const { data, error } = await client.from(table).select('*').limit(1);
            if (error) {
              result.innerHTML += `âŒ è¡¨ ${table} ä¸å­˜åœ¨æˆ–æ— æƒé™è®¿é—®<br>`;
              allTablesExist = false;
            } else {
              result.innerHTML += `âœ… è¡¨ ${table} æ­£å¸¸<br>`;
            }
          } catch (e) {
            result.innerHTML += `âŒ è¡¨ ${table} æ£€æŸ¥å¤±è´¥: ${e.message}<br>`;
            allTablesExist = false;
          }
        }
        
        if (allTablesExist) {
          result.className = 'result success';
          result.innerHTML += '<br>ğŸ‰ æ­å–œï¼æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œæ•°æ®åº“å·²æ­£ç¡®é…ç½®ï¼<br>';
          result.innerHTML += '<br>âœ¨ è¯·è®¿é—® <a href="community.html" class="link">community.html</a> éªŒè¯åŠŸèƒ½';
        } else {
          result.className = 'result error';
          result.innerHTML += '<br>âš ï¸ æ£€æµ‹åˆ°é—®é¢˜ï¼è¯·æ‰§è¡Œæ­¥éª¤2ä¿®å¤<br>';
          document.getElementById('sql-container').style.display = 'block';
          document.getElementById('sql-code').textContent = SQL_SCRIPT;
        }
      } catch (e) {
        result.className = 'result error';
        result.innerHTML += `<br>âŒ æ£€æµ‹å¤±è´¥: ${e.message}`;
      }
    }
    
    function copySQL() {
      const textarea = document.createElement('textarea');
      textarea.value = SQL_SCRIPT;
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'âœ… å·²å¤åˆ¶ï¼';
      btn.style.background = '#28a745';
      
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = '';
      }, 2000);
    }
    
    async function verifyFix() {
      const result = document.getElementById('result');
      result.className = 'result info';
      result.innerHTML = 'ğŸ” æ­£åœ¨éªŒè¯ä¿®å¤ç»“æœ...<br><br>';
      
      try {
        const client = supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.anonKey);
        
        const tables = ['community_posts', 'user_profiles', 'community_stats', 'online_users'];
        let allFixed = true;
        
        for (const table of tables) {
          const { error } = await client.from(table).select('*').limit(1);
          if (error) {
            result.innerHTML += `âŒ ${table} ä»ç„¶æœ‰é—®é¢˜<br>`;
            allFixed = false;
          } else {
            result.innerHTML += `âœ… ${table} å·²ä¿®å¤<br>`;
          }
        }
        
        if (allFixed) {
          result.className = 'result success';
          result.innerHTML += '<br>ğŸ‰ ä¿®å¤æˆåŠŸï¼æ‰€æœ‰æ•°æ®åº“è¡¨å·²å°±ç»ªï¼<br><br>';
          result.innerHTML += 'ğŸ‘‰ ä¸‹ä¸€æ­¥ï¼š<br>';
          result.innerHTML += '1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ (Ctrl+Shift+Delete)<br>';
          result.innerHTML += '2. è®¿é—® <a href="community.html" class="link">community.html</a><br>';
          result.innerHTML += '3. æ£€æŸ¥å³ä¸‹è§’æ˜¯å¦æ˜¾ç¤º "ğŸŸ¢ Supabase äº‘æ•°æ®åº“"';
        } else {
          result.className = 'result error';
          result.innerHTML += '<br>âš ï¸ éƒ¨åˆ†è¡¨ä»æœ‰é—®é¢˜ï¼Œè¯·é‡æ–°æ‰§è¡Œ SQL è„šæœ¬';
        }
      } catch (e) {
        result.className = 'result error';
        result.innerHTML += `<br>âŒ éªŒè¯å¤±è´¥: ${e.message}`;
      }
    }
  </script>
</body>
</html>
